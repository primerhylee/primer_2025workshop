


<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>í”„ë¼ì´ë¨¸ ì „ëµíŒ€ ì›Œí¬ìƒµ - Enhanced ë°œí‘œìš© (ìˆœì„œì´ë™ ê¸°ëŠ¥ ì¶”ê°€)</title>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- SheetJS for Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <!-- CountUp.js for number animations -->
    <script src="https://cdn.jsdelivr.net/npm/countup.js@2.0.7/dist/countUp.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #FFF5F5 0%, #FFEDD5 100%);
            color: #1e293b;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(239, 68, 68, 0.2);
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.1);
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #DC2626 0%, #F97316 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .header h1:hover {
            transform: scale(1.02);
            opacity: 0.8;
        }

        .header p {
            font-size: 1.2rem;
            color: #64748b;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            border: 1px solid rgba(239, 68, 68, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(239, 68, 68, 0.08);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: #EF4444;
            box-shadow: 0 10px 40px rgba(239, 68, 68, 0.2);
        }

        .stat-card .icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #DC2626 0%, #F97316 100%);
        }

        .stat-card h3 {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 5px;
        }

        .stat-card .change {
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-card .change.positive {
            color: #10b981;
        }

        .stat-card .change.negative {
            color: #ef4444;
        }

        /* Chart Sections */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            border: 1px solid rgba(239, 68, 68, 0.2);
            box-shadow: 0 2px 10px rgba(239, 68, 68, 0.08);
        }

        .chart-container h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
        }

        .chart-container h2 i {
            color: #EF4444;
        }

        /* Tabs */
        .tabs-container {
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(239, 68, 68, 0.2);
        }

        .tab-button {
            background: transparent;
            border: none;
            color: #64748b;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            font-family: 'Inter', sans-serif;
            position: relative;
            bottom: -2px;
        }

        .tab-button:hover {
            color: #DC2626;
        }

        .tab-button.active {
            color: #1e293b;
            border-bottom-color: #EF4444;
            background: rgba(239, 68, 68, 0.1);
        }

        /* Quick Navigation */
        .quick-nav {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(239, 68, 68, 0.2);
            box-shadow: 0 2px 10px rgba(239, 68, 68, 0.08);
        }

        .quick-nav h3 {
            font-size: 1rem;
            color: #64748b;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .quick-nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .quick-nav-btn {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #DC2626;
            padding: 10px 20px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quick-nav-btn:hover {
            background: #EF4444;
            color: #fff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .quick-nav-btn i {
            font-size: 1rem;
        }

        /* Year Tabs */
        .year-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(239, 68, 68, 0.05);
            border-radius: 12px;
            flex-wrap: wrap;
        }

        .year-tab-button,
        .year-tab-button-income,
        .year-tab-button-chart {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: #64748b;
            padding: 8px 16px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
        }

        .year-tab-button:hover,
        .year-tab-button-income:hover,
        .year-tab-button-chart:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: #EF4444;
            color: #DC2626;
        }

        .year-tab-button.active,
        .year-tab-button-income.active,
        .year-tab-button-chart.active {
            background: #EF4444;
            color: #fff;
            border-color: #EF4444;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            padding: 40px;
            max-width: 1400px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(239, 68, 68, 0.3);
        }

        .modal-header h2 {
            font-size: 2rem;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .modal-header h2 i {
            color: #EF4444;
        }

        .modal-header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .modal-goto-btn {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #EF4444;
            font-size: 1rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-goto-btn:hover {
            background: rgba(239, 68, 68, 0.25);
            transform: translateY(-2px);
        }

        .modal-close {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: rotate(90deg);
        }

        .modal-table-container {
            overflow-x: auto;
            margin-bottom: 20px;
        }

        .modal-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .modal-table thead {
            background: rgba(239, 68, 68, 0.15);
            position: sticky;
            top: 0;
        }

        .modal-table th {
            padding: 15px;
            text-align: left;
            font-weight: 700;
            color: #1e293b;
            border-bottom: 2px solid rgba(239, 68, 68, 0.3);
            white-space: nowrap;
            background: rgba(239, 68, 68, 0.1);
        }

        /* ë¶„ë¥˜ ì»¬ëŸ¼ ë„ˆë¹„ ì œí•œ */
        #expense-table th:first-child,
        #expense-table td:first-child {
            width: 160px;
            max-width: 160px;
        }

        .modal-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(239, 68, 68, 0.1);
            color: #334155;
        }

        .modal-table td[contenteditable="true"] {
            background: rgba(239, 68, 68, 0.05);
            border-radius: 4px;
            cursor: text;
            transition: all 0.2s ease;
        }

        .modal-table td[contenteditable="true"]:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        .modal-table td[contenteditable="true"]:focus {
            outline: 2px solid #EF4444;
            background: rgba(239, 68, 68, 0.15);
        }

        .modal-table tr:hover {
            background: rgba(239, 68, 68, 0.03);
        }

        /* ëŒ€ë¶„ë¥˜ ì»¬ëŸ¼ ìŠ¤íƒ€ì¼ */
        .modal-table td.category-col {
            font-weight: 600;
            color: #DC2626;
            background: rgba(239, 68, 68, 0.08);
        }

        .category-select {
            width: auto;
            min-width: 120px;
            padding: 8px 12px;
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.9);
            color: #1e293b;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .category-select:focus {
            outline: 2px solid #EF4444;
            background: #fff;
        }

        .category-select.support {
            background: rgba(239, 68, 68, 0.12);
            color: #DC2626;
            border-color: rgba(239, 68, 68, 0.4);
        }

        .category-select.discovery {
            background: rgba(139, 92, 246, 0.12);
            color: #8B5CF6;
            border-color: rgba(139, 92, 246, 0.4);
        }

        .category-select.general {
            background: rgba(16, 185, 129, 0.12);
            color: #10b981;
            border-color: rgba(16, 185, 129, 0.4);
        }

        /* ìˆœì„œ ì´ë™ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-move {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #3B82F6;
            padding: 4px 6px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin: 0 2px;
            transition: all 0.2s ease;
        }

        .btn-move:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: translateY(-1px);
        }

        .modal-actions {
            display: flex;
            gap: 8px;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .modal-actions-left {
            display: flex;
            gap: 8px;
        }

        .modal-actions-right {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 12px 30px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, #DC2626 0%, #F97316 100%);
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(239, 68, 68, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: #94a3b8;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .btn-add {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
            margin-bottom: 15px;
        }

        .btn-add:hover {
            background: rgba(16, 185, 129, 0.3);
        }

        .btn-excel {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
            padding: 6px 12px;
            font-size: 0.75rem;
            white-space: nowrap;
            min-width: 100px;
            border-radius: 6px;
        }

        .btn-excel:hover {
            background: rgba(34, 197, 94, 0.3);
        }

        .btn-excel i {
            font-size: 0.7rem;
            margin-right: 4px;
        }

        /* í•©ê³„ í–‰ ìŠ¤íƒ€ì¼ */
        .total-row {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-top: 2px solid #dc2626;
            font-weight: bold;
        }

        .total-row td {
            font-weight: bold !important;
            color: #1e293b !important;
            padding: 15px 12px !important;
            border-top: 2px solid #dc2626 !important;
        }

        .total-amount {
            color: #dc2626 !important;
            font-size: 1.1rem !important;
            font-weight: 900 !important;
            text-align: right !important;
        }

        /* ê¸ˆì•¡ ì»¬ëŸ¼ ì˜¤ë¥¸ìª½ ì •ë ¬ */
        .modal-table td:nth-child(2),
        .modal-table th:nth-child(2) {
            text-align: right !important;
        }

        /* contenteditable ê¸ˆì•¡ ì…€ë„ ì˜¤ë¥¸ìª½ ì •ë ¬ */
        .modal-table td[contenteditable="true"]:nth-child(2) {
            text-align: right !important;
        }

        .btn-delete {
            background: rgba(239, 68, 68, 0.1);
            color: #EF4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn-delete:hover {
            background: #EF4444;
            color: #fff;
            transform: scale(1.05);
        }

        .excel-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .excel-buttons-right {
            display: flex;
            gap: 10px;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .file-input-wrapper .btn {
            pointer-events: none;
        }

        /* Full Width Chart */
        .chart-full {
            grid-column: 1 / -1;
        }

        /* Data Table */
        .table-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            border: 1px solid rgba(239, 68, 68, 0.2);
            margin-top: 30px;
            overflow-x: auto;
            box-shadow: 0 2px 10px rgba(239, 68, 68, 0.08);
        }

        .table-container h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #1e293b;
            font-weight: 700;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: rgba(239, 68, 68, 0.1);
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 700;
            color: #1e293b;
            border-bottom: 2px solid rgba(239, 68, 68, 0.3);
        }

        td {
            padding: 15px;
            border-bottom: 1px solid rgba(239, 68, 68, 0.1);
            color: #334155;
        }

        tr:hover {
            background: rgba(239, 68, 68, 0.03);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }

            .stat-card .value {
                font-size: 1.5rem;
            }
        }

        /* Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stat-card, .chart-container, .table-container {
            animation: fadeIn 0.6s ease-out;
        }

        /* ğŸ­ í”„ë ˆì  í…Œì´ì…˜ ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        .presentation-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .presentation-btn {
            background: linear-gradient(135deg, #DC2626 0%, #F97316 100%);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
            min-width: 80px;
            text-align: center;
        }

        .presentation-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }

        .presentation-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            z-index: 9999;
            display: none;
            overflow: hidden;
        }

        .presentation-mode.active {
            display: block;
        }

        .presentation-slide {
            width: 100%;
            height: 100%;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 60px;
            box-sizing: border-box;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }

        .presentation-slide.active {
            display: flex;
        }

        .slide-content {
            max-width: 1200px;
            width: 100%;
            text-align: center;
            color: white;
        }

        .slide-title {
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #DC2626 0%, #F97316 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .slide-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
            margin: 60px 0;
        }

        .slide-stat {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .slide-stat-value {
            font-size: 3.5rem;
            font-weight: 700;
            color: #F97316;
            margin-bottom: 10px;
        }

        .slide-stat-label {
            font-size: 1.5rem;
            color: #cbd5e1;
        }

        .presentation-nav {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 10001;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .slide-indicator {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 10001;
        }

        .indicator-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .indicator-dot.active {
            background: #F97316;
            transform: scale(1.2);
        }

        /* âœ¨ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
        .animate-number {
            transition: all 0.5s ease;
        }

        .chart-container.animate {
            opacity: 1;
            transform: translateY(0);
        }

        /* ğŸ¨ ë‹¤í¬ëª¨ë“œ í† ê¸€ */
        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 10000;
        }

        .theme-toggle-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #1e293b;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .theme-toggle-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(180deg);
        }

        /* ë‹¤í¬ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        body.dark-mode {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: #e2e8f0;
        }

        .dark-mode .header {
            background: rgba(30, 41, 59, 0.8);
            border-color: rgba(249, 115, 22, 0.3);
        }

        .dark-mode .stat-card {
            background: rgba(30, 41, 59, 0.9);
            border-color: rgba(249, 115, 22, 0.3);
            color: #e2e8f0;
        }

        .dark-mode .quick-nav {
            background: rgba(30, 41, 59, 0.8);
            border-color: rgba(249, 115, 22, 0.3);
        }

        /* ğŸ“± ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 768px) {
            .presentation-controls {
                top: 10px;
                right: 10px;
                gap: 6px;
            }
            
            .presentation-btn {
                padding: 6px 10px;
                font-size: 10px;
                min-width: 70px;
            }
            
            .slide-title {
                font-size: 2.5rem;
            }
            
            .slide-stat-value {
                font-size: 2.5rem;
            }
            
            .slide-stats {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- ğŸ¨ í…Œë§ˆ í† ê¸€ -->
    <div class="theme-toggle">
        <button class="theme-toggle-btn" onclick="toggleTheme()" title="ë‹¤í¬ëª¨ë“œ í† ê¸€">
            <i class="fas fa-moon"></i>
        </button>
    </div>

    <!-- ğŸ­ í”„ë ˆì  í…Œì´ì…˜ ì»¨íŠ¸ë¡¤ -->
    <div class="presentation-controls">
        <button class="presentation-btn" onclick="startPresentation()" title="í”„ë ˆì  í…Œì´ì…˜ ëª¨ë“œ ì‹œì‘">
            <i class="fas fa-play"></i> ë°œí‘œ
        </button>
        <button class="presentation-btn" onclick="toggleAutoSlide()" title="ìë™ ìŠ¬ë¼ì´ë“œ í† ê¸€">
            <i class="fas fa-magic"></i> ìë™
        </button>
        <button class="presentation-btn" onclick="showKeyboardHelp()" title="í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ë„ì›€ë§">
            <i class="fas fa-keyboard"></i> ë„ì›€ë§
        </button>
    </div>

    <!-- ğŸ­ í”„ë ˆì  í…Œì´ì…˜ ëª¨ë“œ -->
    <div id="presentationMode" class="presentation-mode">
        <!-- ìŠ¬ë¼ì´ë“œ 1: íƒ€ì´í‹€ -->
        <div class="presentation-slide active">
            <div class="slide-content">
                <h1 class="slide-title">í”„ë¼ì´ë¨¸ ì „ëµíŒ€ ì›Œí¬ìƒµ</h1>
                <div class="slide-stats">
                    <div class="slide-stat">
                        <div class="slide-stat-value" data-countup="1830000000">0</div>
                        <div class="slide-stat-label">2025ë…„ ì´ ì§€ì¶œ (ì›)</div>
                    </div>
                    <div class="slide-stat">
                        <div class="slide-stat-value" data-countup="2250000000">0</div>
                        <div class="slide-stat-label">2025ë…„ ì´ ìˆ˜ì… (ì›)</div>
                    </div>
                    <div class="slide-stat">
                        <div class="slide-stat-value" data-countup="420000000">0</div>
                        <div class="slide-stat-label">2025ë…„ ì”ì•¡ (ì›)</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ìŠ¬ë¼ì´ë“œ 2: ì„±ì¥ë¥  -->
        <div class="presentation-slide">
            <div class="slide-content">
                <h2 class="slide-title">ì „ë…„ ëŒ€ë¹„ ì„±ì¥ë¥ </h2>
                <div class="slide-stats">
                    <div class="slide-stat">
                        <div class="slide-stat-value" style="color: #10b981;" data-countup="12.8">0</div>
                        <div class="slide-stat-label">ì§€ì¶œ ì¦ê°€ìœ¨ (%)</div>
                    </div>
                    <div class="slide-stat">
                        <div class="slide-stat-value" style="color: #10b981;" data-countup="18.5">0</div>
                        <div class="slide-stat-label">ìˆ˜ì… ì¦ê°€ìœ¨ (%)</div>
                    </div>
                    <div class="slide-stat">
                        <div class="slide-stat-value" style="color: #10b981;" data-countup="23.1">0</div>
                        <div class="slide-stat-label">ìˆœì´ìµ ì¦ê°€ìœ¨ (%)</div>
                    </div>
                </div>
                <p style="font-size: 1.5rem; color: #cbd5e1; margin-top: 40px;">
                    ğŸ“ˆ ëª¨ë“  ì§€í‘œì—ì„œ ë‘ ìë¦¿ìˆ˜ ì„±ì¥ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤
                </p>
            </div>
        </div>

        <!-- ìŠ¬ë¼ì´ë“œ 3: í•µì‹¬ ì¸ì‚¬ì´íŠ¸ -->
        <div class="presentation-slide">
            <div class="slide-content">
                <h2 class="slide-title">í•µì‹¬ ì¸ì‚¬ì´íŠ¸</h2>
                <div style="text-align: left; max-width: 800px; margin: 0 auto;">
                    <div style="background: rgba(255, 255, 255, 0.1); padding: 30px; border-radius: 15px; margin: 20px 0;">
                        <h3 style="color: #F97316; margin-bottom: 15px;">ğŸ’¡ ìˆ˜ìµì„± ê°œì„ </h3>
                        <p style="font-size: 1.3rem; line-height: 1.6;">ìˆ˜ì… ì¦ê°€ìœ¨(18.5%)ì´ ì§€ì¶œ ì¦ê°€ìœ¨(12.8%)ì„ í¬ê²Œ ìƒíšŒí•˜ì—¬ ê±´ì „í•œ ì„±ì¥ êµ¬ì¡°ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.1); padding: 30px; border-radius: 15px; margin: 20px 0;">
                        <h3 style="color: #F97316; margin-bottom: 15px;">ğŸ¯ íš¨ìœ¨ì  ìš´ì˜</h3>
                        <p style="font-size: 1.3rem; line-height: 1.6;">ìˆœì´ìµë¥ ì´ 23.1% ì¦ê°€í•˜ì—¬ ìš´ì˜ íš¨ìœ¨ì„±ì´ í¬ê²Œ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.1); padding: 30px; border-radius: 15px; margin: 20px 0;">
                        <h3 style="color: #F97316; margin-bottom: 15px;">ğŸš€ ì§€ì† ì„±ì¥</h3>
                        <p style="font-size: 1.3rem; line-height: 1.6;">7ë…„ ì—°ì† ì„±ì¥ì„¸ë¥¼ ìœ ì§€í•˜ë©° ì•ˆì •ì ì¸ ì„±ì¥ ê¶¤ë„ì— ì§„ì…í–ˆìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="presentation-nav">
            <button class="nav-btn" onclick="prevSlide()">
                <i class="fas fa-chevron-left"></i> ì´ì „
            </button>
            <button class="nav-btn" onclick="exitPresentation()">
                <i class="fas fa-times"></i> ì¢…ë£Œ
            </button>
            <button class="nav-btn" onclick="nextSlide()">
                ë‹¤ìŒ <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <!-- ìŠ¬ë¼ì´ë“œ ì¸ë””ì¼€ì´í„° -->
        <div class="slide-indicator">
            <div class="indicator-dot active" onclick="goToSlide(0)"></div>
            <div class="indicator-dot" onclick="goToSlide(1)"></div>
            <div class="indicator-dot" onclick="goToSlide(2)"></div>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header" data-aos="fade-down" data-aos-duration="1000">
            <h1 onclick="location.reload()">í”„ë¼ì´ë¨¸ ì „ëµíŒ€ ì›Œí¬ìƒµ</h1>
        </div>

        <!-- Quick Navigation -->
        <div class="quick-nav" data-aos="fade-up" data-aos-delay="200">
            <h3><i class="fas fa-compass"></i> ë¹ ë¥¸ ì´ë™</h3>
            <div class="quick-nav-buttons">
                <button class="quick-nav-btn" onclick="scrollToSection('expense-structure')">
                    <i class="fas fa-layer-group"></i>
                    ì§€ì¶œ êµ¬ì¡°
                </button>
                <button class="quick-nav-btn" onclick="scrollToSection('yearly-trend')">
                    <i class="fas fa-chart-line"></i>
                    í•­ëª©ë³„ ì˜ˆì‚° ì¶”ì´
                </button>
                <button class="quick-nav-btn" onclick="scrollToSection('revenue-forecast')">
                    <i class="fas fa-crystal-ball"></i>
                    ìˆ˜ì… ì˜ˆì¸¡
                </button>
                <button class="quick-nav-btn" onclick="scrollToSection('change-history')">
                    <i class="fas fa-balance-scale"></i>
                    ì—°ë„ë³„ ë³€ë™ ë‚´ì—­
                </button>
                <button class="quick-nav-btn" onclick="scrollToSection('detail-table')">
                    <i class="fas fa-table"></i>
                    ìƒì„¸ ë‚´ì—­ í…Œì´ë¸”
                </button>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card" data-modal="expense" data-aos="fade-up" data-aos-delay="100">
                <div class="icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h3>2025ë…„ ì´ ì§€ì¶œ</h3>
                <div class="value animate-number" data-countup="1830000000">1,830,000,000ì›</div>
                <div class="change positive">
                    <i class="fas fa-arrow-up"></i>
                    <span>+12.8% ì „ë…„ ëŒ€ë¹„</span>
                </div>
            </div>

            <div class="stat-card" data-modal="income" data-aos="fade-up" data-aos-delay="200">
                <div class="icon">
                    <i class="fas fa-coins"></i>
                </div>
                <h3>2025ë…„ ì´ ìˆ˜ì…</h3>
                <div class="value animate-number" data-countup="2250000000">2,250,000,000ì›</div>
                <div class="change positive">
                    <i class="fas fa-arrow-up"></i>
                    <span>+18.5% ì „ë…„ ëŒ€ë¹„</span>
                </div>
            </div>

            <div class="stat-card" data-modal="balance" data-aos="fade-up" data-aos-delay="300">
                <div class="icon">
                    <i class="fas fa-piggy-bank"></i>
                </div>
                <h3>2025ë…„ ì”ì•¡</h3>
                <div class="value animate-number" data-countup="420000000">420,000,000ì›</div>
                <div class="change positive">
                    <i class="fas fa-arrow-up"></i>
                    <span>+23.1% ì „ë…„ ëŒ€ë¹„</span>
                </div>
            </div>
        </div>

        <!-- ğŸ¯ ì¸ì‚¬ì´íŠ¸ ë° ë¶„ì„ ì„¹ì…˜ -->
        <div class="insight-section" data-aos="fade-up" data-aos-delay="100" style="margin: 40px 0; padding: 40px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-radius: 20px; border: 1px solid rgba(239, 68, 68, 0.2);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h2 style="color: #1e293b; margin: 0;">
                    <i class="fas fa-robot" style="color: #F97316;"></i> 
                    ì‹¤ì‹œê°„ AI ë¶„ì„ ì¸ì‚¬ì´íŠ¸
                </h2>
                <div style="display: flex; gap: 10px;">
                    <button id="refreshAnalysis" class="presentation-btn" style="padding: 8px 16px; font-size: 12px;" onclick="refreshAIAnalysis()" title="ë¶„ì„ ìƒˆë¡œê³ ì¹¨">
                        <i class="fas fa-sync-alt"></i> ë¶„ì„ ê°±ì‹ 
                    </button>
                    <button class="presentation-btn" style="padding: 8px 16px; font-size: 12px;" onclick="exportAnalysisReport()" title="ë¶„ì„ ë³´ê³ ì„œ ë‚´ë³´ë‚´ê¸°">
                        <i class="fas fa-download"></i> ë³´ê³ ì„œ
                    </button>
                </div>
            </div>
            
            <!-- ë°ì´í„° ìƒíƒœ í‘œì‹œ -->
            <div id="dataStatus" style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 10px; padding: 15px; margin-bottom: 20px; display: none;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-info-circle" style="color: #0ea5e9;"></i>
                    <span id="dataStatusText">ë°ì´í„° ë¶„ì„ ì¤‘...</span>
                </div>
            </div>
            
            <div id="insightGrid" class="insight-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ì¸ì‚¬ì´íŠ¸ ì¹´ë“œë“¤ -->
            </div>
            
            <!-- ì‹¤ì‹œê°„ KPI ìš”ì•½ -->
            <div id="kpiSummary" class="kpi-summary" data-aos="zoom-in" data-aos-delay="500" style="margin-top: 30px; padding: 25px; background: linear-gradient(135deg, #DC2626 0%, #F97316 100%); border-radius: 15px; color: white; text-align: center;">
                <h3 style="margin-bottom: 20px;"><i class="fas fa-trophy"></i> í•µì‹¬ ì„±ê³¼ ì§€í‘œ (KPI)</h3>
                <div id="kpiGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px;">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” KPI ì§€í‘œë“¤ -->
                </div>
            </div>
        </div>

        <!-- Modals -->
        <!-- ì´ ì§€ì¶œ ëª¨ë‹¬ -->
        <div id="expense-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-chart-line"></i> ì´ ì§€ì¶œ ìƒì„¸</h2>
                    <div class="modal-header-actions">
                        <button class="modal-goto-btn" onclick="goToYearlyComparison()" title="ì—°ë„ë³„ ë¹„êµ í‘œë¡œ ì´ë™">
                            <i class="fas fa-table"></i>
                        </button>
                        <button class="modal-close" onclick="closeModal('expense-modal')">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <!-- ì—°ë„ íƒ­ -->
                <div class="year-tabs">
                    <button class="year-tab-button active" data-year="2025" onclick="switchExpenseYear('2025')">2025</button>
                    <button class="year-tab-button" data-year="2024" onclick="switchExpenseYear('2024')">2024</button>
                    <button class="year-tab-button" data-year="2023" onclick="switchExpenseYear('2023')">2023</button>
                    <button class="year-tab-button" data-year="2022" onclick="switchExpenseYear('2022')">2022</button>
                    <button class="year-tab-button" data-year="2021" onclick="switchExpenseYear('2021')">2021</button>
                    <button class="year-tab-button" data-year="2020" onclick="switchExpenseYear('2020')">2020</button>
                    <button class="year-tab-button" data-year="2019" onclick="switchExpenseYear('2019')">2019</button>
                </div>

                <div class="modal-table-container">
                    <div class="excel-buttons">
                        <button class="btn btn-add" onclick="addExpenseRow()">
                            <i class="fas fa-plus"></i> í•­ëª© ì¶”ê°€
                        </button>
                        <div class="excel-buttons-right">
                            <button class="btn btn-excel" onclick="downloadExpenseTemplate()" style="background: rgba(139, 92, 246, 0.2); color: #8B5CF6; border-color: rgba(139, 92, 246, 0.3);">
                                <i class="fas fa-file-download"></i> ì–‘ì‹ ë‹¤ìš´ë¡œë“œ
                            </button>
                            <div class="file-input-wrapper">
                                <button class="btn btn-excel">
                                    <i class="fas fa-upload"></i> ì—‘ì…€ ì—…ë¡œë“œ
                                </button>
                                <input type="file" id="expense-upload" accept=".xlsx, .xls" onchange="uploadExpenseExcel(event)">
                            </div>
                            <button class="btn btn-excel" onclick="downloadExpenseExcel()">
                                <i class="fas fa-download"></i> ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
                            </button>
                        </div>
                        <div class="modal-actions">
                            <div class="modal-actions-left">
                                <button class="btn btn-excel" onclick="clearAllData()" style="background: rgba(239, 68, 68, 0.2); color: #EF4444; border-color: rgba(239, 68, 68, 0.3);" title="ëª¨ë“  ë°ì´í„°ë¥¼ ì™„ì „íˆ ì‚­ì œí•©ë‹ˆë‹¤">
                                    <i class="fas fa-trash-alt"></i> ì „ì²´ ì‚­ì œ
                                </button>
                            </div>
                            <div class="modal-actions-right">
                                <button class="btn btn-secondary" onclick="closeModal('expense-modal')">ì·¨ì†Œ</button>
                                <button class="btn btn-primary" onclick="saveExpenseData()">ì €ì¥</button>
                            </div>
                        </div>
                    </div>
                    <table class="modal-table" id="expense-table">
                        <thead>
                            <tr>
                                <th>ë¶„ë¥˜</th>
                                <th>ìƒì„¸ë¶„ë¥˜</th>
                                <th>ê¸ˆì•¡ (ì›)</th>
                                <th>ë¹„ê³ </th>
                                <th style="width: 80px;">ìˆœì„œ</th>
                                <th style="width: 80px;">ì‚­ì œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <select class="category-select support" onchange="updateCategoryClass(this)">
                                        <option value="ì§€ì›" selected>ì§€ì›</option>
                                        <option value="ë°œêµ´">ë°œêµ´</option>
                                        <option value="ì¼ë°˜ê´€ë¦¬ë¹„">ì¼ë°˜ê´€ë¦¬ë¹„</option>
                                    </select>
                                </td>
                                <td contenteditable="true">ë©˜í† ë§ë¹„</td>
                                <td contenteditable="true">350</td>
                                <td contenteditable="true">ìŠ¤íƒ€íŠ¸ì—… ë©˜í† ë§ í”„ë¡œê·¸ë¨</td>
                                <td>
                                    <button class="btn-move" onclick="moveRowUp(this)" title="ìœ„ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="btn-move" onclick="moveRowDown(this)" title="ì•„ë˜ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </td>
                                <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                            </tr>
                            <tr>
                                <td>
                                    <select class="category-select support" onchange="updateCategoryClass(this)">
                                        <option value="ì§€ì›" selected>ì§€ì›</option>
                                        <option value="ë°œêµ´">ë°œêµ´</option>
                                        <option value="ì¼ë°˜ê´€ë¦¬ë¹„">ì¼ë°˜ê´€ë¦¬ë¹„</option>
                                    </select>
                                </td>
                                <td contenteditable="true">êµìœ¡ì§€ì›ë¹„</td>
                                <td contenteditable="true">280</td>
                                <td contenteditable="true">êµìœ¡ í”„ë¡œê·¸ë¨ ìš´ì˜</td>
                                <td>
                                    <button class="btn-move" onclick="moveRowUp(this)" title="ìœ„ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="btn-move" onclick="moveRowDown(this)" title="ì•„ë˜ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </td>
                                <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                            </tr>
                            <tr>
                                <td>
                                    <select class="category-select support" onchange="updateCategoryClass(this)">
                                        <option value="ì§€ì›" selected>ì§€ì›</option>
                                        <option value="ë°œêµ´">ë°œêµ´</option>
                                        <option value="ì¼ë°˜ê´€ë¦¬ë¹„">ì¼ë°˜ê´€ë¦¬ë¹„</option>
                                    </select>
                                </td>
                                <td contenteditable="true">ê³µê°„ì§€ì›ë¹„</td>
                                <td contenteditable="true">210</td>
                                <td contenteditable="true">ì‚¬ë¬´ ê³µê°„ ì œê³µ</td>
                                <td>
                                    <button class="btn-move" onclick="moveRowUp(this)" title="ìœ„ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="btn-move" onclick="moveRowDown(this)" title="ì•„ë˜ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </td>
                                <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                            </tr>
                            <tr>
                                <td>
                                    <select class="category-select discovery" onchange="updateCategoryClass(this)">
                                        <option value="ì§€ì›">ì§€ì›</option>
                                        <option value="ë°œêµ´" selected>ë°œêµ´</option>
                                        <option value="ì¼ë°˜ê´€ë¦¬ë¹„">ì¼ë°˜ê´€ë¦¬ë¹„</option>
                                    </select>
                                </td>
                                <td contenteditable="true">ë„¤íŠ¸ì›Œí‚¹ í–‰ì‚¬</td>
                                <td contenteditable="true">220</td>
                                <td contenteditable="true">ì°½ì—…ì ë„¤íŠ¸ì›Œí‚¹ ì´ë²¤íŠ¸</td>
                                <td>
                                    <button class="btn-move" onclick="moveRowUp(this)" title="ìœ„ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="btn-move" onclick="moveRowDown(this)" title="ì•„ë˜ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </td>
                                <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                            </tr>
                            <tr>
                                <td>
                                    <select class="category-select general" onchange="updateCategoryClass(this)">
                                        <option value="ì§€ì›">ì§€ì›</option>
                                        <option value="ë°œêµ´">ë°œêµ´</option>
                                        <option value="ì¼ë°˜ê´€ë¦¬ë¹„" selected>ì¼ë°˜ê´€ë¦¬ë¹„</option>
                                    </select>
                                </td>
                                <td contenteditable="true">ì¸ê±´ë¹„</td>
                                <td contenteditable="true">450</td>
                                <td contenteditable="true">ì§ì› ê¸‰ì—¬</td>
                                <td>
                                    <button class="btn-move" onclick="moveRowUp(this)" title="ìœ„ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="btn-move" onclick="moveRowDown(this)" title="ì•„ë˜ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </td>
                                <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                            </tr>
                            <tr>
                                <td>
                                    <select class="category-select general" onchange="updateCategoryClass(this)">
                                        <option value="ì§€ì›">ì§€ì›</option>
                                        <option value="ë°œêµ´">ë°œêµ´</option>
                                        <option value="ì¼ë°˜ê´€ë¦¬ë¹„" selected>ì¼ë°˜ê´€ë¦¬ë¹„</option>
                                    </select>
                                </td>
                                <td contenteditable="true">ì‚¬ë¬´ì‹¤ ì„ì°¨ë£Œ</td>
                                <td contenteditable="true">210</td>
                                <td contenteditable="true">ì›”ì„¸ ë° ê´€ë¦¬ë¹„</td>
                                <td>
                                    <button class="btn-move" onclick="moveRowUp(this)" title="ìœ„ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="btn-move" onclick="moveRowDown(this)" title="ì•„ë˜ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </td>
                                <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeModal('expense-modal')">ì·¨ì†Œ</button>
                    <button class="btn btn-primary" onclick="saveExpenseData()">ì €ì¥</button>
                </div>
            </div>
        </div>

        <!-- ì´ ìˆ˜ì… ëª¨ë‹¬ -->
        <div id="income-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-coins"></i> ì´ ìˆ˜ì… ìƒì„¸</h2>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <button class="btn btn-excel" onclick="scrollToIncomeChart()" style="background: rgba(59, 130, 246, 0.2); color: #3B82F6; border-color: rgba(59, 130, 246, 0.3); padding: 8px 12px;" title="ìˆ˜ì… ë‚´ì—­ ë° í–¥í›„ ì˜ˆì¸¡ ê·¸ë˜í”„ë¡œ ì´ë™">
                            <i class="fas fa-chart-line"></i> ê·¸ë˜í”„ ë³´ê¸°
                        </button>
                        <button class="modal-close" onclick="closeModal('income-modal')">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <!-- ì—°ë„ íƒ­ -->
                <div class="year-tabs">
                    <button class="year-tab-button-income active" data-year="2025" onclick="switchIncomeYear('2025')">2025</button>
                    <button class="year-tab-button-income" data-year="2024" onclick="switchIncomeYear('2024')">2024</button>
                    <button class="year-tab-button-income" data-year="2023" onclick="switchIncomeYear('2023')">2023</button>
                    <button class="year-tab-button-income" data-year="2022" onclick="switchIncomeYear('2022')">2022</button>
                    <button class="year-tab-button-income" data-year="2021" onclick="switchIncomeYear('2021')">2021</button>
                    <button class="year-tab-button-income" data-year="2020" onclick="switchIncomeYear('2020')">2020</button>
                    <button class="year-tab-button-income" data-year="2019" onclick="switchIncomeYear('2019')">2019</button>
                </div>

                <div class="modal-table-container">
                    <div class="excel-buttons">
                        <button class="btn btn-add" onclick="addIncomeRow()">
                            <i class="fas fa-plus"></i> í•­ëª© ì¶”ê°€
                        </button>
                        <div class="excel-buttons-right">
                            <button class="btn btn-excel" onclick="downloadIncomeTemplate()" style="background: rgba(139, 92, 246, 0.2); color: #8B5CF6; border-color: rgba(139, 92, 246, 0.3);">
                                <i class="fas fa-file-download"></i> ì–‘ì‹ ë‹¤ìš´ë¡œë“œ
                            </button>
                            <div class="file-input-wrapper">
                                <button class="btn btn-excel">
                                    <i class="fas fa-upload"></i> ì—‘ì…€ ì—…ë¡œë“œ
                                </button>
                                <input type="file" id="income-upload" accept=".xlsx, .xls" onchange="uploadIncomeExcel(event)">
                            </div>
                            <button class="btn btn-excel" onclick="downloadIncomeExcel()">
                                <i class="fas fa-download"></i> ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
                            </button>
                        </div>
                        <div class="modal-actions">
                            <div class="modal-actions-left">
                                <button class="btn btn-excel" onclick="clearAllData()" style="background: rgba(239, 68, 68, 0.2); color: #EF4444; border-color: rgba(239, 68, 68, 0.3);" title="ëª¨ë“  ë°ì´í„°ë¥¼ ì™„ì „íˆ ì‚­ì œí•©ë‹ˆë‹¤">
                                    <i class="fas fa-trash-alt"></i> ì „ì²´ ì‚­ì œ
                                </button>
                            </div>
                            <div class="modal-actions-right">
                                <button class="btn btn-secondary" onclick="closeModal('income-modal')">ì·¨ì†Œ</button>
                                <button class="btn btn-primary" onclick="saveIncomeData()">ì €ì¥</button>
                            </div>
                        </div>
                    </div>
                    <table class="modal-table" id="income-table">
                        <thead>
                            <tr>
                                <th>ìƒì„¸ë¶„ë¥˜</th>
                                <th>ê¸ˆì•¡ (ì›)</th>
                                <th>ìˆ˜ì…ì›</th>
                                <th>ë¹„ê³ </th>
                                <th style="width: 80px;">ìˆœì„œ</th>
                                <th style="width: 80px;">ì‚­ì œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td contenteditable="true">ì •ë¶€ì§€ì›ì‚¬ì—…</td>
                                <td contenteditable="true">850,000,000</td>
                                <td contenteditable="true">ì •ë¶€ì§€ì›ì‚¬ì—…</td>
                                <td contenteditable="true"></td>
                                <td>
                                    <button class="btn-move" onclick="moveRowUp(this)" title="ìœ„ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="btn-move" onclick="moveRowDown(this)" title="ì•„ë˜ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </td>
                                <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                            </tr>
                            <tr>
                                <td contenteditable="true">ê´€ë¦¬ë³´ìˆ˜</td>
                                <td contenteditable="true">620,000,000</td>
                                <td contenteditable="true">ê´€ë¦¬ë³´ìˆ˜</td>
                                <td contenteditable="true"></td>
                                <td>
                                    <button class="btn-move" onclick="moveRowUp(this)" title="ìœ„ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="btn-move" onclick="moveRowDown(this)" title="ì•„ë˜ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </td>
                                <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                            </tr>
                            <tr>
                                <td contenteditable="true">ê´€ë¦¬ë³´ìˆ˜</td>
                                <td contenteditable="true">380,000,000</td>
                                <td contenteditable="true">ê´€ë¦¬ë³´ìˆ˜</td>
                                <td contenteditable="true"></td>
                                <td>
                                    <button class="btn-move" onclick="moveRowUp(this)" title="ìœ„ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="btn-move" onclick="moveRowDown(this)" title="ì•„ë˜ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </td>
                                <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                            </tr>
                            <tr>
                                <td contenteditable="true">ê´€ë¦¬ë³´ìˆ˜</td>
                                <td contenteditable="true">250,000,000</td>
                                <td contenteditable="true">ê´€ë¦¬ë³´ìˆ˜</td>
                                <td contenteditable="true"></td>
                                <td>
                                    <button class="btn-move" onclick="moveRowUp(this)" title="ìœ„ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="btn-move" onclick="moveRowDown(this)" title="ì•„ë˜ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </td>
                                <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                            </tr>
                            <tr>
                                <td contenteditable="true">ê´€ë¦¬ë³´ìˆ˜</td>
                                <td contenteditable="true">150,000,000</td>
                                <td contenteditable="true">ê´€ë¦¬ë³´ìˆ˜</td>
                                <td contenteditable="true"></td>
                                <td>
                                    <button class="btn-move" onclick="moveRowUp(this)" title="ìœ„ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="btn-move" onclick="moveRowDown(this)" title="ì•„ë˜ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </td>
                                <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeModal('income-modal')">ì·¨ì†Œ</button>
                    <button class="btn btn-primary" onclick="saveIncomeData()">ì €ì¥</button>
                </div>
            </div>
        </div>

        <!-- ì”ì•¡ ëª¨ë‹¬ -->
        <div id="balance-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-piggy-bank"></i> ì”ì•¡ ìƒì„¸</h2>
                    <button class="modal-close" onclick="closeModal('balance-modal')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-table-container">
                    <div class="excel-buttons">
                        <button class="btn btn-add" onclick="addBalanceRow()">
                            <i class="fas fa-plus"></i> í•­ëª© ì¶”ê°€
                        </button>
                        <div class="excel-buttons-right">
                            <button class="btn btn-excel" onclick="downloadBalanceTemplate()" style="background: rgba(139, 92, 246, 0.2); color: #8B5CF6; border-color: rgba(139, 92, 246, 0.3);">
                                <i class="fas fa-file-download"></i> ì–‘ì‹ ë‹¤ìš´ë¡œë“œ
                            </button>
                            <div class="file-input-wrapper">
                                <button class="btn btn-excel">
                                    <i class="fas fa-upload"></i> ì—‘ì…€ ì—…ë¡œë“œ
                                </button>
                                <input type="file" id="balance-upload" accept=".xlsx, .xls" onchange="uploadBalanceExcel(event)">
                            </div>
                            <button class="btn btn-excel" onclick="downloadBalanceExcel()">
                                <i class="fas fa-download"></i> ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
                            </button>
                        </div>
                        <div class="modal-actions">
                            <div class="modal-actions-left">
                                <button class="btn btn-excel" onclick="clearAllData()" style="background: rgba(239, 68, 68, 0.2); color: #EF4444; border-color: rgba(239, 68, 68, 0.3);" title="ëª¨ë“  ë°ì´í„°ë¥¼ ì™„ì „íˆ ì‚­ì œí•©ë‹ˆë‹¤">
                                    <i class="fas fa-trash-alt"></i> ì „ì²´ ì‚­ì œ
                                </button>
                            </div>
                            <div class="modal-actions-right">
                                <button class="btn btn-secondary" onclick="closeModal('balance-modal')">ì·¨ì†Œ</button>
                                <button class="btn btn-primary" onclick="saveBalanceData()">ì €ì¥</button>
                            </div>
                        </div>
                    </div>
                    <table class="modal-table" id="balance-table">
                        <thead>
                            <tr>
                                <th>ê³„ì¢Œ/í•­ëª©</th>
                                <th>ì”ì•¡ (ë°±ë§Œì›)</th>
                                <th>ì¢…ë¥˜</th>
                                <th>ë¹„ê³ </th>
                                <th style="width: 80px;">ìˆœì„œ</th>
                                <th style="width: 80px;">ì‚­ì œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td contenteditable="true">ìš´ì˜ìê¸ˆ ê³„ì¢Œ</td>
                                <td contenteditable="true">210</td>
                                <td contenteditable="true">ì˜ˆê¸ˆ</td>
                                <td contenteditable="true">ì¼ìƒ ìš´ì˜ ìê¸ˆ</td>
                                <td>
                                    <button class="btn-move" onclick="moveRowUp(this)" title="ìœ„ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="btn-move" onclick="moveRowDown(this)" title="ì•„ë˜ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </td>
                                <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                            </tr>
                            <tr>
                                <td contenteditable="true">íˆ¬ì í€ë“œ</td>
                                <td contenteditable="true">150</td>
                                <td contenteditable="true">íˆ¬ì</td>
                                <td contenteditable="true">ìŠ¤íƒ€íŠ¸ì—… íˆ¬ìê¸ˆ</td>
                                <td>
                                    <button class="btn-move" onclick="moveRowUp(this)" title="ìœ„ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="btn-move" onclick="moveRowDown(this)" title="ì•„ë˜ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </td>
                                <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                            </tr>
                            <tr>
                                <td contenteditable="true">ì ë¦½ê¸ˆ</td>
                                <td contenteditable="true">60</td>
                                <td contenteditable="true">ì˜ˆê¸ˆ</td>
                                <td contenteditable="true">ë¹„ìƒ ì¤€ë¹„ê¸ˆ</td>
                                <td>
                                    <button class="btn-move" onclick="moveRowUp(this)" title="ìœ„ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="btn-move" onclick="moveRowDown(this)" title="ì•„ë˜ë¡œ ì´ë™">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </td>
                                <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeModal('balance-modal')">ì·¨ì†Œ</button>
                    <button class="btn btn-primary" onclick="saveBalanceData()">ì €ì¥</button>
                </div>
            </div>
        </div>

        <!-- ìƒì„¸ ë‚´ì—­ ëª¨ë‹¬ (ë“œë¦´ë‹¤ìš´) -->
        <div id="detail-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-list-alt"></i> <span id="detail-modal-title">ìƒì„¸ ë‚´ì—­</span></h2>
                    <button class="modal-close" onclick="closeModal('detail-modal')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <!-- ì—°ë„ íƒ­ -->
                <div class="year-tabs">
                    <button class="year-tab-button active" data-year="2025" onclick="switchDetailYear('2025')">2025</button>
                    <button class="year-tab-button" data-year="2024" onclick="switchDetailYear('2024')">2024</button>
                    <button class="year-tab-button" data-year="2023" onclick="switchDetailYear('2023')">2023</button>
                    <button class="year-tab-button" data-year="2022" onclick="switchDetailYear('2022')">2022</button>
                    <button class="year-tab-button" data-year="2021" onclick="switchDetailYear('2021')">2021</button>
                    <button class="year-tab-button" data-year="2020" onclick="switchDetailYear('2020')">2020</button>
                    <button class="year-tab-button" data-year="2019" onclick="switchDetailYear('2019')">2019</button>
                </div>

                <div class="modal-table-container">
                    <div class="excel-buttons">
                        <button class="btn btn-add" onclick="addDetailRow()">
                            <i class="fas fa-plus"></i> í•­ëª© ì¶”ê°€
                        </button>
                        <div class="excel-buttons-right">
                            <button class="btn btn-excel" onclick="downloadDetailTemplate()" style="background: rgba(139, 92, 246, 0.2); color: #8B5CF6; border-color: rgba(139, 92, 246, 0.3);">
                                <i class="fas fa-file-download"></i> ì–‘ì‹ ë‹¤ìš´ë¡œë“œ
                            </button>
                            <div class="file-input-wrapper">
                                <button class="btn btn-excel">
                                    <i class="fas fa-upload"></i> ì—‘ì…€ ì—…ë¡œë“œ
                                </button>
                                <input type="file" id="detail-upload" accept=".xlsx, .xls" onchange="uploadDetailExcel(event)">
                            </div>
                            <button class="btn btn-excel" onclick="downloadDetailExcel()">
                                <i class="fas fa-download"></i> ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
                            </button>
                        </div>
                        <div class="modal-actions">
                            <div class="modal-actions-left">
                                <button class="btn btn-excel" onclick="clearAllData()" style="background: rgba(239, 68, 68, 0.2); color: #EF4444; border-color: rgba(239, 68, 68, 0.3);" title="ëª¨ë“  ë°ì´í„°ë¥¼ ì™„ì „íˆ ì‚­ì œí•©ë‹ˆë‹¤">
                                    <i class="fas fa-trash-alt"></i> ì „ì²´ ì‚­ì œ
                                </button>
                            </div>
                            <div class="modal-actions-right">
                                <button class="btn btn-secondary" onclick="closeModal('detail-modal')">ì·¨ì†Œ</button>
                                <button class="btn btn-primary" onclick="saveDetailData()">ì €ì¥</button>
                            </div>
                        </div>
                    </div>
                    <div style="overflow-x: auto; overflow-y: hidden; max-height: 500px;">
                        <style>
                            /* ìŠ¤í¬ë¡¤ë°” í•­ìƒ í‘œì‹œ */
                            .modal-table-container::-webkit-scrollbar {
                                height: 12px;
                            }
                            .modal-table-container::-webkit-scrollbar-track {
                                background: #f1f1f1;
                                border-radius: 6px;
                            }
                            .modal-table-container::-webkit-scrollbar-thumb {
                                background: #3B82F6;
                                border-radius: 6px;
                            }
                            .modal-table-container::-webkit-scrollbar-thumb:hover {
                                background: #2563EB;
                            }
                        </style>
                        <div class="modal-table-container" style="overflow-x: scroll; overflow-y: hidden; padding-bottom: 10px;">
                            <table class="modal-table" id="detail-table" style="min-width: 1500px;">
                                <thead>
                                    <tr>
                                        <th style="min-width: 120px; position: sticky; left: 0; background: white; z-index: 10; box-shadow: 2px 0 5px rgba(0,0,0,0.05);">ì†Œë¶„ë¥˜</th>
                                        <th style="min-width: 100px; background: rgba(59, 130, 246, 0.1); font-weight: 700;">ì´ì•¡</th>
                                        <th style="min-width: 70px;">1ì›”</th>
                                        <th style="min-width: 70px;">2ì›”</th>
                                        <th style="min-width: 70px;">3ì›”</th>
                                        <th style="min-width: 70px;">4ì›”</th>
                                        <th style="min-width: 70px;">5ì›”</th>
                                        <th style="min-width: 70px;">6ì›”</th>
                                        <th style="min-width: 70px;">7ì›”</th>
                                        <th style="min-width: 70px;">8ì›”</th>
                                        <th style="min-width: 70px;">9ì›”</th>
                                        <th style="min-width: 70px;">10ì›”</th>
                                        <th style="min-width: 70px;">11ì›”</th>
                                        <th style="min-width: 70px;">12ì›”</th>
                                        <th style="min-width: 150px;">ë¹„ê³ </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeModal('detail-modal')">ì·¨ì†Œ</button>
                    <button class="btn btn-primary" onclick="saveDetailData()">ì €ì¥</button>
                </div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="chart-grid" id="expense-structure">
            <!-- ì§€ì¶œ êµ¬ì¡° (íƒ­) -->
            <div class="chart-container chart-full">
                <h2>
                    <i class="fas fa-layer-group"></i>
                    ì§€ì¶œ êµ¬ì¡°
                </h2>

                <!-- ì—°ë„ íƒ­ -->
                <div class="year-tabs">
                    <button class="year-tab-button-chart active" data-year="2025" onclick="switchExpenseChartYear('2025')">2025</button>
                    <button class="year-tab-button-chart" data-year="2024" onclick="switchExpenseChartYear('2024')">2024</button>
                    <button class="year-tab-button-chart" data-year="2023" onclick="switchExpenseChartYear('2023')">2023</button>
                    <button class="year-tab-button-chart" data-year="2022" onclick="switchExpenseChartYear('2022')">2022</button>
                    <button class="year-tab-button-chart" data-year="2021" onclick="switchExpenseChartYear('2021')">2021</button>
                    <button class="year-tab-button-chart" data-year="2020" onclick="switchExpenseChartYear('2020')">2020</button>
                    <button class="year-tab-button-chart" data-year="2019" onclick="switchExpenseChartYear('2019')">2019</button>
                </div>

                <!-- ëŒ€ë¶„ë¥˜ ë¹„êµ ì°¨íŠ¸ -->
                <div style="background: rgba(255, 255, 255, 0.95); border-radius: 16px; padding: 25px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
                    <h3 style="font-size: 1.1rem; color: #1e293b; margin-bottom: 10px; font-weight: 600;">
                        <i class="fas fa-chart-pie"></i> ì§€ì¶œ êµ¬ì¡° (í´ë¦­í•˜ì—¬ ìƒì„¸ ë³´ê¸°)
                    </h3>
                    <p style="font-size: 0.85rem; color: #64748b; margin-bottom: 20px;">
                        ğŸ’¡ ì°¨íŠ¸ë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ ë¶„ë¥˜ì˜ ìƒì„¸ ë‚´ì—­ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                    </p>
                    <div style="max-height: 300px; position: relative; cursor: pointer;">
                        <canvas id="categoryComparisonChart" data-aos="fade-up" data-aos-delay="100"></canvas>
                    </div>
                </div>

                <div class="tabs-container">
                    <div class="tabs" style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; gap: 10px;">
                            <button class="tab-button active" data-tab="support">ì§€ì›</button>
                            <button class="tab-button" data-tab="discovery">ë°œêµ´</button>
                            <button class="tab-button" data-tab="general">ì¼ë°˜ê´€ë¦¬ë¹„</button>
                        </div>
                        <!-- ì˜µì…˜ 2: ì°¨íŠ¸/í‘œ ì „í™˜ í† ê¸€ ë²„íŠ¼ -->
                        <div style="display: flex; gap: 5px; background: rgba(59, 130, 246, 0.1); padding: 4px; border-radius: 8px;">
                            <button id="view-chart-btn" class="view-toggle-btn active" onclick="switchView('chart')" style="padding: 6px 12px; border: none; background: #3B82F6; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: all 0.3s;">
                                <i class="fas fa-chart-pie"></i> ì°¨íŠ¸
                            </button>
                            <button id="view-table-btn" class="view-toggle-btn" onclick="switchView('table')" style="padding: 6px 12px; border: none; background: transparent; color: #64748b; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: all 0.3s;">
                                <i class="fas fa-table"></i> í‘œ
                            </button>
                        </div>
                    </div>
                    <div class="tab-content active" id="support-tab">
                        <div style="max-height: 350px; position: relative;">
                            <canvas id="supportChart" data-aos="zoom-in" data-aos-delay="200"></canvas>
                        </div>
                        <!-- ì˜µì…˜ 1: ì°¨íŠ¸ ì•„ë˜ ìƒì„¸ í‘œ -->
                        <div class="expense-detail-table" style="margin-top: 30px;">
                            <h3 style="font-size: 1.1rem; color: #3B82F6; margin-bottom: 15px;">
                                <i class="fas fa-list"></i> ì§€ì› ìƒì„¸ ë‚´ì—­
                            </h3>
                            <table id="support-detail-table" style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: rgba(59, 130, 246, 0.1); border-bottom: 2px solid rgba(59, 130, 246, 0.3);">
                                        <th style="padding: 12px; text-align: left; color: #3B82F6; font-weight: 600;">ìƒì„¸ë¶„ë¥˜</th>
                                        <th style="padding: 12px; text-align: right; color: #3B82F6; font-weight: 600;">ê¸ˆì•¡ (ì›)</th>
                                        <th style="padding: 12px; text-align: right; color: #3B82F6; font-weight: 600;">ë¹„ìœ¨</th>
                                    </tr>
                                </thead>
                                <tbody id="support-detail-tbody">
                                    <!-- ë™ì  ìƒì„± -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="tab-content" id="discovery-tab">
                        <div style="max-height: 350px; position: relative;">
                            <canvas id="discoveryChart" data-aos="zoom-in" data-aos-delay="300"></canvas>
                        </div>
                        <!-- ì˜µì…˜ 1: ì°¨íŠ¸ ì•„ë˜ ìƒì„¸ í‘œ -->
                        <div class="expense-detail-table" style="margin-top: 30px;">
                            <h3 style="font-size: 1.1rem; color: #3B82F6; margin-bottom: 15px;">
                                <i class="fas fa-list"></i> ë°œêµ´ ìƒì„¸ ë‚´ì—­
                            </h3>
                            <table id="discovery-detail-table" style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: rgba(59, 130, 246, 0.1); border-bottom: 2px solid rgba(59, 130, 246, 0.3);">
                                        <th style="padding: 12px; text-align: left; color: #3B82F6; font-weight: 600;">ìƒì„¸ë¶„ë¥˜</th>
                                        <th style="padding: 12px; text-align: right; color: #3B82F6; font-weight: 600;">ê¸ˆì•¡ (ì›)</th>
                                        <th style="padding: 12px; text-align: right; color: #3B82F6; font-weight: 600;">ë¹„ìœ¨</th>
                                    </tr>
                                </thead>
                                <tbody id="discovery-detail-tbody">
                                    <!-- ë™ì  ìƒì„± -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="tab-content" id="general-tab">
                        <div style="max-height: 350px; position: relative;">
                            <canvas id="generalChart" data-aos="zoom-in" data-aos-delay="400"></canvas>
                        </div>
                        <!-- ì˜µì…˜ 1: ì°¨íŠ¸ ì•„ë˜ ìƒì„¸ í‘œ -->
                        <div class="expense-detail-table" style="margin-top: 30px;">
                            <h3 style="font-size: 1.1rem; color: #3B82F6; margin-bottom: 15px;">
                                <i class="fas fa-list"></i> ì¼ë°˜ê´€ë¦¬ë¹„ ìƒì„¸ ë‚´ì—­
                            </h3>
                            <table id="general-detail-table" style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: rgba(59, 130, 246, 0.1); border-bottom: 2px solid rgba(59, 130, 246, 0.3);">
                                        <th style="padding: 12px; text-align: left; color: #3B82F6; font-weight: 600;">ìƒì„¸ë¶„ë¥˜</th>
                                        <th style="padding: 12px; text-align: right; color: #3B82F6; font-weight: 600;">ê¸ˆì•¡ (ì›)</th>
                                        <th style="padding: 12px; text-align: right; color: #3B82F6; font-weight: 600;">ë¹„ìœ¨</th>
                                    </tr>
                                </thead>
                                <tbody id="general-detail-tbody">
                                    <!-- ë™ì  ìƒì„± -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì˜µì…˜ 3: ì§€ì¶œ êµ¬ì¡° ìƒì„¸ í†µí•© í‘œ -->
        <div class="chart-grid">
            <div class="chart-container chart-full">
                <h2>
                    <i class="fas fa-table"></i>
                    ì§€ì¶œ êµ¬ì¡° ìƒì„¸ í‘œ
                </h2>
                <div style="overflow-x: auto;">
                    <table id="expense-summary-table" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #3B82F6 0%, #06B6D4 100%); color: white;">
                                <th style="padding: 15px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">ë¶„ë¥˜</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">ìƒì„¸ë¶„ë¥˜</th>
                                <th style="padding: 15px; text-align: right; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">ê¸ˆì•¡ (ì›)</th>
                                <th style="padding: 15px; text-align: right; font-weight: 600;">ë¶„ë¥˜ë‚´ ë¹„ìœ¨</th>
                            </tr>
                        </thead>
                        <tbody id="expense-summary-tbody">
                            <!-- ë™ì  ìƒì„± -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ì—°ë„ë³„ ì¶”ì´ (Full Width) -->
        <div class="chart-grid" id="yearly-trend">
            <div class="chart-container chart-full">
                <h2>
                    <i class="fas fa-chart-line"></i>
                    2019-2025ë…„ í•­ëª©ë³„ ì˜ˆì‚° ì¶”ì´
                </h2>
                <canvas id="yearlyTrendChart" data-aos="fade-left" data-aos-delay="100"></canvas>
            </div>
        </div>

        <!-- ìˆ˜ì… ì˜ˆì¸¡ (Full Width) -->
        <div class="chart-grid" id="revenue-forecast">
            <div class="chart-container chart-full">
                <h2>
                    <i class="fas fa-crystal-ball"></i>
                    ìˆ˜ì… ë‚´ì—­ ë° í–¥í›„ ì˜ˆì¸¡ (2019-2035)
                </h2>
                <canvas id="revenueForecastChart" data-aos="fade-right" data-aos-delay="200"></canvas>
            </div>
        </div>

        <!-- ë³€ë™ ë‚´ì—­ -->
        <div class="chart-grid" id="change-history">
            <div class="chart-container chart-full">
                <h2>
                    <i class="fas fa-balance-scale"></i>
                    ì—°ë„ë³„ ë³€ë™ ë‚´ì—­
                </h2>
                <canvas id="changeHistoryChart" data-aos="fade-up" data-aos-delay="300"></canvas>
            </div>
        </div>

        <!-- Data Table -->
        <div class="table-container" id="detail-table">
            <h2><i class="fas fa-table"></i> í•­ëª©ë³„ ìƒì„¸ ë‚´ì—­</h2>
            <table>
                <thead>
                    <tr>
                        <th>í•­ëª©</th>
                        <th>2025 ì˜ˆì‚°</th>
                        <th>2025 ì§‘í–‰</th>
                        <th>ì§‘í–‰ë¥ </th>
                        <th>ì „ë…„ ëŒ€ë¹„</th>
                        <th>ìƒíƒœ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>ì¸ê±´ë¹„</td>
                        <td>8.5ì–µì›</td>
                        <td>6.2ì–µì›</td>
                        <td>72.9%</td>
                        <td style="color: #10b981;">+8.5%</td>
                        <td><span style="color: #10b981;">ì–‘í˜¸</span></td>
                    </tr>
                    <tr>
                        <td>ìš´ì˜ë¹„</td>
                        <td>4.2ì–µì›</td>
                        <td>3.5ì–µì›</td>
                        <td>83.3%</td>
                        <td style="color: #10b981;">+5.2%</td>
                        <td><span style="color: #10b981;">ì–‘í˜¸</span></td>
                    </tr>
                    <tr>
                        <td>ë§ˆì¼€íŒ…</td>
                        <td>5.8ì–µì›</td>
                        <td>4.8ì–µì›</td>
                        <td>82.8%</td>
                        <td style="color: #10b981;">+12.3%</td>
                        <td><span style="color: #10b981;">ì–‘í˜¸</span></td>
                    </tr>
                    <tr>
                        <td>ì—°êµ¬ê°œë°œ</td>
                        <td>3.5ì–µì›</td>
                        <td>2.1ì–µì›</td>
                        <td>60.0%</td>
                        <td style="color: #ef4444;">-3.2%</td>
                        <td><span style="color: #fbbf24;">ì£¼ì˜</span></td>
                    </tr>
                    <tr>
                        <td>ê¸°íƒ€</td>
                        <td>3.0ì–µì›</td>
                        <td>1.7ì–µì›</td>
                        <td>56.7%</td>
                        <td style="color: #10b981;">+2.1%</td>
                        <td><span style="color: #10b981;">ì–‘í˜¸</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Chart.js ê¸°ë³¸ ì„¤ì •
        Chart.defaults.color = '#64748b';
        Chart.defaults.borderColor = 'rgba(239, 68, 68, 0.2)';

        // ìŠ¤í¬ë¡¤ ì´ë™ í•¨ìˆ˜
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        }

        // ì—°ë„ë³„ ë¹„êµë¡œ ì´ë™ (ëª¨ë‹¬ì—ì„œ)
        function goToYearlyComparison() {
            closeModal('expense-modal');
            setTimeout(() => {
                scrollToSection('change-history');
            }, 300);
        }

        // ë¶„ë¥˜ ë“œë¡­ë‹¤ìš´ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
        function updateCategoryClass(selectElement) {
            const value = selectElement.value;
            selectElement.className = 'category-select';

            if (value === 'ì§€ì›') {
                selectElement.classList.add('support');
            } else if (value === 'ë°œêµ´') {
                selectElement.classList.add('discovery');
            } else if (value === 'ì¼ë°˜ê´€ë¦¬ë¹„') {
                selectElement.classList.add('general');
            }
        }

        // ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€ í•¨ìˆ˜
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // ì½¤ë§ˆ ì œê±° í•¨ìˆ˜
        function parseNumber(str) {
            return parseFloat(str.toString().replace(/,/g, '')) || 0;
        }

        // ğŸ—‘ï¸ ì „ì²´ ë°ì´í„° ì‚­ì œ ê¸°ëŠ¥
        function clearAllData() {
            const confirmation = confirm(`âš ï¸ ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‚­ì œë  ë°ì´í„°:\n- ëª¨ë“  ë…„ë„ì˜ ì§€ì¶œ ë°ì´í„°\n- ëª¨ë“  ë…„ë„ì˜ ìˆ˜ì… ë°ì´í„°\n- ëª¨ë“  ë…„ë„ì˜ ì”ì•¡ ë°ì´í„°\n- ìƒì„¸ ë‚´ì—­ ë°ì´í„°\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!`);
            
            if (!confirmation) {
                return;
            }

            const doubleConfirm = confirm(`ğŸš¨ ë§ˆì§€ë§‰ í™•ì¸!\n\nì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì™„ì „íˆ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‚­ì œ í›„ì—ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!`);
            
            if (!doubleConfirm) {
                return;
            }

            try {
                // localStorageì—ì„œ ëª¨ë“  ë°ì´í„° ì‚­ì œ
                const keysToDelete = [];
                
                // ëª¨ë“  localStorage í‚¤ í™•ì¸
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && (
                        key.startsWith('expenseData_') ||
                        key.startsWith('incomeData_') ||
                        key.startsWith('balanceData_') ||
                        key.startsWith('detailData_')
                    )) {
                        keysToDelete.push(key);
                    }
                }

                // ë°ì´í„° ì‚­ì œ ì‹¤í–‰
                keysToDelete.forEach(key => {
                    localStorage.removeItem(key);
                });

                // í˜„ì¬ í‘œì‹œëœ í…Œì´ë¸”ë“¤ ì´ˆê¸°í™”
                clearCurrentTables();

                // ì„±ê³µ ë©”ì‹œì§€
                alert(`âœ… ë°ì´í„° ì‚­ì œ ì™„ë£Œ!\n\nì‚­ì œëœ í•­ëª©:\n- ${keysToDelete.length}ê°œì˜ ë°ì´í„° ì„¸íŠ¸\n\nì´ì œ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);

                // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ì™„ì „ ì´ˆê¸°í™”
                if (confirm('í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ì™„ì „íˆ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    location.reload();
                }

            } catch (error) {
                console.error('ë°ì´í„° ì‚­ì œ ì¤‘ ì˜¤ë¥˜:', error);
                alert('âŒ ë°ì´í„° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // ğŸ“Š ë©”ì¸ í™”ë©´ í†µê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (2025ë…„ ë°ì´í„°ë§Œ)
        function updateMainStats() {
            try {
                const currentYear = '2025';
                let totalIncome = 0;
                let totalExpense = 0;
                let totalBalance = 0;
                
                // 2025ë…„ ìˆ˜ì… ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const incomeData = JSON.parse(localStorage.getItem(`incomeData_${currentYear}`) || '[]');
                incomeData.forEach(item => {
                    totalIncome += parseFloat(item.amount || 0);
                });

                // 2025ë…„ ì§€ì¶œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const expenseData = JSON.parse(localStorage.getItem(`expenseData_${currentYear}`) || '[]');
                expenseData.forEach(item => {
                    totalExpense += parseFloat(item.amount || 0);
                });

                // 2025ë…„ ì”ì•¡ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const balanceData = JSON.parse(localStorage.getItem(`balanceData_${currentYear}`) || '[]');
                balanceData.forEach(item => {
                    totalBalance += parseFloat(item.amount || 0);
                });

                console.log(`${currentYear}ë…„ í†µê³„:`, { totalIncome, totalExpense, totalBalance });

                // ë©”ì¸ í™”ë©´ ì¹´ë“œ ì—…ë°ì´íŠ¸
                updateStatCard('2025ë…„ ì´ ìˆ˜ì…', totalIncome);
                updateStatCard('2025ë…„ ì´ ì§€ì¶œ', totalExpense);
                updateStatCard('2025ë…„ ì”ì•¡', totalBalance);

                // í”„ë ˆì  í…Œì´ì…˜ ìŠ¬ë¼ì´ë“œë„ ì—…ë°ì´íŠ¸
                updatePresentationStats(totalExpense, totalIncome, totalBalance);

            } catch (error) {
                console.error('ë©”ì¸ í†µê³„ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
            }
        }

        // ê°œë³„ í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸
        function updateStatCard(cardName, value) {
            // ì¹´ë“œ ì œëª©ìœ¼ë¡œ ì°¾ê¸°
            const cards = document.querySelectorAll('.stat-card');
            cards.forEach(card => {
                const title = card.querySelector('h3');
                if (title && title.textContent.trim() === cardName) {
                    const valueElement = card.querySelector('.value');
                    const countUpElement = card.querySelector('[data-countup]');
                    
                    if (valueElement && countUpElement) {
                        // ì› ë‹¨ìœ„ë¡œ í‘œì‹œ
                        const formattedValue = new Intl.NumberFormat('ko-KR').format(Math.round(value));
                        valueElement.textContent = formattedValue + 'ì›';
                        
                        // CountUp ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ ë°ì´í„° ì†ì„± ì—…ë°ì´íŠ¸
                        countUpElement.setAttribute('data-countup', Math.round(value));
                        
                        // CountUp ì¬ì‹¤í–‰
                        if (window.CountUp) {
                            const countUp = new CountUp(countUpElement, Math.round(value), {
                                duration: 2,
                                useGrouping: true,
                                separator: ','
                            });
                            countUp.start();
                        }
                    }
                }
            });
        }

        // í”„ë ˆì  í…Œì´ì…˜ ìŠ¬ë¼ì´ë“œ í†µê³„ ì—…ë°ì´íŠ¸
        function updatePresentationStats(totalExpense, totalIncome, totalBalance) {
            const slideStats = document.querySelectorAll('.slide-stat-value');
            if (slideStats.length >= 3) {
                slideStats[0].setAttribute('data-countup', Math.round(totalExpense));
                slideStats[0].textContent = '0';
                
                slideStats[1].setAttribute('data-countup', Math.round(totalIncome));
                slideStats[1].textContent = '0';
                
                slideStats[2].setAttribute('data-countup', Math.round(totalBalance));
                slideStats[2].textContent = '0';
            }
        }

        // ğŸ—‘ï¸ 2019~2023ë…„ ìˆ˜ì…ì›ê³¼ ë¹„ê³ ë§Œ ì‚­ì œí•˜ëŠ” í•¨ìˆ˜
        function clearOldIncomeData() {
            try {
                const yearsToUpdate = ['2019', '2020', '2021', '2022', '2023'];
                let updatedCount = 0;
                
                yearsToUpdate.forEach(year => {
                    const key = `incomeData_${year}`;
                    const existingData = localStorage.getItem(key);
                    
                    if (existingData) {
                        const data = JSON.parse(existingData);
                        // ê¸ˆì•¡ì€ ê·¸ëŒ€ë¡œ ë‘ê³  ìˆ˜ì…ì›ê³¼ ë¹„ê³ ë§Œ ìˆ˜ì •
                        const updatedData = data.map(item => ({
                            item: item.item, // ìƒì„¸ë¶„ë¥˜ëŠ” ê·¸ëŒ€ë¡œ
                            amount: item.amount, // ğŸ’° ê¸ˆì•¡ì€ ê·¸ëŒ€ë¡œ ìœ ì§€
                            source: item.item.includes('ì •ë¶€') || item.item.includes('TIPS') || item.item.includes('íŒìŠ¤') ? 'ì •ë¶€ì§€ì›ì‚¬ì—…' : 'ê´€ë¦¬ë³´ìˆ˜', // ìˆ˜ì…ì›ë§Œ ë³€ê²½
                            note: '' // ë¹„ê³ ëŠ” ë¹ˆ ì¹¸
                        }));
                        
                        localStorage.setItem(key, JSON.stringify(updatedData));
                        updatedCount++;
                        console.log(`${year}ë…„ ë°ì´í„° ìˆ˜ì…ì›/ë¹„ê³  ì—…ë°ì´íŠ¸ ì™„ë£Œ`);
                    }
                });

                // 2025ë…„ ê¸°ë³¸ ë°ì´í„° ì„¤ì • (ì› ë‹¨ìœ„ë¡œ ìˆ˜ì •)
                const defaultIncomeData = [
                    {
                        item: 'ì •ë¶€ì§€ì›ì‚¬ì—…',
                        amount: 850000000,
                        source: 'ì •ë¶€ì§€ì›ì‚¬ì—…',
                        note: ''
                    },
                    {
                        item: 'ê´€ë¦¬ë³´ìˆ˜',
                        amount: 620000000,
                        source: 'ê´€ë¦¬ë³´ìˆ˜',
                        note: ''
                    },
                    {
                        item: 'ê´€ë¦¬ë³´ìˆ˜',
                        amount: 380000000,
                        source: 'ê´€ë¦¬ë³´ìˆ˜',
                        note: ''
                    },
                    {
                        item: 'ê´€ë¦¬ë³´ìˆ˜',
                        amount: 250000000,
                        source: 'ê´€ë¦¬ë³´ìˆ˜',
                        note: ''
                    },
                    {
                        item: 'ê´€ë¦¬ë³´ìˆ˜',
                        amount: 150000000,
                        source: 'ê´€ë¦¬ë³´ìˆ˜',
                        note: ''
                    }
                ];
                
                localStorage.setItem('incomeData_2025', JSON.stringify(defaultIncomeData));
                console.log(`2019~2023ë…„ ${updatedCount}ê°œ ë…„ë„ ìˆ˜ì…ì›/ë¹„ê³  ì—…ë°ì´íŠ¸ ì™„ë£Œ, 2025ë…„ ê¸°ë³¸ ë°ì´í„° ì„¤ì • ì™„ë£Œ`);
                
            } catch (error) {
                console.error('ìˆ˜ì…ì›/ë¹„ê³  ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
            }
        }

        // ğŸ“Š í…Œì´ë¸”ì— í•©ê³„ í–‰ ì¶”ê°€ í•¨ìˆ˜
        function addTotalRowToTable(tableId, data) {
            const table = document.getElementById(tableId);
            const tbody = table.querySelector('tbody');
            
            // ëª¨ë“  ê¸°ì¡´ í•©ê³„ í–‰ ì œê±° (ì—¬ëŸ¬ ê°œê°€ ìˆì„ ìˆ˜ ìˆìŒ)
            const existingTotalRows = tbody.querySelectorAll('.total-row');
            existingTotalRows.forEach(row => row.remove());
            
            // í•©ê³„ ê³„ì‚°
            let total = 0;
            data.forEach(item => {
                total += parseFloat(item.amount || 0);
            });
            
            // í•©ê³„ í–‰ ì¶”ê°€
            const totalRow = tbody.insertRow();
            totalRow.className = 'total-row';
            totalRow.innerHTML = `
                <td><strong>í•©ê³„</strong></td>
                <td class="total-amount"><strong>${formatNumber(total)}</strong></td>
                <td><strong>-</strong></td>
                <td><strong>-</strong></td>
                <td><strong>-</strong></td>
            `;
        }

        // ğŸ“Š ìˆ˜ì… í…Œì´ë¸” í•©ê³„ ì—…ë°ì´íŠ¸
        function updateIncomeTotal() {
            const savedData = localStorage.getItem(`incomeData_${currentIncomeYear}`);
            if (savedData) {
                const data = JSON.parse(savedData);
                addTotalRowToTable('income-table', data);
            }
        }

        // ğŸ“Š ìˆ˜ì… ê·¸ë˜í”„ë¡œ ìŠ¤í¬ë¡¤í•˜ëŠ” í•¨ìˆ˜
        function scrollToIncomeChart() {
            // ëª¨ë‹¬ ë‹«ê¸°
            closeModal('income-modal');
            
            // ê·¸ë˜í”„ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            setTimeout(() => {
                const chartSection = document.querySelector('.chart-container');
                if (chartSection) {
                    chartSection.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                    
                    // ê·¸ë˜í”„ ì œëª© ê°•ì¡° íš¨ê³¼
                    const chartTitle = chartSection.querySelector('h3');
                    if (chartTitle) {
                        chartTitle.style.animation = 'pulse 2s ease-in-out';
                        setTimeout(() => {
                            chartTitle.style.animation = '';
                        }, 2000);
                    }
                }
            }, 300);
        }

        // í˜„ì¬ í‘œì‹œëœ í…Œì´ë¸”ë“¤ ì´ˆê¸°í™”
        function clearCurrentTables() {
            // ì§€ì¶œ í…Œì´ë¸” ì´ˆê¸°í™”
            const expenseTable = document.querySelector('#expense-table tbody');
            if (expenseTable) {
                expenseTable.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #64748b; padding: 40px;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.</td></tr>';
            }

            // ìˆ˜ì… í…Œì´ë¸” ì´ˆê¸°í™”
            const incomeTable = document.querySelector('#income-table tbody');
            if (incomeTable) {
                incomeTable.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #64748b; padding: 40px;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.</td></tr>';
            }

            // ì”ì•¡ í…Œì´ë¸” ì´ˆê¸°í™”
            const balanceTable = document.querySelector('#balance-table tbody');
            if (balanceTable) {
                balanceTable.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #64748b; padding: 40px;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.</td></tr>';
            }

            // ìƒì„¸ í…Œì´ë¸”ë“¤ ì´ˆê¸°í™”
            const detailTable = document.querySelector('#detail-table-body');
            if (detailTable) {
                detailTable.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #64748b; padding: 40px;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.</td></tr>';
            }
        }

        // íƒ­ ì „í™˜ ê¸°ëŠ¥
        const tabButtons = document.querySelectorAll('.tab-button');
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
                tabButtons.forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });

                // í´ë¦­í•œ íƒ­ í™œì„±í™”
                button.classList.add('active');
                const tabName = button.getAttribute('data-tab');
                document.getElementById(tabName + '-tab').classList.add('active');
            });
        });

        // í˜„ì¬ ì„ íƒëœ ì—°ë„ ì €ì¥
        let currentExpenseYear = '2025';
        let currentIncomeYear = '2025';

        // ëª¨ë‹¬ ì—´ê¸° ê¸°ëŠ¥
        const statCards = document.querySelectorAll('.stat-card[data-modal]');
        statCards.forEach(card => {
            card.addEventListener('click', () => {
                const modalType = card.getAttribute('data-modal');
                const modal = document.getElementById(modalType + '-modal');
                if (modal) {
                    modal.classList.add('active');
                    if (modalType === 'expense') {
                        loadExpenseYear(currentExpenseYear);
                    } else if (modalType === 'income') {
                        loadIncomeYear(currentIncomeYear);
                    }
                }
            });
        });

        // ëª¨ë‹¬ ë‹«ê¸° ê¸°ëŠ¥
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
        }

        // ìƒì„¸ ë‚´ì—­ ëª¨ë‹¬ ì—´ê¸° (ë“œë¦´ë‹¤ìš´)
        let currentDetailCategory = '';
        let currentDetailItem = '';
        let currentDetailYear = '2025';

        function openDetailModal(category, itemName, year) {
            currentDetailCategory = category;
            currentDetailItem = itemName;
            currentDetailYear = year;

            // ëª¨ë‹¬ ì œëª© ì—…ë°ì´íŠ¸
            document.getElementById('detail-modal-title').textContent = `${category} > ${itemName} ìƒì„¸ ë‚´ì—­`;

            // ì—°ë„ íƒ­ ì—…ë°ì´íŠ¸
            document.querySelectorAll('#detail-modal .year-tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.year === year) {
                    btn.classList.add('active');
                }
            });

            // ìƒì„¸ ë°ì´í„° ë¡œë“œ
            loadDetailData(category, itemName, year);

            // ëª¨ë‹¬ ì—´ê¸°
            document.getElementById('detail-modal').classList.add('active');
        }

        // ìƒì„¸ ë°ì´í„° ë¡œë“œ
        function loadDetailData(category, itemName, year) {
            const key = `detailData_${year}`;
            const savedData = localStorage.getItem(key);
            const tbody = document.querySelector('#detail-table tbody');
            const months = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            tbody.innerHTML = '';

            if (savedData) {
                const allData = JSON.parse(savedData);
                // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì™€ ì•„ì´í…œì— ë§ëŠ” ë°ì´í„°ë§Œ í•„í„°ë§
                const filteredData = allData.filter(row =>
                    row.category === category && row.item === itemName
                );

                if (filteredData.length > 0) {
                    filteredData.forEach(row => {
                        const tr = tbody.insertRow();

                        // ì†Œë¶„ë¥˜ (sticky)
                        let html = `<td contenteditable="true" style="position: sticky; left: 0; background: white; z-index: 5; box-shadow: 2px 0 5px rgba(0,0,0,0.05);">${row.subitem || ''}</td>`;

                        // ì›”ë³„ ê¸ˆì•¡ í•©ì‚°
                        let total = 0;
                        months.forEach(month => {
                            const monthValue = (row.monthly && row.monthly[month]) ? row.monthly[month] : 0;
                            total += monthValue;
                        });

                        // ì´ì•¡ (ì½ê¸° ì „ìš©, ìë™ ê³„ì‚°)
                        html += `<td style="background: rgba(59, 130, 246, 0.1); font-weight: 700; text-align: right;">${formatNumber(total)}</td>`;

                        // ì›”ë³„ ê¸ˆì•¡ (1ì›”~12ì›”)
                        months.forEach(month => {
                            const monthValue = (row.monthly && row.monthly[month]) ? row.monthly[month] : 0;
                            html += `<td contenteditable="true">${monthValue || 0}</td>`;
                        });

                        // ë¹„ê³ 
                        html += `<td contenteditable="true">${row.note || ''}</td>`;

                        tr.innerHTML = html;
                    });
                } else {
                    // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¹ˆ í–‰ 1ê°œ
                    let html = `<td contenteditable="true" style="position: sticky; left: 0; background: white; z-index: 5; box-shadow: 2px 0 5px rgba(0,0,0,0.05);">ìƒˆ í•­ëª©</td>`;
                    html += `<td style="background: rgba(59, 130, 246, 0.1); font-weight: 700; text-align: right;">0</td>`;
                    months.forEach(() => {
                        html += `<td contenteditable="true">0</td>`;
                    });
                    html += `<td contenteditable="true">ë¹„ê³ </td>`;
                    tbody.innerHTML = `<tr>${html}</tr>`;
                }
            } else {
                // ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¹ˆ í–‰ 1ê°œ
                let html = `<td contenteditable="true" style="position: sticky; left: 0; background: white; z-index: 5; box-shadow: 2px 0 5px rgba(0,0,0,0.05);">ìƒˆ í•­ëª©</td>`;
                html += `<td style="background: rgba(59, 130, 246, 0.1); font-weight: 700; text-align: right;">0</td>`;
                months.forEach(() => {
                    html += `<td contenteditable="true">0</td>`;
                });
                html += `<td contenteditable="true">ë¹„ê³ </td>`;
                tbody.innerHTML = `<tr>${html}</tr>`;
            }
        }

        // ìƒì„¸ ë°ì´í„° ì €ì¥
        function saveDetailData() {
            const table = document.getElementById('detail-table');
            const rows = table.querySelectorAll('tbody tr');
            const months = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];

            const key = `detailData_${currentDetailYear}`;
            const savedData = localStorage.getItem(key);
            let allData = savedData ? JSON.parse(savedData) : [];

            // ê¸°ì¡´ ë°ì´í„°ì—ì„œ í˜„ì¬ ì¹´í…Œê³ ë¦¬/ì•„ì´í…œ ì œê±°
            allData = allData.filter(row =>
                !(row.category === currentDetailCategory && row.item === currentDetailItem)
            );

            // ìƒˆ ë°ì´í„° ì¶”ê°€
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const subitem = cells[0].textContent.trim();
                // cells[1]ì€ ì´ì•¡ (ì½ê¸° ì „ìš©, ê±´ë„ˆëœ€)

                // ì›”ë³„ ë°ì´í„° ìˆ˜ì§‘ (cells[2-13])
                const monthly = {};
                let totalAmount = 0;
                months.forEach((month, index) => {
                    const monthValue = parseNumber(cells[index + 2].textContent);
                    monthly[month] = monthValue;
                    totalAmount += monthValue;
                });

                const note = cells[14].textContent.trim(); // ë¹„ê³ 

                const rowData = {
                    category: currentDetailCategory,
                    item: currentDetailItem,
                    subitem: subitem,
                    amount: totalAmount,
                    monthly: monthly,
                    note: note
                };

                if (rowData.subitem && rowData.amount > 0) {
                    allData.push(rowData);
                }
            });

            // ì €ì¥
            localStorage.setItem(key, JSON.stringify(allData));

            // ë©”ì¸ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ì„ íƒì )
            switchExpenseChartYear(currentDetailYear);

            closeModal('detail-modal');
            alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ìƒì„¸ í•­ëª© ì¶”ê°€
        function addDetailRow() {
            const tbody = document.querySelector('#detail-table tbody');
            const months = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            const newRow = tbody.insertRow();

            let html = `<td contenteditable="true" style="position: sticky; left: 0; background: white; z-index: 5; box-shadow: 2px 0 5px rgba(0,0,0,0.05);">ìƒˆ í•­ëª©</td>`;
            html += `<td style="background: rgba(59, 130, 246, 0.1); font-weight: 700; text-align: right;">0</td>`;
            months.forEach(() => {
                html += `<td contenteditable="true">0</td>`;
            });
            html += `<td contenteditable="true">ë¹„ê³ </td>`;

            newRow.innerHTML = html;
        }

        // ìƒì„¸ ì—°ë„ ì „í™˜
        function switchDetailYear(year) {
            currentDetailYear = year;

            // íƒ­ í™œì„±í™”
            document.querySelectorAll('#detail-modal .year-tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.year === year) {
                    btn.classList.add('active');
                }
            });

            // ë°ì´í„° ë¡œë“œ
            loadDetailData(currentDetailCategory, currentDetailItem, year);
        }

        // ìƒì„¸ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
        function downloadDetailTemplate() {
            const templateData = [
                {
                    'ë…„ë„': 2025,
                    'ëŒ€ë¶„ë¥˜': 'ì¼ë°˜ê´€ë¦¬ë¹„',
                    'ì¤‘ë¶„ë¥˜': 'ì¸ê±´ë¹„',
                    'ì†Œë¶„ë¥˜': 'ê¸‰ì—¬',
                    '1ì›”': 40,
                    '2ì›”': 40,
                    '3ì›”': 40,
                    '4ì›”': 45,
                    '5ì›”': 45,
                    '6ì›”': 45,
                    '7ì›”': 45,
                    '8ì›”': 45,
                    '9ì›”': 45,
                    '10ì›”': 45,
                    '11ì›”': 45,
                    '12ì›”': 45,
                    'ë¹„ê³ ': '4ì›”ë¶€í„° ì¸ìƒ'
                },
                {
                    'ë…„ë„': 2025,
                    'ëŒ€ë¶„ë¥˜': 'ì¼ë°˜ê´€ë¦¬ë¹„',
                    'ì¤‘ë¶„ë¥˜': 'ì¸ê±´ë¹„',
                    'ì†Œë¶„ë¥˜': 'ìƒì—¬ê¸ˆ',
                    '1ì›”': 0,
                    '2ì›”': 0,
                    '3ì›”': 0,
                    '4ì›”': 0,
                    '5ì›”': 0,
                    '6ì›”': 100,
                    '7ì›”': 0,
                    '8ì›”': 0,
                    '9ì›”': 0,
                    '10ì›”': 0,
                    '11ì›”': 0,
                    '12ì›”': 100,
                    'ë¹„ê³ ': '6ì›”/12ì›” ì§€ê¸‰'
                },
                {
                    'ë…„ë„': 2025,
                    'ëŒ€ë¶„ë¥˜': 'ì§€ì›',
                    'ì¤‘ë¶„ë¥˜': 'ë©˜í† ë§ë¹„',
                    'ì†Œë¶„ë¥˜': 'ì „ë¬¸ê°€ ë©˜í† ë§',
                    '1ì›”': 20,
                    '2ì›”': 20,
                    '3ì›”': 20,
                    '4ì›”': 20,
                    '5ì›”': 20,
                    '6ì›”': 20,
                    '7ì›”': 15,
                    '8ì›”': 15,
                    '9ì›”': 15,
                    '10ì›”': 15,
                    '11ì›”': 15,
                    '12ì›”': 15,
                    'ë¹„ê³ ': 'ì™¸ë¶€ ì „ë¬¸ê°€ ì´ˆì²­'
                },
                {
                    'ë…„ë„': 2024,
                    'ëŒ€ë¶„ë¥˜': 'ì§€ì›',
                    'ì¤‘ë¶„ë¥˜': 'ë©˜í† ë§ë¹„',
                    'ì†Œë¶„ë¥˜': 'ì „ë¬¸ê°€ ë©˜í† ë§',
                    '1ì›”': 15,
                    '2ì›”': 15,
                    '3ì›”': 15,
                    '4ì›”': 15,
                    '5ì›”': 15,
                    '6ì›”': 15,
                    '7ì›”': 15,
                    '8ì›”': 15,
                    '9ì›”': 15,
                    '10ì›”': 15,
                    '11ì›”': 15,
                    '12ì›”': 15,
                    'ë¹„ê³ ': '2024ë…„ ë°ì´í„°'
                }
            ];

            // ì‚¬ìš© ì•ˆë‚´ ì‹œíŠ¸
            const notesData = [
                { 'í•­ëª©': 'ë…„ë„', 'ì„¤ëª…': 'ë°ì´í„°ê°€ ì†í•œ ë…„ë„ (ì˜ˆ: 2025, 2024)', 'í•„ìˆ˜': 'O' },
                { 'í•­ëª©': 'ëŒ€ë¶„ë¥˜', 'ì„¤ëª…': 'ì§€ì›, ë°œêµ´, ì¼ë°˜ê´€ë¦¬ë¹„ ì¤‘ ì„ íƒ', 'í•„ìˆ˜': 'O' },
                { 'í•­ëª©': 'ì¤‘ë¶„ë¥˜', 'ì„¤ëª…': 'ìƒì„¸ë¶„ë¥˜/í•­ëª© ì´ë¦„ (ì˜ˆ: ì¸ê±´ë¹„, ë©˜í† ë§ë¹„)', 'í•„ìˆ˜': 'O' },
                { 'í•­ëª©': 'ì†Œë¶„ë¥˜', 'ì„¤ëª…': 'ë” ì„¸ë¶€ì ì¸ í•­ëª© (ì˜ˆ: ê¸‰ì—¬, ìƒì—¬ê¸ˆ)', 'í•„ìˆ˜': 'O' },
                { 'í•­ëª©': '1ì›”~12ì›”', 'ì„¤ëª…': 'ì›”ë³„ ê¸ˆì•¡ (ì› ë‹¨ìœ„). ìë™ìœ¼ë¡œ í•©ì‚°ë©ë‹ˆë‹¤.', 'í•„ìˆ˜': 'O' },
                { 'í•­ëª©': 'ë¹„ê³ ', 'ì„¤ëª…': 'ì¶”ê°€ ì„¤ëª…', 'í•„ìˆ˜': 'X' },
                { 'í•­ëª©': '', 'ì„¤ëª…': '', 'í•„ìˆ˜': '' },
                { 'í•­ëª©': 'ğŸ’¡ TIP', 'ì„¤ëª…': 'ë…„ë„ë³„ë¡œ ìë™ ë¶„ë¥˜ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤. í•œ íŒŒì¼ì— ì—¬ëŸ¬ ë…„ë„ ë°ì´í„° ì…ë ¥ ê°€ëŠ¥!', 'í•„ìˆ˜': '' }
            ];

            const worksheet = XLSX.utils.json_to_sheet(templateData);
            const notesSheet = XLSX.utils.json_to_sheet(notesData);

            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'ìƒì„¸ë‚´ì—­ ì–‘ì‹');
            XLSX.utils.book_append_sheet(workbook, notesSheet, 'ì‚¬ìš© ì•ˆë‚´');

            XLSX.writeFile(workbook, 'ìƒì„¸ë‚´ì—­_ì—…ë¡œë“œ_ì–‘ì‹.xlsx');
        }

        // ìƒì„¸ ì—‘ì…€ ì—…ë¡œë“œ (ë…„ë„ë³„ ìë™ ë¶„ë¥˜)
        function uploadDetailExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const rows = XLSX.utils.sheet_to_json(firstSheet);

                const months = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];

                // ë…„ë„ë³„ë¡œ ë°ì´í„° ê·¸ë£¹í•‘
                const dataByYear = {};

                // ìƒˆ ë°ì´í„° ì²˜ë¦¬
                rows.forEach(row => {
                    const year = (row['ë…„ë„'] || row['year'] || currentDetailYear).toString();
                    const category = row['ëŒ€ë¶„ë¥˜'] || row['category'] || currentDetailCategory;
                    const item = row['ì¤‘ë¶„ë¥˜'] || row['item'] || currentDetailItem;

                    // ë…„ë„ë³„ ê·¸ë£¹ ì´ˆê¸°í™”
                    if (!dataByYear[year]) {
                        dataByYear[year] = [];
                    }

                    // í˜„ì¬ ëª¨ë‹¬ì˜ ì¹´í…Œê³ ë¦¬/ì•„ì´í…œê³¼ ì¼ì¹˜í•˜ëŠ” ê²ƒë§Œ ì¶”ê°€
                    if (category === currentDetailCategory && item === currentDetailItem) {
                        // ì›”ë³„ ë°ì´í„° ìˆ˜ì§‘
                        const monthly = {};
                        let amount = 0;
                        let hasMonthlyData = false;

                        months.forEach(month => {
                            if (row[month] !== undefined && row[month] !== '' && row[month] !== null) {
                                const monthValue = parseNumber(row[month]);
                                monthly[month] = monthValue;
                                amount += monthValue;
                                hasMonthlyData = true;
                            }
                        });

                        // ì›”ë³„ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì´ì•¡ ì‚¬ìš©
                        if (!hasMonthlyData) {
                            amount = parseNumber(row['ê¸ˆì•¡ (ì›)'] || row['amount'] || 0);
                        }

                        dataByYear[year].push({
                            category: category,
                            item: item,
                            subitem: row['ì†Œë¶„ë¥˜'] || row['subitem'] || '',
                            amount: amount,
                            monthly: hasMonthlyData ? monthly : null,
                            note: row['ë¹„ê³ '] || row['note'] || ''
                        });
                    }
                });

                // ëª¨ë“  ë…„ë„ì˜ ë°ì´í„° ì €ì¥
                const importedYears = [];
                Object.keys(dataByYear).forEach(year => {
                    const key = `detailData_${year}`;
                    const savedData = localStorage.getItem(key);
                    let allData = savedData ? JSON.parse(savedData) : [];

                    // ê¸°ì¡´ ë°ì´í„°ì—ì„œ í˜„ì¬ ì¹´í…Œê³ ë¦¬/ì•„ì´í…œ ì œê±°
                    allData = allData.filter(row =>
                        !(row.category === currentDetailCategory && row.item === currentDetailItem)
                    );

                    // ìƒˆ ë°ì´í„° ì¶”ê°€
                    allData.push(...dataByYear[year]);

                    localStorage.setItem(key, JSON.stringify(allData));
                    importedYears.push(year);
                });

                // í˜„ì¬ ë…„ë„ì˜ ë°ì´í„°ê°€ ì—…ë¡œë“œë˜ì—ˆìœ¼ë©´ í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨
                if (dataByYear[currentDetailYear]) {
                    loadDetailData(currentDetailCategory, currentDetailItem, currentDetailYear);
                }

                // ì—…ë¡œë“œ ì™„ë£Œ ë©”ì‹œì§€
                const totalItems = Object.values(dataByYear).reduce((sum, arr) => sum + arr.length, 0);
                alert(`ì—…ë¡œë“œ ì™„ë£Œ!\nì—…ë¡œë“œëœ ë…„ë„: ${importedYears.sort().join(', ')}ë…„\nì´ ${totalItems}ê°œ í•­ëª©`);

                // ğŸ“Š ë©”ì¸ í™”ë©´ í†µê³„ ì—…ë°ì´íŠ¸
                setTimeout(() => {
                    updateMainStats();
                }, 100);
            };

            reader.readAsArrayBuffer(file);
            event.target.value = '';
        }

        // ìƒì„¸ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
        function downloadDetailExcel() {
            const table = document.getElementById('detail-table');
            const rows = table.querySelectorAll('tbody tr');
            const months = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];

            const data = [];
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const rowData = {
                    'ë…„ë„': currentDetailYear,
                    'ëŒ€ë¶„ë¥˜': currentDetailCategory,
                    'ì¤‘ë¶„ë¥˜': currentDetailItem,
                    'ì†Œë¶„ë¥˜': cells[0].textContent.trim()
                };
                // cells[1]ì€ ì´ì•¡ (ê±´ë„ˆëœ€)

                // ì›”ë³„ ë°ì´í„° ì¶”ê°€ (cells[2-13])
                months.forEach((month, index) => {
                    rowData[month] = parseNumber(cells[index + 2].textContent);
                });

                // ë¹„ê³  (cells[14])
                rowData['ë¹„ê³ '] = cells[14].textContent.trim();

                data.push(rowData);
            });

            const worksheet = XLSX.utils.json_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'ìƒì„¸ë‚´ì—­');
            XLSX.writeFile(workbook, `ìƒì„¸ë‚´ì—­_${currentDetailCategory}_${currentDetailItem}_${currentDetailYear}.xlsx`);
        }

        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // í–‰ ì¶”ê°€ ê¸°ëŠ¥
        function addExpenseRow() {
            const tbody = document.querySelector('#expense-table tbody');
            const newRow = tbody.insertRow();
            newRow.innerHTML = `
                <td>
                    <select class="category-select support" onchange="updateCategoryClass(this)">
                        <option value="ì§€ì›" selected>ì§€ì›</option>
                        <option value="ë°œêµ´">ë°œêµ´</option>
                        <option value="ì¼ë°˜ê´€ë¦¬ë¹„">ì¼ë°˜ê´€ë¦¬ë¹„</option>
                    </select>
                </td>
                <td contenteditable="true">ìƒˆ ìƒì„¸ë¶„ë¥˜</td>
                <td contenteditable="true">0</td>
                <td contenteditable="true">ë¹„ê³ </td>
                <td>
                    <button class="btn-move" onclick="moveRowUp(this)" title="ìœ„ë¡œ ì´ë™">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                    <button class="btn-move" onclick="moveRowDown(this)" title="ì•„ë˜ë¡œ ì´ë™">
                        <i class="fas fa-arrow-down"></i>
                    </button>
                </td>
                <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
            `;
        }

        function addIncomeRow() {
            const tbody = document.querySelector('#income-table tbody');
            
            // ëª¨ë“  ê¸°ì¡´ í•©ê³„ í–‰ ì œê±° (ìƒˆ í–‰ì„ ì¶”ê°€í•˜ê¸° ì „ì—)
            const existingTotalRows = tbody.querySelectorAll('.total-row');
            existingTotalRows.forEach(row => row.remove());
            
            const newRow = tbody.insertRow();
            newRow.innerHTML = `
                <td contenteditable="true">ìƒˆ ìƒì„¸ë¶„ë¥˜</td>
                <td contenteditable="true">0</td>
                <td contenteditable="true">ê´€ë¦¬ë³´ìˆ˜</td>
                <td contenteditable="true"></td>
                <td>
                    <button class="btn-move" onclick="moveRowUp(this)" title="ìœ„ë¡œ ì´ë™">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                    <button class="btn-move" onclick="moveRowDown(this)" title="ì•„ë˜ë¡œ ì´ë™">
                        <i class="fas fa-arrow-down"></i>
                    </button>
                </td>
                <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
            `;
            
            // ğŸ“Š í•©ê³„ í–‰ ë‹¤ì‹œ ì¶”ê°€
            setTimeout(() => {
                updateIncomeTotal();
            }, 100);
        }

        function addBalanceRow() {
            const tbody = document.querySelector('#balance-table tbody');
            const newRow = tbody.insertRow();
            newRow.innerHTML = `
                <td contenteditable="true">ìƒˆ ê³„ì¢Œ</td>
                <td contenteditable="true">0</td>
                <td contenteditable="true">ì¢…ë¥˜</td>
                <td contenteditable="true">ë¹„ê³ </td>
                <td>
                    <button class="btn-move" onclick="moveRowUp(this)" title="ìœ„ë¡œ ì´ë™">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                    <button class="btn-move" onclick="moveRowDown(this)" title="ì•„ë˜ë¡œ ì´ë™">
                        <i class="fas fa-arrow-down"></i>
                    </button>
                </td>
                <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
            `;
        }

        // í–‰ ì‚­ì œ í•¨ìˆ˜
        function deleteRow(button) {
            const row = button.closest('tr');
            if (confirm('ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const table = row.closest('table');
                row.remove();
                
                // ğŸ“Š ìˆ˜ì… í…Œì´ë¸”ì¸ ê²½ìš° í•©ê³„ ì—…ë°ì´íŠ¸
                if (table && table.id === 'income-table') {
                    setTimeout(() => {
                        updateIncomeTotal();
                    }, 100);
                }
            }
        }

        // í–‰ ìœ„ë¡œ ì´ë™
        function moveRowUp(button) {
            const row = button.closest('tr');
            const previousRow = row.previousElementSibling;
            
            if (previousRow && !previousRow.classList.contains('total-row')) {
                row.parentNode.insertBefore(row, previousRow);
                
                // ì´ë™ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
                row.style.backgroundColor = 'rgba(59, 130, 246, 0.1)';
                setTimeout(() => {
                    row.style.backgroundColor = '';
                }, 500);
            }
        }

        // í–‰ ì•„ë˜ë¡œ ì´ë™
        function moveRowDown(button) {
            const row = button.closest('tr');
            const nextRow = row.nextElementSibling;
            
            if (nextRow && !nextRow.classList.contains('total-row')) {
                row.parentNode.insertBefore(nextRow, row);
                
                // ì´ë™ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
                row.style.backgroundColor = 'rgba(59, 130, 246, 0.1)';
                setTimeout(() => {
                    row.style.backgroundColor = '';
                }, 500);
            }
        }

        // ì—°ë„ ì „í™˜ ê¸°ëŠ¥
        function switchExpenseYear(year) {
            // ë¨¼ì € í˜„ì¬ ì—°ë„ ë°ì´í„° ì €ì¥
            saveCurrentExpenseYear();

            // ì—°ë„ ë³€ê²½
            currentExpenseYear = year;

            // íƒ­ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.year-tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.year-tab-button[data-year="${year}"]`).classList.add('active');

            // í•´ë‹¹ ì—°ë„ ë°ì´í„° ë¡œë“œ
            loadExpenseYear(year);
        }

        // í˜„ì¬ ë³´ê³  ìˆëŠ” ì—°ë„ ë°ì´í„° ì €ì¥
        function saveCurrentExpenseYear() {
            const table = document.getElementById('expense-table');
            const rows = table.querySelectorAll('tbody tr');

            const data = [];
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const selectElement = cells[0].querySelector('select');
                const rowData = {
                    category: selectElement ? selectElement.value : cells[0].textContent,
                    item: cells[1].textContent,
                    amount: parseNumber(cells[2].textContent),
                    note: cells[3].textContent
                };
                data.push(rowData);
            });

            // ì—°ë„ë³„ë¡œ ì €ì¥
            localStorage.setItem(`expenseData_${currentExpenseYear}`, JSON.stringify(data));
        }

        // ì—°ë„ë³„ ë°ì´í„° ë¡œë“œ
        function loadExpenseYear(year) {
            const savedData = localStorage.getItem(`expenseData_${year}`);
            const tbody = document.querySelector('#expense-table tbody');
            tbody.innerHTML = '';

            if (savedData) {
                const data = JSON.parse(savedData);
                data.forEach(row => {
                    const category = row.category || 'ì§€ì›';
                    let categoryClass = 'support';
                    if (category === 'ë°œêµ´') categoryClass = 'discovery';
                    else if (category === 'ì¼ë°˜ê´€ë¦¬ë¹„') categoryClass = 'general';

                    const tr = tbody.insertRow();
                    tr.innerHTML = `
                        <td>
                            <select class="category-select ${categoryClass}" onchange="updateCategoryClass(this)">
                                <option value="ì§€ì›" ${category === 'ì§€ì›' ? 'selected' : ''}>ì§€ì›</option>
                                <option value="ë°œêµ´" ${category === 'ë°œêµ´' ? 'selected' : ''}>ë°œêµ´</option>
                                <option value="ì¼ë°˜ê´€ë¦¬ë¹„" ${category === 'ì¼ë°˜ê´€ë¦¬ë¹„' ? 'selected' : ''}>ì¼ë°˜ê´€ë¦¬ë¹„</option>
                            </select>
                        </td>
                        <td contenteditable="true">${row.item}</td>
                        <td contenteditable="true">${formatNumber(row.amount)}</td>
                        <td contenteditable="true">${row.note}</td>
                        <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                    `;
                });
            } else {
                // ê¸°ë³¸ ìƒ˜í”Œ ë°ì´í„°
                tbody.innerHTML = `
                    <tr>
                        <td>
                            <select class="category-select support" onchange="updateCategoryClass(this)">
                                <option value="ì§€ì›" selected>ì§€ì›</option>
                                <option value="ë°œêµ´">ë°œêµ´</option>
                                <option value="ì¼ë°˜ê´€ë¦¬ë¹„">ì¼ë°˜ê´€ë¦¬ë¹„</option>
                            </select>
                        </td>
                        <td contenteditable="true">ìƒˆ ìƒì„¸ë¶„ë¥˜</td>
                        <td contenteditable="true">0</td>
                        <td contenteditable="true">ë¹„ê³ </td>
                        <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                    </tr>
                `;
            }
        }

        // ë°ì´í„° ì €ì¥ ê¸°ëŠ¥
        function saveExpenseData() {
            saveCurrentExpenseYear();

            // 2025ë…„ ë°ì´í„°ë¡œ ì¹´ë“œ ì—…ë°ì´íŠ¸ (ë©”ì¸ í™”ë©´ í‘œì‹œìš©, ë°±ë§Œì›ì„ ì–µì›ìœ¼ë¡œ ë³€í™˜)
            const data2025 = localStorage.getItem('expenseData_2025');
            if (data2025) {
                const parsed = JSON.parse(data2025);
                let total = 0;
                parsed.forEach(row => {
                    total += row.amount;
                });

                const expenseCard = document.querySelector('.stat-card[data-modal="expense"] .value');
                expenseCard.textContent = (total / 100).toFixed(1) + 'ì–µì›';
            }

            // ì„±ê³µ ë©”ì‹œì§€
            alert('ì§€ì¶œ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            closeModal('expense-modal');
        }

        // ì´ ìˆ˜ì… ì—°ë„ ì „í™˜ ê¸°ëŠ¥
        function switchIncomeYear(year) {
            saveCurrentIncomeYear();
            currentIncomeYear = year;

            document.querySelectorAll('.year-tab-button-income').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.year-tab-button-income[data-year="${year}"]`).classList.add('active');

            loadIncomeYear(year);
        }

        function saveCurrentIncomeYear() {
            const table = document.getElementById('income-table');
            const rows = table.querySelectorAll('tbody tr:not(.total-row)'); // í•©ê³„ í–‰ ì œì™¸

            const data = [];
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length >= 4) { // ìœ íš¨í•œ ë°ì´í„° í–‰ì¸ì§€ í™•ì¸
                    const rowData = {
                        item: cells[0].textContent,
                        amount: parseNumber(cells[1].textContent),
                        source: cells[2].textContent,
                        note: cells[3].textContent
                    };
                    data.push(rowData);
                }
            });

            localStorage.setItem(`incomeData_${currentIncomeYear}`, JSON.stringify(data));
        }

        function loadIncomeYear(year) {
            const savedData = localStorage.getItem(`incomeData_${year}`);
            const tbody = document.querySelector('#income-table tbody');
            tbody.innerHTML = '';

            if (savedData) {
                const data = JSON.parse(savedData);
                data.forEach(row => {
                    const tr = tbody.insertRow();
                    tr.innerHTML = `
                        <td contenteditable="true">${row.item}</td>
                        <td contenteditable="true">${formatNumber(row.amount)}</td>
                        <td contenteditable="true">${row.source}</td>
                        <td contenteditable="true">${row.note}</td>
                        <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                    `;
                });
                
                // ğŸ“Š í•©ê³„ í–‰ ì¶”ê°€
                addTotalRowToTable('income-table', data);
            } else {
                tbody.innerHTML = `
                    <tr>
                        <td contenteditable="true">ìƒˆ ìƒì„¸ë¶„ë¥˜</td>
                        <td contenteditable="true">0</td>
                        <td contenteditable="true">ê´€ë¦¬ë³´ìˆ˜</td>
                        <td contenteditable="true"></td>
                        <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                    </tr>
                `;
            }
        }

        function saveIncomeData() {
            saveCurrentIncomeYear();

            // ğŸ“Š í•©ê³„ í–‰ ì—…ë°ì´íŠ¸
            updateIncomeTotal();

            const data2025 = localStorage.getItem('incomeData_2025');
            if (data2025) {
                const parsed = JSON.parse(data2025);
                let total = 0;
                parsed.forEach(row => {
                    total += row.amount;
                });

                const incomeCard = document.querySelector('.stat-card[data-modal="income"] .value');
                incomeCard.textContent = (total / 100).toFixed(1) + 'ì–µì›';
            }

            // ğŸ“Š ë©”ì¸ í™”ë©´ í†µê³„ ì—…ë°ì´íŠ¸
            setTimeout(() => {
                updateMainStats();
                // ê·¸ë˜í”„ë„ ì—…ë°ì´íŠ¸
                createRevenueForecastChart();
            }, 100);

            alert('ìˆ˜ì… ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            closeModal('income-modal');
        }

        function saveBalanceData() {
            const table = document.getElementById('balance-table');
            const rows = table.querySelectorAll('tbody tr');
            let totalBalance = 0;

            const data = [];
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const rowData = {
                    account: cells[0].textContent,
                    amount: parseNumber(cells[1].textContent),
                    type: cells[2].textContent,
                    note: cells[3].textContent
                };
                totalBalance += rowData.amount;
                data.push(rowData);
            });

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem('balanceData', JSON.stringify(data));

            // ì”ì•¡ ì¹´ë“œ ì—…ë°ì´íŠ¸ (ë°±ë§Œì›ì„ ì–µì›ìœ¼ë¡œ ë³€í™˜)
            const balanceCard = document.querySelector('.stat-card[data-modal="balance"] .value');
            balanceCard.textContent = (totalBalance / 100).toFixed(1) + 'ì–µì›';

            // ì„±ê³µ ë©”ì‹œì§€
            alert('ì”ì•¡ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            closeModal('balance-modal');
        }

        // ========== ì—‘ì…€ ì—…ë¡œë“œ ê¸°ëŠ¥ ==========

        // ì´ ì§€ì¶œ ì—‘ì…€ ì—…ë¡œë“œ (ë…„ë„ë³„ ìë™ ë¶„ë¥˜)
        function uploadExpenseExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                const months = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];

                // ë…„ë„ë³„ë¡œ ë°ì´í„° ê·¸ë£¹í•‘
                const dataByYear = {};
                const detailDataByYear = {};

                jsonData.forEach(row => {
                    const year = (row['ë…„ë„'] || row['year'] || currentExpenseYear).toString();
                    const category = row['ë¶„ë¥˜'] || row['ëŒ€ë¶„ë¥˜'] || row['category'] || 'ì§€ì›';
                    const item = row['ìƒì„¸ë¶„ë¥˜'] || row['ì¤‘ë¶„ë¥˜'] || row['í•­ëª©'] || row['item'] || '';
                    const subitem = row['ì†Œë¶„ë¥˜'] || row['subitem'] || '';
                    const note = row['ë¹„ê³ '] || row['note'] || '';

                    // ë…„ë„ë³„ ê·¸ë£¹ ì´ˆê¸°í™”
                    if (!dataByYear[year]) {
                        dataByYear[year] = new Map();
                        detailDataByYear[year] = [];
                    }

                    // ì›”ë³„ ê¸ˆì•¡ í•©ì‚°
                    let amount = 0;
                    let hasMonthlyData = false;
                    const monthlyData = {};

                    months.forEach(month => {
                        if (row[month] !== undefined && row[month] !== '' && row[month] !== null) {
                            const monthAmount = parseNumber(row[month]);
                            amount += monthAmount;
                            monthlyData[month] = monthAmount;
                            hasMonthlyData = true;
                        }
                    });

                    // ì›”ë³„ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ ë°©ì‹ ì‚¬ìš© (í•˜ìœ„í˜¸í™˜ì„±)
                    if (!hasMonthlyData) {
                        amount = parseNumber(row['ê¸ˆì•¡'] || row['ê¸ˆì•¡ (ì›)'] || row['amount'] || 0);
                    }

                    // ì†Œë¶„ë¥˜ê°€ ìˆëŠ” ê²½ìš° ìƒì„¸ ë°ì´í„°ì— ì¶”ê°€
                    if (subitem) {
                        detailDataByYear[year].push({
                            category: category,
                            item: item,
                            subitem: subitem,
                            amount: amount,
                            monthly: hasMonthlyData ? monthlyData : null,
                            note: note
                        });
                    }

                    // ì¤‘ë¶„ë¥˜(ìƒì„¸ë¶„ë¥˜) ê¸ˆì•¡ ëˆ„ì  (ê°™ì€ í•­ëª©ì˜ ê¸ˆì•¡ í•©ì‚°)
                    const itemKey = `${category}|${item}`;
                    if (!dataByYear[year].has(itemKey)) {
                        dataByYear[year].set(itemKey, {
                            category: category,
                            item: item,
                            amount: 0,
                            monthly: {},
                            note: note
                        });
                    }
                    const itemData = dataByYear[year].get(itemKey);
                    itemData.amount += amount;

                    // ì›”ë³„ ë°ì´í„° ëˆ„ì 
                    if (hasMonthlyData) {
                        months.forEach(month => {
                            if (monthlyData[month]) {
                                itemData.monthly[month] = (itemData.monthly[month] || 0) + monthlyData[month];
                            }
                        });
                    }
                });

                // ëª¨ë“  ë…„ë„ì˜ ë°ì´í„°ë¥¼ localStorageì— ì €ì¥
                const importedYears = [];
                Object.keys(dataByYear).forEach(year => {
                    const mainData = Array.from(dataByYear[year].values());
                    localStorage.setItem(`expenseData_${year}`, JSON.stringify(mainData));

                    // ìƒì„¸ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì €ì¥
                    if (detailDataByYear[year] && detailDataByYear[year].length > 0) {
                        localStorage.setItem(`detailData_${year}`, JSON.stringify(detailDataByYear[year]));
                    }

                    importedYears.push(year);
                });

                // í˜„ì¬ ë…„ë„ì˜ ë°ì´í„°ê°€ ì—…ë¡œë“œë˜ì—ˆìœ¼ë©´ í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨
                if (dataByYear[currentExpenseYear]) {
                    loadExpenseYear(currentExpenseYear);
                }

                // ì—…ë¡œë“œ ì™„ë£Œ ë©”ì‹œì§€
                const totalDetailItems = Object.values(detailDataByYear).reduce((sum, arr) => sum + arr.length, 0);
                alert(`ì—‘ì…€ íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!\n` +
                      `ì—…ë¡œë“œëœ ë…„ë„: ${importedYears.sort().join(', ')}ë…„` +
                      (totalDetailItems > 0 ? `\nìƒì„¸ í•­ëª© ${totalDetailItems}ê°œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.` : ''));
            };
            reader.readAsArrayBuffer(file);
            event.target.value = ''; // ê°™ì€ íŒŒì¼ ì¬ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡
        }

        // ì´ ìˆ˜ì… ì—‘ì…€ ì—…ë¡œë“œ (ë…„ë„/í•­ëª©/ê¸ˆì•¡ í˜•ì‹)
        function uploadIncomeExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                // ìƒˆë¡œìš´ í˜•ì‹: ë…„ë„/í•­ëª©/ê¸ˆì•¡
                const dataByYear = {};
                let processedCount = 0;
                let errorCount = 0;

                jsonData.forEach((row, index) => {
                    try {
                        // ì»¬ëŸ¼ëª… ìœ ì—°í•˜ê²Œ ì²˜ë¦¬
                        const year = (row['ë…„ë„'] || row['Year'] || row['ì—°ë„'] || row['YEAR'] || '').toString();
                        const item = row['í•­ëª©'] || row['Item'] || row['ìƒì„¸ë¶„ë¥˜'] || row['ë¶„ë¥˜'] || '';
                        const amount = parseNumber(row['ê¸ˆì•¡'] || row['Amount'] || row['ê¸ˆì•¡(ì›)'] || 0);
                        
                        // ì› ë‹¨ìœ„ ê·¸ëŒ€ë¡œ ì‚¬ìš© (ìë™ ë³€í™˜ ì œê±°)

                        // í•„ìˆ˜ ë°ì´í„° ê²€ì¦
                        if (!year || !item || amount === 0) {
                            console.warn(`í–‰ ${index + 2}: í•„ìˆ˜ ë°ì´í„° ëˆ„ë½ - ë…„ë„: ${year}, í•­ëª©: ${item}, ê¸ˆì•¡: ${amount}`);
                            errorCount++;
                            return;
                        }

                        // ë…„ë„ë³„ ê·¸ë£¹ ì´ˆê¸°í™”
                        if (!dataByYear[year]) {
                            dataByYear[year] = [];
                        }

                        // ë°ì´í„° ì¶”ê°€
                        dataByYear[year].push({
                            item: item.trim(),
                            amount: amount,
                            source: 'ì—‘ì…€ ì—…ë¡œë“œ',
                            note: `${new Date().toLocaleDateString()} ì—…ë¡œë“œ`
                        });

                        processedCount++;
                    } catch (error) {
                        console.error(`í–‰ ${index + 2} ì²˜ë¦¬ ì˜¤ë¥˜:`, error);
                        errorCount++;
                    }
                });

                // ëª¨ë“  ë…„ë„ì˜ ë°ì´í„°ë¥¼ localStorageì— ì €ì¥
                const importedYears = [];
                Object.keys(dataByYear).forEach(year => {
                    localStorage.setItem(`incomeData_${year}`, JSON.stringify(dataByYear[year]));
                    importedYears.push(year);
                });

                // í˜„ì¬ ë…„ë„ì˜ ë°ì´í„°ê°€ ì—…ë¡œë“œë˜ì—ˆìœ¼ë©´ í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨
                if (dataByYear[currentIncomeYear]) {
                    loadIncomeYear(currentIncomeYear);
                }

                // ì—…ë¡œë“œ ì™„ë£Œ ë©”ì‹œì§€ (ìƒì„¸ ì •ë³´ í¬í•¨)
                const totalItems = Object.values(dataByYear).reduce((sum, arr) => sum + arr.length, 0);
                const yearSummary = importedYears.sort().map(year => {
                    const yearData = dataByYear[year];
                    const yearTotal = yearData.reduce((sum, item) => sum + item.amount, 0);
                    return `${year}ë…„: ${yearData.length}ê°œ í•­ëª©, ì´ ${new Intl.NumberFormat('ko-KR').format(yearTotal)}ì›`;
                }).join('\n');

                alert(`âœ… ì´ ìˆ˜ì… ì—‘ì…€ ì—…ë¡œë“œ ì™„ë£Œ!\n\n` +
                      `ğŸ“Š ì²˜ë¦¬ ê²°ê³¼:\n` +
                      `- ì„±ê³µ: ${processedCount}ê°œ í•­ëª©\n` +
                      `- ì˜¤ë¥˜: ${errorCount}ê°œ í•­ëª©\n\n` +
                      `ğŸ“… ë…„ë„ë³„ ìš”ì•½:\n${yearSummary}\n\n` +
                      `ğŸ’¡ í•´ë‹¹ ë…„ë„ íƒ­ì—ì„œ ì—…ë¡œë“œëœ ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”!`);

                // ğŸ“Š ë©”ì¸ í™”ë©´ í†µê³„ ì—…ë°ì´íŠ¸
                setTimeout(() => {
                    updateMainStats();
                    // ê·¸ë˜í”„ë„ ì—…ë°ì´íŠ¸
                    createRevenueForecastChart();
                }, 100);
            };
            reader.readAsArrayBuffer(file);
            event.target.value = '';
        }

        // ì”ì•¡ ì—‘ì…€ ì—…ë¡œë“œ
        function uploadBalanceExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                const tbody = document.querySelector('#balance-table tbody');
                tbody.innerHTML = '';

                jsonData.forEach(row => {
                    const tr = tbody.insertRow();
                    tr.innerHTML = `
                        <td contenteditable="true">${row['ê³„ì¢Œ/í•­ëª©'] || row['account'] || ''}</td>
                        <td contenteditable="true">${row['ì”ì•¡'] || row['ì”ì•¡ (ë°±ë§Œì›)'] || row['ì”ì•¡ (ì–µì›)'] || row['amount'] || 0}</td>
                        <td contenteditable="true">${row['ì¢…ë¥˜'] || row['type'] || ''}</td>
                        <td contenteditable="true">${row['ë¹„ê³ '] || row['note'] || ''}</td>
                        <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                    `;
                });

                alert('ì—‘ì…€ íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
            };
            reader.readAsArrayBuffer(file);
            event.target.value = '';
        }

        // ========== ì—‘ì…€ ì–‘ì‹ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ ==========

        // ì´ ì§€ì¶œ ì–‘ì‹ ë‹¤ìš´ë¡œë“œ (ì›”ë³„ ê¸ˆì•¡ ì…ë ¥ ë°©ì‹)
        function downloadExpenseTemplate() {
            const templateData = [
                {
                    'ë…„ë„': 2025,
                    'ë¶„ë¥˜': 'ì§€ì›',
                    'ìƒì„¸ë¶„ë¥˜': 'ë©˜í† ë§ë¹„',
                    'ì†Œë¶„ë¥˜': '',
                    '1ì›”': 30,
                    '2ì›”': 30,
                    '3ì›”': 30,
                    '4ì›”': 30,
                    '5ì›”': 30,
                    '6ì›”': 30,
                    '7ì›”': 25,
                    '8ì›”': 25,
                    '9ì›”': 25,
                    '10ì›”': 25,
                    '11ì›”': 25,
                    '12ì›”': 25,
                    'ë¹„ê³ ': 'ìŠ¤íƒ€íŠ¸ì—… ë©˜í† ë§ í”„ë¡œê·¸ë¨'
                },
                {
                    'ë…„ë„': 2025,
                    'ë¶„ë¥˜': 'ì¼ë°˜ê´€ë¦¬ë¹„',
                    'ìƒì„¸ë¶„ë¥˜': 'ì¸ê±´ë¹„',
                    'ì†Œë¶„ë¥˜': 'ê¸‰ì—¬',
                    '1ì›”': 40,
                    '2ì›”': 40,
                    '3ì›”': 40,
                    '4ì›”': 45,
                    '5ì›”': 45,
                    '6ì›”': 45,
                    '7ì›”': 45,
                    '8ì›”': 45,
                    '9ì›”': 45,
                    '10ì›”': 45,
                    '11ì›”': 45,
                    '12ì›”': 45,
                    'ë¹„ê³ ': 'ì§ì› ì›”ê¸‰ì—¬'
                },
                {
                    'ë…„ë„': 2024,
                    'ë¶„ë¥˜': 'ë°œêµ´',
                    'ìƒì„¸ë¶„ë¥˜': 'ë„¤íŠ¸ì›Œí‚¹ í–‰ì‚¬',
                    'ì†Œë¶„ë¥˜': '',
                    '1ì›”': 20,
                    '2ì›”': 0,
                    '3ì›”': 20,
                    '4ì›”': 0,
                    '5ì›”': 20,
                    '6ì›”': 0,
                    '7ì›”': 20,
                    '8ì›”': 0,
                    '9ì›”': 20,
                    '10ì›”': 0,
                    '11ì›”': 20,
                    '12ì›”': 0,
                    'ë¹„ê³ ': 'ê²©ì›” ë„¤íŠ¸ì›Œí‚¹ ì´ë²¤íŠ¸'
                },
                {
                    'ë…„ë„': 2024,
                    'ë¶„ë¥˜': 'ì¼ë°˜ê´€ë¦¬ë¹„',
                    'ìƒì„¸ë¶„ë¥˜': 'ì¸ê±´ë¹„',
                    'ì†Œë¶„ë¥˜': 'ìƒì—¬ê¸ˆ',
                    '1ì›”': 0,
                    '2ì›”': 0,
                    '3ì›”': 0,
                    '4ì›”': 0,
                    '5ì›”': 0,
                    '6ì›”': 100,
                    '7ì›”': 0,
                    '8ì›”': 0,
                    '9ì›”': 0,
                    '10ì›”': 0,
                    '11ì›”': 0,
                    '12ì›”': 100,
                    'ë¹„ê³ ': 'ìƒë°˜ê¸°/í•˜ë°˜ê¸° ì„±ê³¼ê¸‰'
                }
            ];

            const worksheet = XLSX.utils.json_to_sheet(templateData);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'ì´ ì§€ì¶œ ì–‘ì‹');

            // ì°¸ê³ ì‚¬í•­ ì‹œíŠ¸ ì¶”ê°€
            const notesData = [
                { 'í•­ëª©': 'ë…„ë„', 'ì„¤ëª…': 'ë°ì´í„°ê°€ ì†í•œ ë…„ë„ (ì˜ˆ: 2025, 2024)', 'í•„ìˆ˜': 'O' },
                { 'í•­ëª©': 'ë¶„ë¥˜', 'ì„¤ëª…': 'ì§€ì›, ë°œêµ´, ì¼ë°˜ê´€ë¦¬ë¹„ ì¤‘ ì„ íƒ', 'í•„ìˆ˜': 'O' },
                { 'í•­ëª©': 'ìƒì„¸ë¶„ë¥˜', 'ì„¤ëª…': 'ì¤‘ë¶„ë¥˜ í•­ëª©ëª… (ì˜ˆ: ì¸ê±´ë¹„, ë©˜í† ë§ë¹„)', 'í•„ìˆ˜': 'O' },
                { 'í•­ëª©': 'ì†Œë¶„ë¥˜', 'ì„¤ëª…': 'ìƒì„¸ í•­ëª©ëª… (ì„ íƒì‚¬í•­, ì…ë ¥ ì‹œ ì°¨íŠ¸ í´ë¦­ìœ¼ë¡œ ì¡°íšŒ ê°€ëŠ¥)', 'í•„ìˆ˜': 'X' },
                { 'í•­ëª©': '1ì›”~12ì›”', 'ì„¤ëª…': 'ê° ì›”ë³„ ê¸ˆì•¡ ì…ë ¥ (ì› ë‹¨ìœ„)', 'í•„ìˆ˜': 'O' },
                { 'í•­ëª©': 'ë¹„ê³ ', 'ì„¤ëª…': 'ì¶”ê°€ ì„¤ëª…', 'í•„ìˆ˜': 'X' },
                { 'í•­ëª©': '', 'ì„¤ëª…': '', 'í•„ìˆ˜': '' },
                { 'í•­ëª©': 'ğŸ’¡ TIP', 'ì„¤ëª…': 'ë…„ë„ë³„ë¡œ ìë™ ë¶„ë¥˜ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤. í•œ íŒŒì¼ì— ì—¬ëŸ¬ ë…„ë„ ë°ì´í„° ì…ë ¥ ê°€ëŠ¥!', 'í•„ìˆ˜': '' }
            ];
            const notesSheet = XLSX.utils.json_to_sheet(notesData);
            XLSX.utils.book_append_sheet(workbook, notesSheet, 'ì‘ì„± ê°€ì´ë“œ');

            XLSX.writeFile(workbook, 'ì´_ì§€ì¶œ_ì—…ë¡œë“œ_ì–‘ì‹.xlsx');
        }

        // ì´ ìˆ˜ì… ì–‘ì‹ ë‹¤ìš´ë¡œë“œ
        function downloadIncomeTemplate() {
            const templateData = [
                {
                    'ë…„ë„': 2025,
                    'í•­ëª©': 'ì •ë¶€ì§€ì›ì‚¬ì—…',
                    'ê¸ˆì•¡': 850000000
                },
                {
                    'ë…„ë„': 2025,
                    'í•­ëª©': 'ê´€ë¦¬ë³´ìˆ˜',
                    'ê¸ˆì•¡': 620000000
                },
                {
                    'ë…„ë„': 2025,
                    'í•­ëª©': 'ê´€ë¦¬ë³´ìˆ˜',
                    'ê¸ˆì•¡': 430000000
                },
                {
                    'ë…„ë„': 2025,
                    'í•­ëª©': 'ê´€ë¦¬ë³´ìˆ˜',
                    'ê¸ˆì•¡': 350000000
                },
                {
                    'ë…„ë„': 2024,
                    'í•­ëª©': 'ê´€ë¦¬ë³´ìˆ˜',
                    'ê¸ˆì•¡': 580000000
                },
                {
                    'ë…„ë„': 2024,
                    'í•­ëª©': 'ê´€ë¦¬ë³´ìˆ˜',
                    'ê¸ˆì•¡': 370000000
                },
                {
                    'ë…„ë„': 2023,
                    'í•­ëª©': 'ì •ë¶€ì§€ì›ì‚¬ì—…',
                    'ê¸ˆì•¡': 720000000
                },
                {
                    'ë…„ë„': 2023,
                    'í•­ëª©': 'ê´€ë¦¬ë³´ìˆ˜',
                    'ê¸ˆì•¡': 280000000
                }
            ];

            // ì‚¬ìš© ì•ˆë‚´ ì‹œíŠ¸
            const notesData = [
                { 'ì»¬ëŸ¼ëª…': 'ë…„ë„', 'ì„¤ëª…': 'ë°ì´í„°ê°€ ì†í•œ ë…„ë„ (ì˜ˆ: 2025, 2024)', 'í•„ìˆ˜ì—¬ë¶€': 'í•„ìˆ˜', 'ì˜ˆì‹œ': '2025' },
                { 'ì»¬ëŸ¼ëª…': 'í•­ëª©', 'ì„¤ëª…': 'ìˆ˜ì… í•­ëª© ì´ë¦„', 'í•„ìˆ˜ì—¬ë¶€': 'í•„ìˆ˜', 'ì˜ˆì‹œ': 'ì •ë¶€ ì§€ì›ê¸ˆ' },
                { 'ì»¬ëŸ¼ëª…': 'ê¸ˆì•¡', 'ì„¤ëª…': 'ìˆ˜ì… ê¸ˆì•¡ (ì› ë‹¨ìœ„)', 'í•„ìˆ˜ì—¬ë¶€': 'í•„ìˆ˜', 'ì˜ˆì‹œ': '850000000' },
                { 'ì»¬ëŸ¼ëª…': '', 'ì„¤ëª…': '', 'í•„ìˆ˜ì—¬ë¶€': '', 'ì˜ˆì‹œ': '' },
                { 'ì»¬ëŸ¼ëª…': 'ğŸ“‹ ì‚¬ìš©ë²•', 'ì„¤ëª…': '1. ë…„ë„, í•­ëª©, ê¸ˆì•¡ 3ê°œ ì»¬ëŸ¼ë§Œ ì…ë ¥í•˜ì„¸ìš”', 'í•„ìˆ˜ì—¬ë¶€': '', 'ì˜ˆì‹œ': '' },
                { 'ì»¬ëŸ¼ëª…': '', 'ì„¤ëª…': '2. ê¸ˆì•¡ì€ ì› ë‹¨ìœ„ë¡œ ì…ë ¥ (ì˜ˆ: 8ì–µ5ì²œë§Œì› â†’ 850000000)', 'í•„ìˆ˜ì—¬ë¶€': '', 'ì˜ˆì‹œ': '' },
                { 'ì»¬ëŸ¼ëª…': '', 'ì„¤ëª…': '3. ì—¬ëŸ¬ ë…„ë„ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ì—…ë¡œë“œ ê°€ëŠ¥', 'í•„ìˆ˜ì—¬ë¶€': '', 'ì˜ˆì‹œ': '' },
                { 'ì»¬ëŸ¼ëª…': '', 'ì„¤ëª…': '4. ì—…ë¡œë“œ í›„ í•´ë‹¹ ë…„ë„ íƒ­ì—ì„œ í™•ì¸', 'í•„ìˆ˜ì—¬ë¶€': '', 'ì˜ˆì‹œ': '' },
                { 'ì»¬ëŸ¼ëª…': 'ğŸ’¡ TIP', 'ì„¤ëª…': 'ì»¬ëŸ¼ëª…ì€ ë…„ë„/Year, í•­ëª©/Item, ê¸ˆì•¡/Amount ë“± ìœ ì—°í•˜ê²Œ ì¸ì‹ë©ë‹ˆë‹¤', 'í•„ìˆ˜ì—¬ë¶€': '', 'ì˜ˆì‹œ': '' }
            ];

            const worksheet = XLSX.utils.json_to_sheet(templateData);
            const notesSheet = XLSX.utils.json_to_sheet(notesData);

            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'ì´ ìˆ˜ì… ì–‘ì‹');
            XLSX.utils.book_append_sheet(workbook, notesSheet, 'ì‚¬ìš© ì•ˆë‚´');

            XLSX.writeFile(workbook, 'ì´_ìˆ˜ì…_ì—…ë¡œë“œ_ì–‘ì‹.xlsx');
        }

        // ì”ì•¡ ì–‘ì‹ ë‹¤ìš´ë¡œë“œ
        function downloadBalanceTemplate() {
            const templateData = [
                {
                    'ê³„ì¢Œ/í•­ëª©': 'ìš´ì˜ìê¸ˆ ê³„ì¢Œ',
                    'ì”ì•¡ (ë°±ë§Œì›)': 210,
                    'ì¢…ë¥˜': 'ì˜ˆê¸ˆ',
                    'ë¹„ê³ ': 'ì¼ìƒ ìš´ì˜ ìê¸ˆ'
                },
                {
                    'ê³„ì¢Œ/í•­ëª©': 'íˆ¬ì í€ë“œ',
                    'ì”ì•¡ (ë°±ë§Œì›)': 150,
                    'ì¢…ë¥˜': 'íˆ¬ì',
                    'ë¹„ê³ ': 'ìŠ¤íƒ€íŠ¸ì—… íˆ¬ìê¸ˆ'
                }
            ];

            const worksheet = XLSX.utils.json_to_sheet(templateData);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'ì”ì•¡ ì–‘ì‹');

            XLSX.writeFile(workbook, 'ì”ì•¡_ì—…ë¡œë“œ_ì–‘ì‹.xlsx');
        }

        // ========== ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ ==========

        // ì´ ì§€ì¶œ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
        function downloadExpenseExcel() {
            // localStorageì—ì„œ ì›”ë³„ ë°ì´í„° ë¡œë“œ ì‹œë„
            const savedData = localStorage.getItem(`expenseData_${currentExpenseYear}`);
            const data = [];
            const months = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];

            if (savedData) {
                try {
                    const items = JSON.parse(savedData);
                    items.forEach(item => {
                        const rowData = {
                            'ë¶„ë¥˜': item.category,
                            'ìƒì„¸ë¶„ë¥˜': item.item,
                            'ì†Œë¶„ë¥˜': ''
                        };

                        // ì›”ë³„ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì›”ë³„ë¡œ í¼ì¹¨
                        if (item.monthly && Object.keys(item.monthly).length > 0) {
                            months.forEach(month => {
                                rowData[month] = item.monthly[month] || 0;
                            });
                        } else {
                            // ì›”ë³„ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì´ì•¡ë§Œ
                            rowData['ê¸ˆì•¡ (ì›)'] = item.amount || 0;
                        }

                        rowData['ë¹„ê³ '] = item.note || '';
                        data.push(rowData);
                    });
                } catch (e) {
                    // JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ í…Œì´ë¸”ì—ì„œ ì½ê¸°
                    console.error('Failed to parse saved data:', e);
                }
            }

            // localStorageì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ í˜„ì¬ í…Œì´ë¸”ì—ì„œ ì½ê¸°
            if (data.length === 0) {
                const table = document.getElementById('expense-table');
                const rows = table.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    const selectElement = cells[0].querySelector('select');
                    data.push({
                        'ë¶„ë¥˜': selectElement ? selectElement.value : cells[0].textContent,
                        'ìƒì„¸ë¶„ë¥˜': cells[1].textContent,
                        'ê¸ˆì•¡ (ì›)': parseNumber(cells[2].textContent),
                        'ë¹„ê³ ': cells[3].textContent
                    });
                });
            }

            const worksheet = XLSX.utils.json_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'ì´ ì§€ì¶œ');

            XLSX.writeFile(workbook, `ì´_ì§€ì¶œ_ë°ì´í„°_${currentExpenseYear}.xlsx`);
        }

        // ì´ ìˆ˜ì… ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
        function downloadIncomeExcel() {
            const table = document.getElementById('income-table');
            const rows = table.querySelectorAll('tbody tr');

            const data = [];
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                data.push({
                    'ìƒì„¸ë¶„ë¥˜': cells[0].textContent,
                    'ê¸ˆì•¡ (ì›)': parseNumber(cells[1].textContent),
                    'ìˆ˜ì…ì›': cells[2].textContent,
                    'ë¹„ê³ ': cells[3].textContent
                });
            });

            const worksheet = XLSX.utils.json_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'ì´ ìˆ˜ì…');

            XLSX.writeFile(workbook, 'ì´_ìˆ˜ì…_ë°ì´í„°.xlsx');
        }

        // ì”ì•¡ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
        function downloadBalanceExcel() {
            const table = document.getElementById('balance-table');
            const rows = table.querySelectorAll('tbody tr');

            const data = [];
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                data.push({
                    'ê³„ì¢Œ/í•­ëª©': cells[0].textContent,
                    'ì”ì•¡ (ë°±ë§Œì›)': parseNumber(cells[1].textContent),
                    'ì¢…ë¥˜': cells[2].textContent,
                    'ë¹„ê³ ': cells[3].textContent
                });
            });

            const worksheet = XLSX.utils.json_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'ì”ì•¡');

            XLSX.writeFile(workbook, 'ì”ì•¡_ë°ì´í„°.xlsx');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        window.addEventListener('load', () => {
            // ê¸°ì¡´ expenseDataë¥¼ expenseData_2025ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
            const oldExpenseData = localStorage.getItem('expenseData');
            if (oldExpenseData && !localStorage.getItem('expenseData_2025')) {
                localStorage.setItem('expenseData_2025', oldExpenseData);
                localStorage.removeItem('expenseData');
            }

            // 2025ë…„ ì§€ì¶œ ë°ì´í„°ë¡œ ì¹´ë“œ ì—…ë°ì´íŠ¸ (ë°±ë§Œì›ì„ ì–µì›ìœ¼ë¡œ ë³€í™˜)
            const expenseData2025 = localStorage.getItem('expenseData_2025');
            if (expenseData2025) {
                const data = JSON.parse(expenseData2025);
                let total = 0;
                data.forEach(row => {
                    total += row.amount;
                });
                const expenseCard = document.querySelector('.stat-card[data-modal="expense"] .value');
                expenseCard.textContent = (total / 100).toFixed(1) + 'ì–µì›';
            }

            // ê¸°ì¡´ incomeDataë¥¼ incomeData_2025ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
            const oldIncomeData = localStorage.getItem('incomeData');
            if (oldIncomeData && !localStorage.getItem('incomeData_2025')) {
                localStorage.setItem('incomeData_2025', oldIncomeData);
                localStorage.removeItem('incomeData');
            }

            // 2025ë…„ ìˆ˜ì… ë°ì´í„°ë¡œ ì¹´ë“œ ì—…ë°ì´íŠ¸ (ë°±ë§Œì›ì„ ì–µì›ìœ¼ë¡œ ë³€í™˜)
            const incomeData2025 = localStorage.getItem('incomeData_2025');
            if (incomeData2025) {
                const data = JSON.parse(incomeData2025);
                let total = 0;
                data.forEach(row => {
                    total += row.amount;
                });
                const incomeCard = document.querySelector('.stat-card[data-modal="income"] .value');
                incomeCard.textContent = (total / 100).toFixed(1) + 'ì–µì›';
            }

            // ì”ì•¡ ë°ì´í„° ë¡œë“œ
            const balanceData = localStorage.getItem('balanceData');
            if (balanceData) {
                const data = JSON.parse(balanceData);
                const tbody = document.querySelector('#balance-table tbody');
                tbody.innerHTML = '';
                let total = 0;
                data.forEach(row => {
                    const tr = tbody.insertRow();
                    tr.innerHTML = `
                        <td contenteditable="true">${row.account}</td>
                        <td contenteditable="true">${formatNumber(row.amount)}</td>
                        <td contenteditable="true">${row.type}</td>
                        <td contenteditable="true">${row.note}</td>
                        <td><button class="btn-delete" onclick="deleteRow(this)"><i class="fas fa-trash"></i></button></td>
                    `;
                    total += row.amount;
                });
                const balanceCard = document.querySelector('.stat-card[data-modal="balance"] .value');
                balanceCard.textContent = (total / 100).toFixed(1) + 'ì–µì›';
            }
        });

        // í˜„ì¬ ì„ íƒëœ ì°¨íŠ¸ ì—°ë„
        let currentChartYear = '2025';

        // ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ì €ì¥
        let supportChart, discoveryChart, generalChart, categoryComparisonChart;

        // ì˜ˆìœ ìƒ‰ìƒ íŒ”ë ˆíŠ¸
        const colorPalette1 = [
            '#6366F1', // ì¸ë””ê³ 
            '#8B5CF6', // ë³´ë¼
            '#EC4899', // í•‘í¬
            '#F59E0B', // ì•°ë²„
            '#10B981'  // ì—ë©”ë„ë“œ
        ];

        const colorPalette2 = [
            '#3B82F6', // ë¸”ë£¨
            '#06B6D4', // ì‹œì•ˆ
            '#14B8A6', // í‹¸
            '#10B981', // ê·¸ë¦°
            '#84CC16'  // ë¼ì„
        ];

        const colorPalette3 = [
            '#F59E0B', // ì•°ë²„
            '#EF4444', // ë ˆë“œ
            '#EC4899', // í•‘í¬
            '#A855F7', // í¼í”Œ
            '#6366F1'  // ì¸ë””ê³ 
        ];

        // 1. ì§€ì› ì„¸ë¶€í•­ëª© (ë„ë„› ì°¨íŠ¸)
        const supportCtx = document.getElementById('supportChart').getContext('2d');
        supportChart = new Chart(supportCtx, {
            type: 'doughnut',
            data: {
                labels: ['ë©˜í† ë§ë¹„', 'êµìœ¡ì§€ì›ë¹„', 'ê³µê°„ì§€ì›ë¹„', 'ë§ˆì¼€íŒ…ì§€ì›ë¹„', 'ê¸°íƒ€ì§€ì›'],
                datasets: [{
                    data: [350, 280, 210, 150, 80],
                    backgroundColor: colorPalette1,
                    borderWidth: 3,
                    borderColor: '#ffffff',
                    hoverBorderWidth: 5,
                    hoverBorderColor: '#ffffff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                onClick: (event, activeElements) => {
                    if (activeElements.length > 0) {
                        const index = activeElements[0].index;
                        const itemName = supportChart.data.labels[index];
                        openDetailModal('ì§€ì›', itemName, currentChartYear);
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            font: {
                                size: 11
                            }
                        },
                        onClick: (event, legendItem, legend) => {
                            const index = legendItem.index;
                            const itemName = supportChart.data.labels[index];
                            openDetailModal('ì§€ì›', itemName, currentChartYear);
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + formatNumber(context.parsed) + 'ë°±ë§Œì›';
                            }
                        }
                    }
                }
            }
        });

        // 2. ë°œêµ´ ì„¸ë¶€í•­ëª© (ë„ë„› ì°¨íŠ¸)
        const discoveryCtx = document.getElementById('discoveryChart').getContext('2d');
        discoveryChart = new Chart(discoveryCtx, {
            type: 'doughnut',
            data: {
                labels: ['ë„¤íŠ¸ì›Œí‚¹ í–‰ì‚¬', 'ìŠ¤ì¹´ìš°íŒ…', 'ë°ëª¨ë°ì´', 'IR ì§€ì›', 'í‰ê°€ë¹„ìš©'],
                datasets: [{
                    data: [220, 180, 150, 120, 90],
                    backgroundColor: colorPalette2,
                    borderWidth: 3,
                    borderColor: '#ffffff',
                    hoverBorderWidth: 5,
                    hoverBorderColor: '#ffffff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                onClick: (event, activeElements) => {
                    if (activeElements.length > 0) {
                        const index = activeElements[0].index;
                        const itemName = discoveryChart.data.labels[index];
                        openDetailModal('ë°œêµ´', itemName, currentChartYear);
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            font: {
                                size: 11
                            }
                        },
                        onClick: (event, legendItem, legend) => {
                            const index = legendItem.index;
                            const itemName = discoveryChart.data.labels[index];
                            openDetailModal('ë°œêµ´', itemName, currentChartYear);
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + formatNumber(context.parsed) + 'ë°±ë§Œì›';
                            }
                        }
                    }
                }
            }
        });

        // 3. ì¼ë°˜ê´€ë¦¬ë¹„ ì„¸ë¶€í•­ëª© (ë„ë„› ì°¨íŠ¸)
        const generalCtx = document.getElementById('generalChart').getContext('2d');
        generalChart = new Chart(generalCtx, {
            type: 'doughnut',
            data: {
                labels: ['ì¸ê±´ë¹„', 'ì‚¬ë¬´ì‹¤ ì„ì°¨ë£Œ', 'ìš´ì˜ë¹„', 'ì‹œìŠ¤í…œ ìš´ì˜', 'ê¸°íƒ€ ê²½ë¹„'],
                datasets: [{
                    data: [450, 210, 130, 80, 50],
                    backgroundColor: colorPalette3,
                    borderWidth: 3,
                    borderColor: '#ffffff',
                    hoverBorderWidth: 5,
                    hoverBorderColor: '#ffffff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                onClick: (event, activeElements) => {
                    if (activeElements.length > 0) {
                        const index = activeElements[0].index;
                        const itemName = generalChart.data.labels[index];
                        openDetailModal('ì¼ë°˜ê´€ë¦¬ë¹„', itemName, currentChartYear);
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            font: {
                                size: 11
                            }
                        },
                        onClick: (event, legendItem, legend) => {
                            const index = legendItem.index;
                            const itemName = generalChart.data.labels[index];
                            openDetailModal('ì¼ë°˜ê´€ë¦¬ë¹„', itemName, currentChartYear);
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + formatNumber(context.parsed) + 'ë°±ë§Œì›';
                            }
                        }
                    }
                }
            }
        });

        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // ì„ íƒëœ íƒ­ í™œì„±í™”
            const selectedButton = document.querySelector(`.tab-button[data-tab="${tabName}"]`);
            if (selectedButton) {
                selectedButton.classList.add('active');
            }

            const selectedContent = document.getElementById(`${tabName}-tab`);
            if (selectedContent) {
                selectedContent.classList.add('active');
            }

            // í•´ë‹¹ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            setTimeout(() => {
                const tabsContainer = document.querySelector('.tabs-container');
                if (tabsContainer) {
                    tabsContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }, 100);
        }

        // 4. ëŒ€ë¶„ë¥˜ ë¹„êµ ì°¨íŠ¸ (ë„ë„› ì°¨íŠ¸)
        const categoryComparisonCtx = document.getElementById('categoryComparisonChart').getContext('2d');
        categoryComparisonChart = new Chart(categoryComparisonCtx, {
            type: 'doughnut',
            data: {
                labels: ['ì§€ì›', 'ë°œêµ´', 'ì¼ë°˜ê´€ë¦¬ë¹„'],
                datasets: [{
                    data: [1070, 760, 920],
                    backgroundColor: [
                        '#6366F1',  // ì§€ì› - ì¸ë””ê³ 
                        '#14B8A6',  // ë°œêµ´ - í‹¸
                        '#F59E0B'   // ì¼ë°˜ê´€ë¦¬ë¹„ - ì•°ë²„
                    ],
                    borderWidth: 4,
                    borderColor: '#ffffff',
                    hoverBorderWidth: 6,
                    hoverBorderColor: '#ffffff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                onClick: (event, activeElements) => {
                    if (activeElements.length > 0) {
                        const index = activeElements[0].index;
                        const tabNames = ['support', 'discovery', 'general'];
                        switchTab(tabNames[index]);
                    }
                },
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            padding: 20,
                            font: {
                                size: 13,
                                weight: '600'
                            },
                            usePointStyle: true,
                            pointStyle: 'circle'
                        },
                        onClick: (event, legendItem, legend) => {
                            const index = legendItem.index;
                            const tabNames = ['support', 'discovery', 'general'];
                            switchTab(tabNames[index]);
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((context.parsed / total) * 100).toFixed(1);
                                return context.label + ': ' + formatNumber(context.parsed) + 'ë°±ë§Œì› (' + percentage + '%)';
                            }
                        }
                    }
                }
            }
        });

        // ì˜µì…˜ 2: ì°¨íŠ¸/í‘œ ì „í™˜ í•¨ìˆ˜
        function switchView(view) {
            const chartBtn = document.getElementById('view-chart-btn');
            const tableBtn = document.getElementById('view-table-btn');

            // ëª¨ë“  íƒ­ì˜ ì°¨íŠ¸ì™€ í…Œì´ë¸” ìš”ì†Œ ì„ íƒ
            const chartContainers = document.querySelectorAll('.tab-content > div[style*="max-height: 350px"]');
            const tableContainers = document.querySelectorAll('.expense-detail-table');

            if (view === 'chart') {
                // ì°¨íŠ¸ ë³´ê¸°
                chartBtn.style.background = '#3B82F6';
                chartBtn.style.color = 'white';
                tableBtn.style.background = 'transparent';
                tableBtn.style.color = '#64748b';

                chartContainers.forEach(el => el.style.display = 'block');
                tableContainers.forEach(el => el.style.display = 'none');
            } else {
                // í‘œ ë³´ê¸°
                tableBtn.style.background = '#3B82F6';
                tableBtn.style.color = 'white';
                chartBtn.style.background = 'transparent';
                chartBtn.style.color = '#64748b';

                chartContainers.forEach(el => el.style.display = 'none');
                tableContainers.forEach(el => el.style.display = 'block');
            }
        }

        // ì˜µì…˜ 3: ì „ì²´ í†µí•© í‘œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateSummaryTable(supportData, discoveryData, generalData) {
            const tbody = document.getElementById('expense-summary-tbody');
            tbody.innerHTML = '';

            // ìƒ‰ìƒ ì •ì˜
            const categoryColors = {
                'ì§€ì›': { bg: 'rgba(59, 130, 246, 0.08)', text: '#3B82F6', border: 'rgba(59, 130, 246, 0.2)' },
                'ë°œêµ´': { bg: 'rgba(139, 92, 246, 0.08)', text: '#8B5CF6', border: 'rgba(139, 92, 246, 0.2)' },
                'ì¼ë°˜ê´€ë¦¬ë¹„': { bg: 'rgba(16, 185, 129, 0.08)', text: '#10b981', border: 'rgba(16, 185, 129, 0.2)' }
            };

            // ì§€ì› ë°ì´í„° ì¶”ê°€
            const supportTotal = Object.values(supportData).reduce((a, b) => a + b, 0);
            if (Object.keys(supportData).length > 0) {
                Object.entries(supportData).forEach(([item, amount], index) => {
                    const ratio = supportTotal > 0 ? ((amount / supportTotal) * 100).toFixed(1) : 0;
                    const colors = categoryColors['ì§€ì›'];
                    tbody.innerHTML += `
                        <tr style="background: ${colors.bg}; border-left: 3px solid ${colors.text};">
                            <td style="padding: 12px; color: ${colors.text}; font-weight: 600; border-bottom: 1px solid ${colors.border};">${index === 0 ? 'ì§€ì›' : ''}</td>
                            <td style="padding: 12px; color: #334155; border-bottom: 1px solid ${colors.border};">${item}</td>
                            <td style="padding: 12px; text-align: right; color: #334155; font-weight: 600; border-bottom: 1px solid ${colors.border};">${formatNumber(amount)}</td>
                            <td style="padding: 12px; text-align: right; color: ${colors.text}; font-weight: 600; border-bottom: 1px solid ${colors.border};">${ratio}%</td>
                        </tr>
                    `;
                });
                tbody.innerHTML += `
                    <tr style="background: rgba(59, 130, 246, 0.15); border-left: 3px solid #3B82F6;">
                        <td style="padding: 12px; color: #3B82F6; font-weight: 700; border-bottom: 2px solid #3B82F6;">ì†Œê³„</td>
                        <td style="padding: 12px; border-bottom: 2px solid #3B82F6;"></td>
                        <td style="padding: 12px; text-align: right; color: #3B82F6; font-weight: 700; border-bottom: 2px solid #3B82F6;">${formatNumber(supportTotal)}</td>
                        <td style="padding: 12px; text-align: right; color: #3B82F6; font-weight: 700; border-bottom: 2px solid #3B82F6;">100%</td>
                    </tr>
                `;
            }

            // ë°œêµ´ ë°ì´í„° ì¶”ê°€
            const discoveryTotal = Object.values(discoveryData).reduce((a, b) => a + b, 0);
            if (Object.keys(discoveryData).length > 0) {
                Object.entries(discoveryData).forEach(([item, amount], index) => {
                    const ratio = discoveryTotal > 0 ? ((amount / discoveryTotal) * 100).toFixed(1) : 0;
                    const colors = categoryColors['ë°œêµ´'];
                    tbody.innerHTML += `
                        <tr style="background: ${colors.bg}; border-left: 3px solid ${colors.text};">
                            <td style="padding: 12px; color: ${colors.text}; font-weight: 600; border-bottom: 1px solid ${colors.border};">${index === 0 ? 'ë°œêµ´' : ''}</td>
                            <td style="padding: 12px; color: #334155; border-bottom: 1px solid ${colors.border};">${item}</td>
                            <td style="padding: 12px; text-align: right; color: #334155; font-weight: 600; border-bottom: 1px solid ${colors.border};">${formatNumber(amount)}</td>
                            <td style="padding: 12px; text-align: right; color: ${colors.text}; font-weight: 600; border-bottom: 1px solid ${colors.border};">${ratio}%</td>
                        </tr>
                    `;
                });
                tbody.innerHTML += `
                    <tr style="background: rgba(139, 92, 246, 0.15); border-left: 3px solid #8B5CF6;">
                        <td style="padding: 12px; color: #8B5CF6; font-weight: 700; border-bottom: 2px solid #8B5CF6;">ì†Œê³„</td>
                        <td style="padding: 12px; border-bottom: 2px solid #8B5CF6;"></td>
                        <td style="padding: 12px; text-align: right; color: #8B5CF6; font-weight: 700; border-bottom: 2px solid #8B5CF6;">${formatNumber(discoveryTotal)}</td>
                        <td style="padding: 12px; text-align: right; color: #8B5CF6; font-weight: 700; border-bottom: 2px solid #8B5CF6;">100%</td>
                    </tr>
                `;
            }

            // ì¼ë°˜ê´€ë¦¬ë¹„ ë°ì´í„° ì¶”ê°€
            const generalTotal = Object.values(generalData).reduce((a, b) => a + b, 0);
            if (Object.keys(generalData).length > 0) {
                Object.entries(generalData).forEach(([item, amount], index) => {
                    const ratio = generalTotal > 0 ? ((amount / generalTotal) * 100).toFixed(1) : 0;
                    const colors = categoryColors['ì¼ë°˜ê´€ë¦¬ë¹„'];
                    tbody.innerHTML += `
                        <tr style="background: ${colors.bg}; border-left: 3px solid ${colors.text};">
                            <td style="padding: 12px; color: ${colors.text}; font-weight: 600; border-bottom: 1px solid ${colors.border};">${index === 0 ? 'ì¼ë°˜ê´€ë¦¬ë¹„' : ''}</td>
                            <td style="padding: 12px; color: #334155; border-bottom: 1px solid ${colors.border};">${item}</td>
                            <td style="padding: 12px; text-align: right; color: #334155; font-weight: 600; border-bottom: 1px solid ${colors.border};">${formatNumber(amount)}</td>
                            <td style="padding: 12px; text-align: right; color: ${colors.text}; font-weight: 600; border-bottom: 1px solid ${colors.border};">${ratio}%</td>
                        </tr>
                    `;
                });
                tbody.innerHTML += `
                    <tr style="background: rgba(16, 185, 129, 0.15); border-left: 3px solid #10b981;">
                        <td style="padding: 12px; color: #10b981; font-weight: 700; border-bottom: 2px solid #10b981;">ì†Œê³„</td>
                        <td style="padding: 12px; border-bottom: 2px solid #10b981;"></td>
                        <td style="padding: 12px; text-align: right; color: #10b981; font-weight: 700; border-bottom: 2px solid #10b981;">${formatNumber(generalTotal)}</td>
                        <td style="padding: 12px; text-align: right; color: #10b981; font-weight: 700; border-bottom: 2px solid #10b981;">100%</td>
                    </tr>
                `;
            }

            // ì „ì²´ í•©ê³„
            const grandTotal = supportTotal + discoveryTotal + generalTotal;
            tbody.innerHTML += `
                <tr style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(6, 182, 212, 0.2) 100%); border-top: 3px solid #3B82F6;">
                    <td colspan="2" style="padding: 15px; color: #1e293b; font-weight: 700; font-size: 1.05rem;">ì´ í•©ê³„</td>
                    <td style="padding: 15px; text-align: right; color: #1e293b; font-weight: 700; font-size: 1.05rem;">${formatNumber(grandTotal)}</td>
                    <td style="padding: 15px;"></td>
                </tr>
            `;
        }

        // ì˜µì…˜ 1: ìƒì„¸ í…Œì´ë¸” ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateDetailTables(supportData, discoveryData, generalData) {
            // ì§€ì› í…Œì´ë¸”
            const supportTotal = Object.values(supportData).reduce((a, b) => a + b, 0);
            const supportTbody = document.getElementById('support-detail-tbody');
            supportTbody.innerHTML = '';
            Object.entries(supportData).forEach(([item, amount]) => {
                const ratio = supportTotal > 0 ? ((amount / supportTotal) * 100).toFixed(1) : 0;
                supportTbody.innerHTML += `
                    <tr style="border-bottom: 1px solid rgba(59, 130, 246, 0.1);">
                        <td style="padding: 10px; color: #334155;">${item}</td>
                        <td style="padding: 10px; text-align: right; color: #334155; font-weight: 600;">${formatNumber(amount)}</td>
                        <td style="padding: 10px; text-align: right; color: #3B82F6; font-weight: 600;">${ratio}%</td>
                    </tr>
                `;
            });
            supportTbody.innerHTML += `
                <tr style="background: rgba(59, 130, 246, 0.05); font-weight: 700;">
                    <td style="padding: 12px; color: #1e293b;">í•©ê³„</td>
                    <td style="padding: 12px; text-align: right; color: #3B82F6;">${formatNumber(supportTotal)}</td>
                    <td style="padding: 12px; text-align: right; color: #3B82F6;">100%</td>
                </tr>
            `;

            // ë°œêµ´ í…Œì´ë¸”
            const discoveryTotal = Object.values(discoveryData).reduce((a, b) => a + b, 0);
            const discoveryTbody = document.getElementById('discovery-detail-tbody');
            discoveryTbody.innerHTML = '';
            Object.entries(discoveryData).forEach(([item, amount]) => {
                const ratio = discoveryTotal > 0 ? ((amount / discoveryTotal) * 100).toFixed(1) : 0;
                discoveryTbody.innerHTML += `
                    <tr style="border-bottom: 1px solid rgba(59, 130, 246, 0.1);">
                        <td style="padding: 10px; color: #334155;">${item}</td>
                        <td style="padding: 10px; text-align: right; color: #334155; font-weight: 600;">${formatNumber(amount)}</td>
                        <td style="padding: 10px; text-align: right; color: #3B82F6; font-weight: 600;">${ratio}%</td>
                    </tr>
                `;
            });
            discoveryTbody.innerHTML += `
                <tr style="background: rgba(59, 130, 246, 0.05); font-weight: 700;">
                    <td style="padding: 12px; color: #1e293b;">í•©ê³„</td>
                    <td style="padding: 12px; text-align: right; color: #3B82F6;">${formatNumber(discoveryTotal)}</td>
                    <td style="padding: 12px; text-align: right; color: #3B82F6;">100%</td>
                </tr>
            `;

            // ì¼ë°˜ê´€ë¦¬ë¹„ í…Œì´ë¸”
            const generalTotal = Object.values(generalData).reduce((a, b) => a + b, 0);
            const generalTbody = document.getElementById('general-detail-tbody');
            generalTbody.innerHTML = '';
            Object.entries(generalData).forEach(([item, amount]) => {
                const ratio = generalTotal > 0 ? ((amount / generalTotal) * 100).toFixed(1) : 0;
                generalTbody.innerHTML += `
                    <tr style="border-bottom: 1px solid rgba(59, 130, 246, 0.1);">
                        <td style="padding: 10px; color: #334155;">${item}</td>
                        <td style="padding: 10px; text-align: right; color: #334155; font-weight: 600;">${formatNumber(amount)}</td>
                        <td style="padding: 10px; text-align: right; color: #3B82F6; font-weight: 600;">${ratio}%</td>
                    </tr>
                `;
            });
            generalTbody.innerHTML += `
                <tr style="background: rgba(59, 130, 246, 0.05); font-weight: 700;">
                    <td style="padding: 12px; color: #1e293b;">í•©ê³„</td>
                    <td style="padding: 12px; text-align: right; color: #3B82F6;">${formatNumber(generalTotal)}</td>
                    <td style="padding: 12px; text-align: right; color: #3B82F6;">100%</td>
                </tr>
            `;
        }

        // ì—°ë„ë³„ ì°¨íŠ¸ ë°ì´í„° ì „í™˜ í•¨ìˆ˜
        function switchExpenseChartYear(year) {
            currentChartYear = year;

            // íƒ­ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.year-tab-button-chart').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.year-tab-button-chart[data-year="${year}"]`).classList.add('active');

            // í•´ë‹¹ ì—°ë„ì˜ ë°ì´í„° ë¡œë“œ
            const yearData = localStorage.getItem(`expenseData_${year}`);

            if (yearData) {
                const data = JSON.parse(yearData);

                // ë¶„ë¥˜ë³„ë¡œ ë°ì´í„° ì§‘ê³„
                const supportData = {};
                const discoveryData = {};
                const generalData = {};

                data.forEach(row => {
                    const category = row.category || 'ì§€ì›';
                    const item = row.item || 'ê¸°íƒ€';
                    const amount = row.amount || 0;

                    if (category === 'ì§€ì›') {
                        supportData[item] = (supportData[item] || 0) + amount;
                    } else if (category === 'ë°œêµ´') {
                        discoveryData[item] = (discoveryData[item] || 0) + amount;
                    } else if (category === 'ì¼ë°˜ê´€ë¦¬ë¹„') {
                        generalData[item] = (generalData[item] || 0) + amount;
                    }
                });

                // ì§€ì› ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                supportChart.data.labels = Object.keys(supportData);
                supportChart.data.datasets[0].data = Object.values(supportData);
                supportChart.update();

                // ë°œêµ´ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                discoveryChart.data.labels = Object.keys(discoveryData);
                discoveryChart.data.datasets[0].data = Object.values(discoveryData);
                discoveryChart.update();

                // ì¼ë°˜ê´€ë¦¬ë¹„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                generalChart.data.labels = Object.keys(generalData);
                generalChart.data.datasets[0].data = Object.values(generalData);
                generalChart.update();

                // ëŒ€ë¶„ë¥˜ ë¹„êµ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                const supportTotal = Object.values(supportData).reduce((a, b) => a + b, 0);
                const discoveryTotal = Object.values(discoveryData).reduce((a, b) => a + b, 0);
                const generalTotal = Object.values(generalData).reduce((a, b) => a + b, 0);

                categoryComparisonChart.data.datasets[0].data = [supportTotal, discoveryTotal, generalTotal];
                categoryComparisonChart.update();

                // ì˜µì…˜ 1: ìƒì„¸ í…Œì´ë¸” ì—…ë°ì´íŠ¸
                updateDetailTables(supportData, discoveryData, generalData);

                // ì˜µì…˜ 3: í†µí•© í…Œì´ë¸” ì—…ë°ì´íŠ¸
                updateSummaryTable(supportData, discoveryData, generalData);
            } else {
                // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ê°’ í‘œì‹œ
                supportChart.data.labels = ['ë°ì´í„° ì—†ìŒ'];
                supportChart.data.datasets[0].data = [0];
                supportChart.update();

                discoveryChart.data.labels = ['ë°ì´í„° ì—†ìŒ'];
                discoveryChart.data.datasets[0].data = [0];
                discoveryChart.update();

                generalChart.data.labels = ['ë°ì´í„° ì—†ìŒ'];
                generalChart.data.datasets[0].data = [0];
                generalChart.update();

                categoryComparisonChart.data.datasets[0].data = [0, 0, 0];
                categoryComparisonChart.update();

                // ë¹ˆ í…Œì´ë¸” í‘œì‹œ
                updateDetailTables({}, {}, {});
                updateSummaryTable({}, {}, {});
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë°ì´í„° í‘œì‹œ
        window.addEventListener('load', () => {
            switchExpenseChartYear('2025');
        });

        // 4. 2019-2025ë…„ í•­ëª©ë³„ ì˜ˆì‚° ì¶”ì´
        const yearlyTrendCtx = document.getElementById('yearlyTrendChart').getContext('2d');
        new Chart(yearlyTrendCtx, {
            type: 'line',
            data: {
                labels: ['2019', '2020', '2021', '2022', '2023', '2024', '2025'],
                datasets: [{
                    label: 'ì¸ê±´ë¹„',
                    data: [450, 520, 580, 650, 720, 780, 850],
                    borderColor: '#3B82F6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    tension: 0.4,
                    fill: true
                }, {
                    label: 'ìš´ì˜ë¹„',
                    data: [210, 230, 280, 320, 350, 380, 420],
                    borderColor: '#06B6D4',
                    backgroundColor: 'rgba(6, 182, 212, 0.1)',
                    tension: 0.4,
                    fill: true
                }, {
                    label: 'ë§ˆì¼€íŒ…',
                    data: [180, 220, 280, 350, 420, 500, 580],
                    borderColor: '#8B5CF6',
                    backgroundColor: 'rgba(139, 92, 246, 0.1)',
                    tension: 0.4,
                    fill: true
                }, {
                    label: 'ì—°êµ¬ê°œë°œ',
                    data: [120, 150, 180, 220, 280, 320, 350],
                    borderColor: '#EC4899',
                    backgroundColor: 'rgba(236, 72, 153, 0.1)',
                    tension: 0.4,
                    fill: true
                }, {
                    label: 'ê¸°íƒ€',
                    data: [100, 120, 150, 180, 220, 250, 300],
                    borderColor: '#F59E0B',
                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return new Intl.NumberFormat('ko-KR').format(value * 1000000) + 'ì›';
                            }
                        },
                        grid: {
                            color: 'rgba(59, 130, 246, 0.1)'
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(59, 130, 246, 0.1)'
                        }
                    }
                }
            }
        });

        // 6. ìˆ˜ì… ë‚´ì—­ ë° í–¥í›„ ì˜ˆì¸¡ (ì‹¤ì œ ë°ì´í„° ë°˜ì˜)
        let revenueForecastChart = null; // ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ì €ì¥ìš©
        
        function createRevenueForecastChart() {
            try {
                // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ ì œê±°
                if (revenueForecastChart) {
                    revenueForecastChart.destroy();
                }

                // ì‹¤ì œ ì…ë ¥ëœ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const years = ['2019', '2020', '2021', '2022', '2023', '2024', '2025'];
                const actualData = [];
                
                years.forEach(year => {
                    const savedData = localStorage.getItem(`incomeData_${year}`);
                    if (savedData) {
                        try {
                            const data = JSON.parse(savedData);
                            const total = data.reduce((sum, item) => sum + parseFloat(item.amount || 0), 0);
                            actualData.push(Math.round(total / 1000000)); // ë°±ë§Œì› ë‹¨ìœ„ë¡œ ë³€í™˜
                        } catch (e) {
                            actualData.push(null);
                        }
                    } else {
                        actualData.push(null);
                    }
                });

                // ì˜ˆì¸¡ ë°ì´í„° ìƒì„± (2025ë…„ ê¸°ì¤€ìœ¼ë¡œ ì—°í‰ê·  15% ì„±ì¥ ê°€ì •)
                const lastActualValue = actualData[actualData.length - 1] || 2250;
                const growthRate = 1.15;
                const forecastYears = ['2026', '2027', '2028', '2029', '2030', '2031', '2032', '2033', '2034', '2035'];
                const forecastData = [];
                
                forecastYears.forEach((year, index) => {
                    const value = Math.round(lastActualValue * Math.pow(growthRate, index + 1));
                    forecastData.push(value);
                });

                const revenueForecastCtx = document.getElementById('revenueForecastChart').getContext('2d');
                revenueForecastChart = new Chart(revenueForecastCtx, {
                type: 'line',
                data: {
                    labels: [...years, ...forecastYears],
                    datasets: [{
                        label: 'ì‹¤ì œ ìˆ˜ì…',
                        data: [...actualData, ...Array(forecastYears.length).fill(null)],
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 3
                    }, {
                        label: 'ì˜ˆì¸¡ ìˆ˜ì…',
                        data: [...Array(years.length - 1).fill(null), lastActualValue, ...forecastData],
                        borderColor: '#06B6D4',
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderDash: [5, 5],
                        borderWidth: 3
                    }]
                },
            options: {
                responsive: true,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += new Intl.NumberFormat('ko-KR').format(context.parsed.y * 1000000) + 'ì›';
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return new Intl.NumberFormat('ko-KR').format(value * 1000000) + 'ì›';
                            }
                        },
                        grid: {
                            color: 'rgba(59, 130, 246, 0.1)'
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(59, 130, 246, 0.1)'
                        }
                    }
                }
                });
            } catch (error) {
                console.error('ìˆ˜ì… ì˜ˆì¸¡ ì°¨íŠ¸ ìƒì„± ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê¸°ë³¸ ì°¨íŠ¸ ìƒì„±
                createBasicRevenueForecastChart();
            }
        }

        // ê¸°ë³¸ ì°¨íŠ¸ ìƒì„± í•¨ìˆ˜ (ì˜¤ë¥˜ ë°œìƒ ì‹œ ëŒ€ì²´ìš©)
        function createBasicRevenueForecastChart() {
            try {
                const revenueForecastCtx = document.getElementById('revenueForecastChart').getContext('2d');
                revenueForecastChart = new Chart(revenueForecastCtx, {
                    type: 'line',
                    data: {
                        labels: ['2019', '2020', '2021', '2022', '2023', '2024', '2025', '2026', '2027', '2028', '2029', '2030', '2031', '2032', '2033', '2034', '2035'],
                        datasets: [{
                            label: 'ì‹¤ì œ ìˆ˜ì…',
                            data: [850, 1020, 1250, 1480, 1720, 1950, 2250, null, null, null, null, null, null, null, null, null, null],
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 3
                        }, {
                            label: 'ì˜ˆì¸¡ ìˆ˜ì…',
                            data: [null, null, null, null, null, null, 2250, 2588, 2976, 3422, 3935, 4525, 5204, 5984, 6882, 7914, 9101],
                            borderColor: '#06B6D4',
                            backgroundColor: 'rgba(6, 182, 212, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderDash: [5, 5],
                            borderWidth: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            label += new Intl.NumberFormat('ko-KR').format(context.parsed.y * 1000000) + 'ì›';
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return new Intl.NumberFormat('ko-KR').format(value * 1000000) + 'ì›';
                                    }
                                },
                                grid: {
                                    color: 'rgba(59, 130, 246, 0.1)'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(59, 130, 246, 0.1)'
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('ê¸°ë³¸ ì°¨íŠ¸ ìƒì„±ë„ ì‹¤íŒ¨:', error);
            }
        }

        // ğŸ“Š ëª¨ë“  ì°¨íŠ¸ ì´ˆê¸°í™” í•¨ìˆ˜ (ì„ì‹œ ë¹„í™œì„±í™”)
        function initializeAllCharts() {
            console.log('ì°¨íŠ¸ ì´ˆê¸°í™” ì‹œì‘...');
            // ì°¨íŠ¸ ìƒì„±ì„ ì„ì‹œë¡œ ë¹„í™œì„±í™”í•˜ì—¬ í˜ì´ì§€ ë¡œë”© ë¬¸ì œ í•´ê²°
            // createRevenueForecastChart();
        }

        // 7. ì—°ë„ë³„ ë³€ë™ ë‚´ì—­ (ì•ˆì „í•˜ê²Œ ì´ˆê¸°í™”)
        function initializeChangeHistoryChart() {
            try {
                const changeHistoryCtx = document.getElementById('changeHistoryChart').getContext('2d');
                new Chart(changeHistoryCtx, {
            type: 'bar',
            data: {
                labels: ['2019', '2020', '2021', '2022', '2023', '2024', '2025'],
                datasets: [{
                    label: 'ìˆ˜ì…',
                    data: [850, 1020, 1250, 1480, 1720, 1950, 2250],
                    backgroundColor: '#3B82F6',
                    borderRadius: 8
                }, {
                    label: 'ì§€ì¶œ',
                    data: [720, 850, 1020, 1250, 1480, 1620, 1830],
                    backgroundColor: '#EC4899',
                    borderRadius: 8
                }, {
                    label: 'ìˆœì´ìµ',
                    data: [130, 170, 230, 230, 240, 330, 420],
                    backgroundColor: '#10b981',
                    borderRadius: 8
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return new Intl.NumberFormat('ko-KR').format(value * 1000000) + 'ì›';
                            }
                        },
                        grid: {
                            color: 'rgba(59, 130, 246, 0.1)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

        // ğŸ­ í”„ë ˆì  í…Œì´ì…˜ ëª¨ë“œ ê¸°ëŠ¥
        let currentSlide = 0;
        let autoSlideInterval = null;
        let isAutoSlide = false;

        function startPresentation() {
            document.getElementById('presentationMode').classList.add('active');
            currentSlide = 0;
            showSlide(currentSlide);
            animateSlideNumbers();
            
            // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            document.addEventListener('keydown', handlePresentationKeys);
        }

        function exitPresentation() {
            document.getElementById('presentationMode').classList.remove('active');
            if (autoSlideInterval) {
                clearInterval(autoSlideInterval);
                autoSlideInterval = null;
                isAutoSlide = false;
            }
            
            // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
            document.removeEventListener('keydown', handlePresentationKeys);
        }

        function handlePresentationKeys(event) {
            switch(event.key) {
                case 'ArrowLeft':
                    prevSlide();
                    break;
                case 'ArrowRight':
                case ' ':
                    nextSlide();
                    break;
                case 'Escape':
                    exitPresentation();
                    break;
                case 'f':
                case 'F':
                    toggleFullscreen();
                    break;
            }
        }

        function nextSlide() {
            const slides = document.querySelectorAll('.presentation-slide');
            if (currentSlide < slides.length - 1) {
                currentSlide++;
                showSlide(currentSlide);
                animateSlideNumbers();
            }
        }

        function prevSlide() {
            if (currentSlide > 0) {
                currentSlide--;
                showSlide(currentSlide);
                animateSlideNumbers();
            }
        }

        function goToSlide(index) {
            currentSlide = index;
            showSlide(currentSlide);
            animateSlideNumbers();
        }

        function showSlide(index) {
            const slides = document.querySelectorAll('.presentation-slide');
            const indicators = document.querySelectorAll('.indicator-dot');
            
            slides.forEach((slide, i) => {
                slide.classList.toggle('active', i === index);
            });
            
            indicators.forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });
        }

        function animateSlideNumbers() {
            const currentSlideElement = document.querySelectorAll('.presentation-slide')[currentSlide];
            const numberElements = currentSlideElement.querySelectorAll('[data-countup]');
            
            numberElements.forEach((element, index) => {
                const targetValue = parseFloat(element.getAttribute('data-countup'));
                const countUp = new CountUp(element, targetValue, {
                    duration: 2,
                    decimal: '.',
                    suffix: element.textContent.includes('%') ? '%' : (element.textContent.includes('ì›') ? 'ì›' : ''),
                    startVal: 0,
                    useGrouping: true, // ì²œ ë‹¨ìœ„ ì½¤ë§ˆ ì‚¬ìš©
                    separator: ',' // ì²œ ë‹¨ìœ„ êµ¬ë¶„ì
                });
                
                setTimeout(() => {
                    countUp.start();
                }, index * 200);
            });
        }

        function toggleAutoSlide() {
            if (isAutoSlide) {
                clearInterval(autoSlideInterval);
                autoSlideInterval = null;
                isAutoSlide = false;
                document.querySelector('.presentation-btn:last-child').innerHTML = '<i class="fas fa-magic"></i> ìë™ ì§„í–‰';
            } else {
                autoSlideInterval = setInterval(() => {
                    const slides = document.querySelectorAll('.presentation-slide');
                    if (currentSlide < slides.length - 1) {
                        nextSlide();
                    } else {
                        currentSlide = 0;
                        showSlide(currentSlide);
                        animateSlideNumbers();
                    }
                }, 5000);
                isAutoSlide = true;
                document.querySelector('.presentation-btn:last-child').innerHTML = '<i class="fas fa-stop"></i> ìë™ ì •ì§€';
            }
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // ğŸ¨ ë‹¤í¬ëª¨ë“œ í† ê¸€
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const themeBtn = document.querySelector('.theme-toggle-btn i');
            
            if (document.body.classList.contains('dark-mode')) {
                themeBtn.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
            } else {
                themeBtn.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            }
        }

        // âœ¨ í˜ì´ì§€ ë¡œë“œ ì‹œ ì• ë‹ˆë©”ì´ì…˜ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // AOS ì´ˆê¸°í™”
            AOS.init({
                duration: 800,
                easing: 'ease-out-cubic',
                once: true,
                offset: 100
            });

            // ğŸ“Š ë©”ì¸ í™”ë©´ í†µê³„ ì—…ë°ì´íŠ¸ (í˜ì´ì§€ ë¡œë“œ ì‹œ)
            setTimeout(() => {
                updateMainStats();
            }, 500);

            // ğŸ—‘ï¸ 2019~2023ë…„ ìˆ˜ì…ì›/ë¹„ê³  ì—…ë°ì´íŠ¸ (í•œ ë²ˆë§Œ ì‹¤í–‰)
            if (!localStorage.getItem('income_source_note_reset_v1')) {
                clearOldIncomeData();
                localStorage.setItem('income_source_note_reset_v1', 'true');
            }

            // ğŸ“Š ì°¨íŠ¸ ì´ˆê¸°í™” (ì„ì‹œ ë¹„í™œì„±í™”)
            // setTimeout(() => {
            //     try {
            //         initializeAllCharts();
            //     } catch (error) {
            //         console.error('ì°¨íŠ¸ ì´ˆê¸°í™” ì „ì²´ ì˜¤ë¥˜:', error);
            //     }
            // }, 1500);

            // ì €ì¥ëœ í…Œë§ˆ ì ìš©
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.querySelector('.theme-toggle-btn i').className = 'fas fa-sun';
            }

            // ìˆ«ì ì¹´ìš´íŠ¸ì—… ì• ë‹ˆë©”ì´ì…˜
            const numberElements = document.querySelectorAll('.animate-number[data-countup]');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const element = entry.target;
                        const targetValue = parseFloat(element.getAttribute('data-countup'));
                        const suffix = element.textContent.includes('ì›') ? 'ì›' : '';
                        
                        const countUp = new CountUp(element, targetValue, {
                            duration: 2,
                            decimal: '.',
                            suffix: suffix,
                            startVal: 0,
                            useGrouping: true, // ì²œ ë‹¨ìœ„ ì½¤ë§ˆ ì‚¬ìš©
                            separator: ',' // ì²œ ë‹¨ìœ„ êµ¬ë¶„ì
                        });
                        
                        countUp.start();
                        observer.unobserve(element);
                    }
                });
            }, { threshold: 0.5 });

            numberElements.forEach(element => {
                observer.observe(element);
            });

            // ì°¨íŠ¸ ì• ë‹ˆë©”ì´ì…˜
            const chartContainers = document.querySelectorAll('.chart-container');
            const chartObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate');
                    }
                });
            }, { threshold: 0.3 });

            chartContainers.forEach(container => {
                chartObserver.observe(container);
            });
        });

        // ğŸš€ ì¶”ê°€ ì¸í„°ë™í‹°ë¸Œ ê¸°ëŠ¥
        
        // ë§ˆìš°ìŠ¤ ë”°ë¼ë‹¤ë‹ˆëŠ” í¬ì¸í„° íš¨ê³¼ (í”„ë ˆì  í…Œì´ì…˜ ëª¨ë“œì—ì„œ)
        document.addEventListener('mousemove', function(e) {
            if (document.getElementById('presentationMode').classList.contains('active')) {
                const pointer = document.querySelector('.laser-pointer') || createLaserPointer();
                pointer.style.left = e.clientX + 'px';
                pointer.style.top = e.clientY + 'px';
            }
        });

        function createLaserPointer() {
            const pointer = document.createElement('div');
            pointer.className = 'laser-pointer';
            pointer.style.cssText = `
                position: fixed;
                width: 20px;
                height: 20px;
                background: radial-gradient(circle, rgba(249,115,22,0.8) 0%, rgba(249,115,22,0.2) 70%, transparent 100%);
                border-radius: 50%;
                pointer-events: none;
                z-index: 10002;
                transition: all 0.1s ease;
            `;
            document.body.appendChild(pointer);
            return pointer;
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ë„ì›€ë§
        function showKeyboardHelp() {
            alert(`ğŸ¯ í”„ë ˆì  í…Œì´ì…˜ ëª¨ë“œ ë‹¨ì¶•í‚¤:
            
â† â†’ : ìŠ¬ë¼ì´ë“œ ì´ë™
ìŠ¤í˜ì´ìŠ¤ë°” : ë‹¤ìŒ ìŠ¬ë¼ì´ë“œ
ESC : í”„ë ˆì  í…Œì´ì…˜ ì¢…ë£Œ
F : ì „ì²´í™”ë©´ í† ê¸€`);
        }

        // í”„ë ˆì  í…Œì´ì…˜ íƒ€ì´ë¨¸
        let presentationStartTime = null;
        let timerInterval = null;

        function startPresentationTimer() {
            presentationStartTime = Date.now();
            const timerDisplay = document.createElement('div');
            timerDisplay.id = 'presentation-timer';
            timerDisplay.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0,0,0,0.7);
                color: white;
                padding: 10px 20px;
                border-radius: 20px;
                font-family: monospace;
                font-size: 16px;
                z-index: 10002;
            `;
            document.body.appendChild(timerDisplay);
            
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - presentationStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function stopPresentationTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            const timer = document.getElementById('presentation-timer');
            if (timer) {
                timer.remove();
            }
        }

        // í”„ë ˆì  í…Œì´ì…˜ ì‹œì‘ ì‹œ íƒ€ì´ë¨¸ë„ ì‹œì‘
        const originalStartPresentation = startPresentation;
        startPresentation = function() {
            originalStartPresentation();
            startPresentationTimer();
        };

        const originalExitPresentation = exitPresentation;
        exitPresentation = function() {
            originalExitPresentation();
            stopPresentationTimer();
            const pointer = document.querySelector('.laser-pointer');
            if (pointer) pointer.remove();
        };

        // ğŸ¤– ì‹¤ì‹œê°„ AI ë¶„ì„ ì—”ì§„
        class AIAnalysisEngine {
            constructor() {
                this.currentData = null;
                this.analysisHistory = [];
                this.initializeDefaultAnalysis();
            }

            // ê¸°ë³¸ ë¶„ì„ ì´ˆê¸°í™” (ë°±ë§Œì› ë‹¨ìœ„ ë°ì´í„°)
            initializeDefaultAnalysis() {
                const defaultData = {
                    expenses: [
                        { year: 2019, amount: 720 },
                        { year: 2020, amount: 850 },
                        { year: 2021, amount: 1020 },
                        { year: 2022, amount: 1250 },
                        { year: 2023, amount: 1480 },
                        { year: 2024, amount: 1620 },
                        { year: 2025, amount: 1830 }
                    ],
                    revenues: [
                        { year: 2019, amount: 850 },
                        { year: 2020, amount: 1020 },
                        { year: 2021, amount: 1250 },
                        { year: 2022, amount: 1480 },
                        { year: 2023, amount: 1720 },
                        { year: 2024, amount: 1950 },
                        { year: 2025, amount: 2250 }
                    ]
                };
                this.analyzeData(defaultData);
            }

            // ì—‘ì…€ ë°ì´í„° íŒŒì‹±
            parseExcelData(workbook) {
                try {
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    // ë°ì´í„° êµ¬ì¡° ìë™ ê°ì§€ ë° ë³€í™˜
                    const parsedData = this.detectDataStructure(jsonData);
                    this.analyzeData(parsedData);
                    
                    return parsedData;
                } catch (error) {
                    console.error('ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', error);
                    this.showDataStatus('ë°ì´í„° íŒŒì‹± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                    return null;
                }
            }

            // ë°ì´í„° êµ¬ì¡° ìë™ ê°ì§€
            detectDataStructure(jsonData) {
                const expenses = [];
                const revenues = [];
                
                jsonData.forEach(row => {
                    // ë‹¤ì–‘í•œ ì»¬ëŸ¼ëª… íŒ¨í„´ ì§€ì›
                    const year = row['ì—°ë„'] || row['Year'] || row['ë…„ë„'] || row['YEAR'];
                    const expense = row['ì§€ì¶œ'] || row['Expense'] || row['ë¹„ìš©'] || row['Cost'] || row['ê¸ˆì•¡'];
                    const revenue = row['ìˆ˜ì…'] || row['Revenue'] || row['ë§¤ì¶œ'] || row['Income'] || row['ê¸ˆì•¡'];
                    
                    if (year && expense !== undefined) {
                        // ì› ë‹¨ìœ„ ê·¸ëŒ€ë¡œ ì‚¬ìš©
                        const expenseAmount = parseFloat(expense);
                        expenses.push({ year: parseInt(year), amount: expenseAmount });
                    }
                    if (year && revenue !== undefined) {
                        // ì› ë‹¨ìœ„ ê·¸ëŒ€ë¡œ ì‚¬ìš©
                        const revenueAmount = parseFloat(revenue);
                        revenues.push({ year: parseInt(year), amount: revenueAmount });
                    }
                });

                return { expenses, revenues };
            }

            // ë©”ì¸ ë°ì´í„° ë¶„ì„ í•¨ìˆ˜
            analyzeData(data) {
                this.currentData = data;
                this.showDataStatus('ë°ì´í„° ë¶„ì„ ì¤‘...', 'loading');
                
                setTimeout(() => {
                    const insights = this.generateInsights(data);
                    const kpis = this.calculateKPIs(data);
                    
                    this.updateInsightCards(insights);
                    this.updateKPICards(kpis);
                    this.showDataStatus(`ë¶„ì„ ì™„ë£Œ! ${new Date().toLocaleTimeString()}ì— ì—…ë°ì´íŠ¸ë¨`, 'success');
                    
                    // ë¶„ì„ íˆìŠ¤í† ë¦¬ ì €ì¥
                    this.analysisHistory.push({
                        timestamp: new Date(),
                        insights,
                        kpis
                    });
                }, 1000);
            }

            // ì¸ì‚¬ì´íŠ¸ ìƒì„±
            generateInsights(data) {
                const insights = [];
                
                // 1. ì„±ì¥ íŠ¸ë Œë“œ ë¶„ì„
                const growthAnalysis = this.analyzeGrowthTrend(data);
                insights.push({
                    type: 'growth',
                    title: 'ì„±ì¥ íŠ¸ë Œë“œ',
                    icon: 'fas fa-chart-line',
                    color: 'linear-gradient(135deg, #3B82F6 0%, #1E40AF 100%)',
                    description: growthAnalysis.description,
                    metric: growthAnalysis.metric,
                    severity: growthAnalysis.severity
                });

                // 2. íš¨ìœ¨ì„± ë¶„ì„
                const efficiencyAnalysis = this.analyzeEfficiency(data);
                insights.push({
                    type: 'efficiency',
                    title: 'íš¨ìœ¨ì„± ì§€í‘œ',
                    icon: 'fas fa-target',
                    color: 'linear-gradient(135deg, #10B981 0%, #059669 100%)',
                    description: efficiencyAnalysis.description,
                    metric: efficiencyAnalysis.metric,
                    severity: efficiencyAnalysis.severity
                });

                // 3. ë¯¸ë˜ ì˜ˆì¸¡
                const predictionAnalysis = this.predictFuture(data);
                insights.push({
                    type: 'prediction',
                    title: 'ë¯¸ë˜ ì „ë§',
                    icon: 'fas fa-crystal-ball',
                    color: 'linear-gradient(135deg, #F59E0B 0%, #D97706 100%)',
                    description: predictionAnalysis.description,
                    metric: predictionAnalysis.metric,
                    severity: predictionAnalysis.severity
                });

                // 4. ì´ìƒì¹˜ ê°ì§€
                const anomalyAnalysis = this.detectAnomalies(data);
                if (anomalyAnalysis.hasAnomalies) {
                    insights.push({
                        type: 'anomaly',
                        title: 'ì£¼ì˜ ì‚¬í•­',
                        icon: 'fas fa-exclamation-triangle',
                        color: 'linear-gradient(135deg, #EF4444 0%, #DC2626 100%)',
                        description: anomalyAnalysis.description,
                        metric: anomalyAnalysis.metric,
                        severity: 'warning'
                    });
                }

                return insights;
            }

            // ì„±ì¥ íŠ¸ë Œë“œ ë¶„ì„
            analyzeGrowthTrend(data) {
                const revenues = data.revenues.sort((a, b) => a.year - b.year);
                if (revenues.length < 2) {
                    return {
                        description: 'ë¶„ì„ì„ ìœ„í•œ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.',
                        metric: 'ë°ì´í„° ë¶€ì¡±',
                        severity: 'info'
                    };
                }

                // ì—°í‰ê·  ì„±ì¥ë¥  ê³„ì‚°
                const firstYear = revenues[0];
                const lastYear = revenues[revenues.length - 1];
                const years = lastYear.year - firstYear.year;
                const cagr = Math.pow(lastYear.amount / firstYear.amount, 1 / years) - 1;

                // ìµœê·¼ ì„±ì¥ë¥ 
                const recentGrowth = revenues.length >= 2 ? 
                    ((lastYear.amount - revenues[revenues.length - 2].amount) / revenues[revenues.length - 2].amount) * 100 : 0;

                // ì—°ì† ì„±ì¥ ë…„ìˆ˜ ê³„ì‚°
                let consecutiveGrowth = 0;
                for (let i = 1; i < revenues.length; i++) {
                    if (revenues[i].amount > revenues[i-1].amount) {
                        consecutiveGrowth++;
                    } else {
                        consecutiveGrowth = 0;
                    }
                }

                let description, severity;
                if (cagr > 0.15) {
                    description = `${consecutiveGrowth}ë…„ ì—°ì† ê°•ë ¥í•œ ì„±ì¥ì„¸ë¥¼ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤. ìµœê·¼ ì„±ì¥ë¥  ${recentGrowth.toFixed(1)}%ë¡œ ë§¤ìš° ìš°ìˆ˜í•œ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.`;
                    severity = 'excellent';
                } else if (cagr > 0.05) {
                    description = `${consecutiveGrowth}ë…„ ì—°ì† ì•ˆì •ì ì¸ ì„±ì¥ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤. ì§€ì†ì ì¸ ì„±ì¥ ë™ë ¥ì„ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.`;
                    severity = 'good';
                } else if (cagr > 0) {
                    description = `ì™„ë§Œí•œ ì„±ì¥ì„¸ë¥¼ ë³´ì´ê³  ìˆìœ¼ë‚˜, ì„±ì¥ ë™ë ¥ ê°•í™”ê°€ í•„ìš”í•©ë‹ˆë‹¤.`;
                    severity = 'warning';
                } else {
                    description = `ìˆ˜ì…ì´ ê°ì†Œ ì¶”ì„¸ì— ìˆìŠµë‹ˆë‹¤. ì¦‰ì‹œ ê°œì„  ë°©ì•ˆì´ í•„ìš”í•©ë‹ˆë‹¤.`;
                    severity = 'critical';
                }

                return {
                    description,
                    metric: `ğŸ“ˆ ì—°í‰ê·  ì„±ì¥ë¥ : ${(cagr * 100).toFixed(1)}%`,
                    severity,
                    cagr: cagr * 100,
                    consecutiveGrowth
                };
            }

            // íš¨ìœ¨ì„± ë¶„ì„
            analyzeEfficiency(data) {
                const latestYear = Math.max(...data.revenues.map(r => r.year));
                const latestRevenue = data.revenues.find(r => r.year === latestYear)?.amount || 0;
                const latestExpense = data.expenses.find(e => e.year === latestYear)?.amount || 0;
                
                const profitMargin = latestRevenue > 0 ? ((latestRevenue - latestExpense) / latestRevenue) * 100 : 0;
                const roi = latestExpense > 0 ? ((latestRevenue - latestExpense) / latestExpense) * 100 : 0;

                // ì „ë…„ ëŒ€ë¹„ íš¨ìœ¨ì„± ë³€í™”
                const prevYear = latestYear - 1;
                const prevRevenue = data.revenues.find(r => r.year === prevYear)?.amount || 0;
                const prevExpense = data.expenses.find(e => e.year === prevYear)?.amount || 0;
                const prevProfitMargin = prevRevenue > 0 ? ((prevRevenue - prevExpense) / prevRevenue) * 100 : 0;
                
                const efficiencyChange = profitMargin - prevProfitMargin;

                let description, severity;
                if (profitMargin > 20) {
                    description = `ìˆœì´ìµë¥  ${profitMargin.toFixed(1)}%ë¡œ ë§¤ìš° ìš°ìˆ˜í•œ ìˆ˜ìµì„±ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤. ROI ${roi.toFixed(1)}%ë¡œ íš¨ìœ¨ì ì¸ ìš´ì˜ì´ ì´ë£¨ì–´ì§€ê³  ìˆìŠµë‹ˆë‹¤.`;
                    severity = 'excellent';
                } else if (profitMargin > 10) {
                    description = `ìˆœì´ìµë¥  ${profitMargin.toFixed(1)}%ë¡œ ì–‘í˜¸í•œ ìˆ˜ìµì„±ì„ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì§€ì†ì ì¸ íš¨ìœ¨ì„± ê°œì„ ì´ ê¶Œì¥ë©ë‹ˆë‹¤.`;
                    severity = 'good';
                } else if (profitMargin > 0) {
                    description = `ìˆœì´ìµë¥  ${profitMargin.toFixed(1)}%ë¡œ ìˆ˜ìµì„± ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¹„ìš© ìµœì í™”ë¥¼ ê²€í† í•´ë³´ì„¸ìš”.`;
                    severity = 'warning';
                } else {
                    description = `ì ì ìƒíƒœì…ë‹ˆë‹¤. ì¦‰ì‹œ ë¹„ìš© êµ¬ì¡° ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.`;
                    severity = 'critical';
                }

                return {
                    description,
                    metric: `ğŸ’° ìˆœì´ìµë¥ : ${profitMargin.toFixed(1)}%`,
                    severity,
                    profitMargin,
                    roi,
                    efficiencyChange
                };
            }

            // ë¯¸ë˜ ì˜ˆì¸¡
            predictFuture(data) {
                const revenues = data.revenues.sort((a, b) => a.year - b.year);
                if (revenues.length < 3) {
                    return {
                        description: 'ì˜ˆì¸¡ì„ ìœ„í•œ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.',
                        metric: 'ë°ì´í„° ë¶€ì¡±',
                        severity: 'info'
                    };
                }

                // ì„ í˜• íšŒê·€ë¥¼ ì´ìš©í•œ ê°„ë‹¨í•œ ì˜ˆì¸¡
                const n = revenues.length;
                const sumX = revenues.reduce((sum, r) => sum + r.year, 0);
                const sumY = revenues.reduce((sum, r) => sum + r.amount, 0);
                const sumXY = revenues.reduce((sum, r) => sum + (r.year * r.amount), 0);
                const sumXX = revenues.reduce((sum, r) => sum + (r.year * r.year), 0);

                const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
                const intercept = (sumY - slope * sumX) / n;

                const nextYear = Math.max(...revenues.map(r => r.year)) + 1;
                const predictedRevenue = slope * nextYear + intercept;
                const currentRevenue = revenues[revenues.length - 1].amount;
                const predictedGrowth = ((predictedRevenue - currentRevenue) / currentRevenue) * 100;

                // ì˜ˆì¸¡ ì‹ ë¢°ë„ ê³„ì‚° (R-squared)
                const meanY = sumY / n;
                const ssRes = revenues.reduce((sum, r) => {
                    const predicted = slope * r.year + intercept;
                    return sum + Math.pow(r.amount - predicted, 2);
                }, 0);
                const ssTot = revenues.reduce((sum, r) => sum + Math.pow(r.amount - meanY, 2), 0);
                const rSquared = 1 - (ssRes / ssTot);

                // ì› ë‹¨ìœ„ í¬ë§·íŒ… í•¨ìˆ˜ (ë°±ë§Œì› ë‹¨ìœ„ ë°ì´í„°ë¥¼ ì›ìœ¼ë¡œ ë³€í™˜)
                const formatWon = (amount) => {
                    return new Intl.NumberFormat('ko-KR').format(Math.round(amount * 1000000)) + 'ì›';
                };

                let description, severity;
                if (predictedGrowth > 15) {
                    description = `í˜„ì¬ ì„±ì¥ íŒ¨í„´ì„ ê¸°ë°˜ìœ¼ë¡œ ${nextYear}ë…„ ì˜ˆìƒ ìˆ˜ì…ì€ ${formatWon(predictedRevenue)}ì…ë‹ˆë‹¤. ê°•ë ¥í•œ ì„±ì¥ì´ ì˜ˆìƒë©ë‹ˆë‹¤.`;
                    severity = 'excellent';
                } else if (predictedGrowth > 5) {
                    description = `${nextYear}ë…„ ì˜ˆìƒ ìˆ˜ì…ì€ ${formatWon(predictedRevenue)}ìœ¼ë¡œ ì•ˆì •ì ì¸ ì„±ì¥ì´ ì˜ˆìƒë©ë‹ˆë‹¤.`;
                    severity = 'good';
                } else if (predictedGrowth > 0) {
                    description = `${nextYear}ë…„ ì˜ˆìƒ ìˆ˜ì…ì€ ${formatWon(predictedRevenue)}ìœ¼ë¡œ ì™„ë§Œí•œ ì„±ì¥ì´ ì˜ˆìƒë©ë‹ˆë‹¤.`;
                    severity = 'warning';
                } else {
                    description = `${nextYear}ë…„ ìˆ˜ì… ê°ì†Œê°€ ì˜ˆìƒë©ë‹ˆë‹¤. ì „ëµì  ëŒ€ì‘ì´ í•„ìš”í•©ë‹ˆë‹¤.`;
                    severity = 'critical';
                }

                return {
                    description,
                    metric: `ğŸš€ ì˜ˆìƒ ì„±ì¥ë¥ : ${predictedGrowth.toFixed(1)}%`,
                    severity,
                    predictedRevenue,
                    predictedGrowth,
                    confidence: rSquared * 100
                };
            }

            // ì´ìƒì¹˜ ê°ì§€
            detectAnomalies(data) {
                const revenues = data.revenues.sort((a, b) => a.year - b.year);
                const expenses = data.expenses.sort((a, b) => a.year - b.year);
                
                let anomalies = [];

                // ê¸‰ê²©í•œ ë³€í™” ê°ì§€ (ì „ë…„ ëŒ€ë¹„ 30% ì´ìƒ ë³€í™”)
                for (let i = 1; i < revenues.length; i++) {
                    const change = Math.abs((revenues[i].amount - revenues[i-1].amount) / revenues[i-1].amount);
                    if (change > 0.3) {
                        anomalies.push(`${revenues[i].year}ë…„ ìˆ˜ì…ì´ ì „ë…„ ëŒ€ë¹„ ${(change * 100).toFixed(1)}% ê¸‰ë³€í–ˆìŠµë‹ˆë‹¤.`);
                    }
                }

                for (let i = 1; i < expenses.length; i++) {
                    const change = Math.abs((expenses[i].amount - expenses[i-1].amount) / expenses[i-1].amount);
                    if (change > 0.3) {
                        anomalies.push(`${expenses[i].year}ë…„ ì§€ì¶œì´ ì „ë…„ ëŒ€ë¹„ ${(change * 100).toFixed(1)}% ê¸‰ë³€í–ˆìŠµë‹ˆë‹¤.`);
                    }
                }

                // ì ì ìƒíƒœ ê°ì§€
                const latestYear = Math.max(...revenues.map(r => r.year));
                const latestRevenue = revenues.find(r => r.year === latestYear)?.amount || 0;
                const latestExpense = expenses.find(e => e.year === latestYear)?.amount || 0;
                
                if (latestRevenue < latestExpense) {
                    anomalies.push(`${latestYear}ë…„ ì ì ìƒíƒœì…ë‹ˆë‹¤. ì¦‰ì‹œ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.`);
                }

                return {
                    hasAnomalies: anomalies.length > 0,
                    description: anomalies.length > 0 ? anomalies.join(' ') : 'ì •ìƒ ë²”ìœ„ ë‚´ì—ì„œ ìš´ì˜ë˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    metric: anomalies.length > 0 ? `âš ï¸ ${anomalies.length}ê°œ ì£¼ì˜ì‚¬í•­` : 'âœ… ì •ìƒ',
                    anomalies
                };
            }

            // KPI ê³„ì‚°
            calculateKPIs(data) {
                const latestYear = Math.max(...data.revenues.map(r => r.year));
                const latestRevenue = data.revenues.find(r => r.year === latestYear)?.amount || 0;
                const latestExpense = data.expenses.find(e => e.year === latestYear)?.amount || 0;
                const profit = latestRevenue - latestExpense;

                // ì„±ì¥ ë…„ìˆ˜ ê³„ì‚°
                const revenues = data.revenues.sort((a, b) => a.year - b.year);
                let consecutiveGrowth = 0;
                for (let i = 1; i < revenues.length; i++) {
                    if (revenues[i].amount > revenues[i-1].amount) {
                        consecutiveGrowth++;
                    } else {
                        break;
                    }
                }

                // ëª©í‘œ ë‹¬ì„±ë¥  (ê°€ì •: ëª©í‘œ ìˆ˜ì… 2000ë°±ë§Œì›)
                const targetRevenue = 2000;
                const achievementRate = (latestRevenue / targetRevenue) * 100;

                // ìˆœì´ìµ ì¦ê°€ìœ¨
                const prevYear = latestYear - 1;
                const prevRevenue = data.revenues.find(r => r.year === prevYear)?.amount || 0;
                const prevExpense = data.expenses.find(e => e.year === prevYear)?.amount || 0;
                const prevProfit = prevRevenue - prevExpense;
                const profitGrowth = prevProfit > 0 ? ((profit - prevProfit) / prevProfit) * 100 : 0;

                return [
                    {
                        label: 'ëª©í‘œ ë‹¬ì„±ë¥  (%)',
                        value: Math.min(achievementRate, 999).toFixed(0),
                        color: achievementRate >= 100 ? '#10B981' : achievementRate >= 80 ? '#F59E0B' : '#EF4444'
                    },
                    {
                        label: 'ì—°ì† ì„±ì¥ (ë…„)',
                        value: consecutiveGrowth,
                        color: consecutiveGrowth >= 5 ? '#10B981' : consecutiveGrowth >= 3 ? '#F59E0B' : '#EF4444'
                    },
                    {
                        label: 'ìˆœì´ìµ ì¦ê°€ìœ¨ (%)',
                        value: profitGrowth.toFixed(1),
                        color: profitGrowth > 0 ? '#10B981' : '#EF4444'
                    },
                    {
                        label: 'í˜„ì¬ ìˆœì´ìµ (ì›)',
                        value: new Intl.NumberFormat('ko-KR').format(Math.round(profit * 1000000)),
                        color: profit > 0 ? '#10B981' : '#EF4444'
                    }
                ];
            }

            // ì¸ì‚¬ì´íŠ¸ ì¹´ë“œ ì—…ë°ì´íŠ¸
            updateInsightCards(insights) {
                const grid = document.getElementById('insightGrid');
                grid.innerHTML = '';

                insights.forEach((insight, index) => {
                    const card = document.createElement('div');
                    card.className = 'insight-card';
                    card.setAttribute('data-aos', 'flip-left');
                    card.setAttribute('data-aos-delay', (200 + index * 100).toString());
                    
                    const shadowColor = insight.severity === 'critical' ? 'rgba(239, 68, 68, 0.3)' :
                                      insight.severity === 'warning' ? 'rgba(245, 158, 11, 0.3)' :
                                      insight.severity === 'excellent' ? 'rgba(16, 185, 129, 0.3)' :
                                      'rgba(59, 130, 246, 0.3)';

                    card.style.cssText = `
                        background: ${insight.color};
                        color: white;
                        padding: 25px;
                        border-radius: 15px;
                        box-shadow: 0 4px 15px ${shadowColor};
                        transition: transform 0.3s ease;
                        cursor: pointer;
                    `;

                    card.innerHTML = `
                        <h3 style="margin-bottom: 15px;"><i class="${insight.icon}"></i> ${insight.title}</h3>
                        <p style="line-height: 1.6; margin-bottom: 15px;">${insight.description}</p>
                        <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; font-size: 0.9rem;">
                            ${insight.metric}
                        </div>
                    `;

                    card.addEventListener('mouseenter', () => {
                        card.style.transform = 'translateY(-5px) scale(1.02)';
                    });

                    card.addEventListener('mouseleave', () => {
                        card.style.transform = 'translateY(0) scale(1)';
                    });

                    grid.appendChild(card);
                });

                // AOS ì¬ì´ˆê¸°í™”
                AOS.refresh();
            }

            // KPI ì¹´ë“œ ì—…ë°ì´íŠ¸
            updateKPICards(kpis) {
                const grid = document.getElementById('kpiGrid');
                grid.innerHTML = '';

                kpis.forEach((kpi, index) => {
                    const kpiElement = document.createElement('div');
                    kpiElement.innerHTML = `
                        <div style="font-size: 2rem; font-weight: 700; margin-bottom: 5px; color: ${kpi.color};" 
                             class="animate-number" data-countup="${kpi.value}">${kpi.value}</div>
                        <div style="font-size: 0.9rem; opacity: 0.9;">${kpi.label}</div>
                    `;

                    grid.appendChild(kpiElement);
                });

                // ìˆ«ì ì• ë‹ˆë©”ì´ì…˜ ì¬ì‹¤í–‰
                setTimeout(() => {
                    const numberElements = grid.querySelectorAll('.animate-number[data-countup]');
                    numberElements.forEach((element, index) => {
                        const targetValue = parseFloat(element.getAttribute('data-countup'));
                        const countUp = new CountUp(element, targetValue, {
                            duration: 2,
                            decimal: '.',
                            startVal: 0
                        });
                        
                        setTimeout(() => {
                            countUp.start();
                        }, index * 200);
                    });
                }, 100);
            }

            // ë°ì´í„° ìƒíƒœ í‘œì‹œ
            showDataStatus(message, type = 'info') {
                const statusDiv = document.getElementById('dataStatus');
                const statusText = document.getElementById('dataStatusText');
                
                statusText.textContent = message;
                statusDiv.style.display = 'block';

                // íƒ€ì…ë³„ ìŠ¤íƒ€ì¼ ì ìš©
                const colors = {
                    loading: { bg: '#f0f9ff', border: '#0ea5e9', icon: '#0ea5e9' },
                    success: { bg: '#f0fdf4', border: '#10b981', icon: '#10b981' },
                    error: { bg: '#fef2f2', border: '#ef4444', icon: '#ef4444' },
                    info: { bg: '#f0f9ff', border: '#0ea5e9', icon: '#0ea5e9' }
                };

                const color = colors[type] || colors.info;
                statusDiv.style.background = color.bg;
                statusDiv.style.borderColor = color.border;
                statusDiv.querySelector('i').style.color = color.icon;

                // ì„±ê³µ/ì—ëŸ¬ ë©”ì‹œì§€ëŠ” 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
                if (type === 'success' || type === 'error') {
                    setTimeout(() => {
                        statusDiv.style.display = 'none';
                    }, 3000);
                }
            }
        }

        // AI ë¶„ì„ ì—”ì§„ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        const aiEngine = new AIAnalysisEngine();

        // ë¶„ì„ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜
        function refreshAIAnalysis() {
            const refreshBtn = document.getElementById('refreshAnalysis');
            const originalHTML = refreshBtn.innerHTML;
            
            refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ë¶„ì„ ì¤‘...';
            refreshBtn.disabled = true;

            // í˜„ì¬ ë°ì´í„°ë¡œ ì¬ë¶„ì„
            setTimeout(() => {
                if (aiEngine.currentData) {
                    aiEngine.analyzeData(aiEngine.currentData);
                }
                
                refreshBtn.innerHTML = originalHTML;
                refreshBtn.disabled = false;
            }, 2000);
        }

        // ë¶„ì„ ë³´ê³ ì„œ ë‚´ë³´ë‚´ê¸°
        function exportAnalysisReport() {
            const report = aiEngine.analysisHistory[aiEngine.analysisHistory.length - 1];
            if (!report) {
                alert('ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const reportContent = `
í”„ë¼ì´ë¨¸ ì „ëµíŒ€ AI ë¶„ì„ ë³´ê³ ì„œ
ìƒì„±ì¼ì‹œ: ${report.timestamp.toLocaleString()}

=== í•µì‹¬ ì¸ì‚¬ì´íŠ¸ ===
${report.insights.map(insight => `
${insight.title}:
${insight.description}
${insight.metric}
`).join('\n')}

=== KPI ì§€í‘œ ===
${report.kpis.map(kpi => `${kpi.label}: ${kpi.value}`).join('\n')}
            `;

            // í…ìŠ¤íŠ¸ íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
            const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `AIë¶„ì„ë³´ê³ ì„œ_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ì—‘ì…€ ì—…ë¡œë“œ í•¨ìˆ˜ë“¤ì„ AI ë¶„ì„ê³¼ ì—°ë™
        const originalUploadDetailExcel = uploadDetailExcel;
        const originalUploadIncomeExcel = uploadIncomeExcel;

        // ì§€ì¶œ ì—‘ì…€ ì—…ë¡œë“œ AI ì—°ë™
        uploadDetailExcel = function(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // AI ë¶„ì„ ì—”ì§„ìœ¼ë¡œ ë°ì´í„° ì „ì†¡
                    const parsedData = aiEngine.parseExcelData(workbook);
                    
                    if (parsedData) {
                        // ê¸°ì¡´ ì—…ë¡œë“œ ë¡œì§ë„ ì‹¤í–‰
                        originalUploadDetailExcel(event);
                    }
                } catch (error) {
                    console.error('ì—‘ì…€ íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    aiEngine.showDataStatus('ì—‘ì…€ íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        };

        // ìˆ˜ì… ì—‘ì…€ ì—…ë¡œë“œ AI ì—°ë™ (ìƒˆë¡œìš´ í˜•ì‹)
        uploadIncomeExcel = function(event) {
            const file = event.target.files[0];
            if (!file) return;

            // AI ë¶„ì„ì„ ìœ„í•œ ë°ì´í„° íŒŒì‹±
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // AI ë¶„ì„ ì—”ì§„ìœ¼ë¡œ ë°ì´í„° ì „ì†¡
                    const parsedData = aiEngine.parseExcelData(workbook);
                    
                    // ê¸°ì¡´ ìˆ˜ì… ì—…ë¡œë“œ ë¡œì§ ì‹¤í–‰
                    originalUploadIncomeExcel(event);
                } catch (error) {
                    console.error('ìˆ˜ì… ì—‘ì…€ íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    aiEngine.showDataStatus('ìˆ˜ì… ì—‘ì…€ íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        };
    </script>
</body>
</html>
